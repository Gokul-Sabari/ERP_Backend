"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[3524],{23524:(e,s,t)=>{t.r(s),t.d(s,{default:()=>S});var a=t(69060),l=t(79476),c=t(51560),i=t(3358),d=t(5548),n=t(82656),r=t(26773),o=t(4488),u=t(90048),m=t(89e3),h=t(96224),x=t(13576),j=t(90460),p=t(34920),v=t(50976),f=t(49608),g=t(56480),N=(t(21680),t(12720)),b=t(98372),I=t(1908),y=t(82496);const S=()=>{const e=localStorage.getItem("user"),s=JSON.parse(e),t=(0,c.IT)().state,S=(0,c.i6)(),[C,w]=(0,a.useState)([]),[F,T]=(0,a.useState)([]),k=(0,a.useRef)(null),[U,D]=(0,a.useState)(""),[_,z]=(0,a.useState)(!1),[A,M]=(0,a.useState)(!1),[q,E]=(0,a.useState)(""),[O,P]=(0,a.useState)(0),[R,W]=(0,a.useState)(!1);(0,a.useEffect)((()=>{if(!t)return S("/taskManagement/discussions");(0,I.q)({address:"discussionForum/messages?Topic_Id=".concat(null===t||void 0===t?void 0:t.Id)}).then((e=>{if(e.success){const s=e.data.reduce(((e,s)=>{const t=new Date(s.CreatedAt).toDateString();return e[t]||(e[t]=[]),e[t].push(s),e}),{});w(s)}})).catch((e=>console.log(e))),(0,I.q)({address:"discussionForum/files?Topic_Id=".concat(null===t||void 0===t?void 0:t.Id)}).then((e=>{e.success&&T(e.data)})).catch((e=>console.log(e)))}),[_]),(0,a.useEffect)((()=>{if(k.current){const{scrollHeight:e,clientHeight:s}=k.current;k.current.scrollTop=e-s}}),[C]);const L=()=>{M(!1),E("")},B=e=>{e.preventDefault();const a=new FormData;a.append("files",q),a.append("User_Id",null===s||void 0===s?void 0:s.UserId),a.append("Project_Id",null===t||void 0===t?void 0:t.Project_Id),a.append("Topic_Id",null===t||void 0===t?void 0:t.Id);try{b.c.post("".concat(l.c,"discussionForum/files"),a,{headers:{"Content-Type":"multipart/form-data",Authorization:null===s||void 0===s?void 0:s.Autheticate_Id},onUploadProgress:e=>{let s=Math.round(100*e.loaded/e.total);P(s)}}).then((e=>{g.m4.success(e.data.message),z(!_)})).catch((e=>{g.m4.error("Failed to upload"),console.error(e)})).finally((()=>{L(),P(0)}))}catch(c){console.error("Error uploading file:",c)}};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(g.jd,{}),(0,y.jsxs)("div",{className:"chat-header d-flex align-items-center",children:[(0,y.jsx)("p",{className:"mb-0 fa-14 text-white text-uppercase fw-bold flex-grow-1",children:null===t||void 0===t?void 0:t.Topic}),(0,y.jsx)(i.c,{title:"Back",children:(0,y.jsx)(d.c,{size:"small",onClick:()=>S("/taskManagement/discussions"),children:(0,y.jsx)(h.c,{className:"fa-18"})})}),(0,y.jsx)(i.c,{title:"Refresh Chat",children:(0,y.jsx)(d.c,{size:"small",onClick:()=>z(!_),children:(0,y.jsx)(x.c,{className:"fa-18"})})}),(0,y.jsx)(i.c,{title:"Documnets Shared",children:(0,y.jsx)(d.c,{size:"small",onClick:()=>W(!0),children:(0,y.jsx)(j.c,{})})}),(0,y.jsxs)(N.c,{children:[(0,y.jsx)(N.c.Toggle,{variant:"success",id:"actions",className:"rounded-5 bg-transparent text-muted fa-18 border-0 btn"}),(0,y.jsxs)(N.c.Menu,{children:[(0,y.jsx)("h5",{className:"mb-1 text-primary px-3 fa-18 border-bottom",children:" Teams"}),null===t||void 0===t?void 0:t.InvolvedUsers.map(((e,s)=>(0,y.jsx)("p",{className:"fw-bold text-muted fa-13 mb-0 px-3 py-1 ",children:e.Name},s)))]})]})]}),(0,y.jsx)("div",{className:"chat-body",ref:k,children:Object.entries(C).map((e=>{let[t,l]=e;return(0,y.jsxs)(a.Fragment,{children:[(0,y.jsx)("div",{className:"badge rounded-3 bg-light text-center text-dark mx-auto my-2",children:(new Date).toDateString()===t?"Today":t}),l.map((e=>(0,y.jsxs)("div",{className:"messages ".concat(Number(null===e||void 0===e?void 0:e.User_Id)===Number(null===s||void 0===s?void 0:s.UserId)?"message-right":"message-left"),children:[(0,y.jsx)("p",{className:"fw-bold mb-1 text-primary fa-12",children:Number(null===e||void 0===e?void 0:e.User_Id)===Number(null===s||void 0===s?void 0:s.UserId)?"You":e.Name}),(0,y.jsx)("div",{className:"fa-16 mb-2",children:e.Message}),(0,y.jsx)("p",{className:"fa-11 mb-0 fw-bold ".concat(Number(null===e||void 0===e?void 0:e.User_Id)===Number(null===s||void 0===s?void 0:s.UserId)&&"text-end"," "),children:new Date(e.CreatedAt).toLocaleTimeString("en-IN",{hour:"2-digit",minute:"2-digit"})})]},e.Id)))]},t)}))}),(0,y.jsx)("form",{onSubmit:async e=>{if(e.preventDefault(),""===U.trim())return g.m4.warn("Enter a message"),void D("");(0,I.q)({address:"discussionForum/messages",method:"POST",bodyData:{Topic_Id:null===t||void 0===t?void 0:t.Id,User_Id:null===s||void 0===s?void 0:s.UserId,Message:U}}).then((e=>{e.success?(z(!_),D("")):g.m4.error(e.message)})).catch((e=>console.log(e)))},children:(0,y.jsx)("div",{className:"chat-footer",children:(0,y.jsxs)("div",{className:"input-icon-container",children:[(0,y.jsx)("input",{className:"cus-inpt rounded-5 border-0 outline-none px-3",placeholder:"Type a message",autoFocus:!0,required:!0,value:U,onChange:e=>D(e.target.value),onInvalid:e=>e.target.setCustomValidity("Type a message"),onInput:e=>e.target.setCustomValidity("")}),(0,y.jsx)(i.c,{title:"Upload Files",children:(0,y.jsx)(d.c,{onClick:()=>M(!0),type:"button",children:(0,y.jsx)(p.c,{})})}),(0,y.jsx)(i.c,{title:"Send Message",children:(0,y.jsx)(d.c,{type:"submit",children:(0,y.jsx)(v.c,{})})})]})})}),(0,y.jsxs)(n.c,{open:A,onClose:L,fullWidth:!0,maxWidth:"sm",children:[(0,y.jsx)(r.c,{children:"Share Files"}),(0,y.jsxs)("form",{onSubmit:B,children:[(0,y.jsx)(o.c,{children:(0,y.jsx)("input",{type:"file",className:"cus-inpt ",required:!0,onChange:e=>E(e.target.files[0])})}),(0,y.jsxs)(u.c,{children:[(0,y.jsx)(m.c,{onClick:L,type:"button",children:"close"}),(0,y.jsx)(m.c,{onClick:B,disabled:0!==O,type:"submit",children:"Upload"})]})]})]}),(0,y.jsxs)(n.c,{open:R,onClose:()=>W(!1),fullWidth:!0,maxWidth:F.length>0?"lg":"sm",children:[(0,y.jsx)(r.c,{children:"Shared Documents"}),(0,y.jsx)(o.c,{children:F.length>0?(0,y.jsx)("div",{className:"table-responsive",children:(0,y.jsxs)("table",{className:"table",children:[(0,y.jsx)("thead",{children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{className:"fa-14",children:"S.No"}),(0,y.jsx)("th",{className:"fa-14",children:"File Name"}),(0,y.jsx)("th",{className:"fa-14",children:"Size"}),(0,y.jsx)("th",{className:"fa-14",children:"Type"}),(0,y.jsx)("th",{className:"fa-14",children:"Date"}),(0,y.jsx)("th",{className:"fa-14"})]})}),(0,y.jsx)("tbody",{children:F.map(((e,t)=>(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"fa-14",children:t+1}),(0,y.jsx)("td",{className:"fa-14",children:null===e||void 0===e?void 0:e.FileName}),(0,y.jsxs)("td",{className:"fa-14",children:[null!==e&&void 0!==e&&e.FileSize?((null===e||void 0===e?void 0:e.FileSize)/1024/1024).toFixed(2):0," MB"]}),(0,y.jsx)("td",{className:"fa-14",children:null===e||void 0===e?void 0:e.FileType}),(0,y.jsx)("td",{className:"fa-14",children:null===e||void 0===e?void 0:e.SendDate}),(0,y.jsx)("td",{className:"fa-14",children:(0,y.jsx)(d.c,{className:"text-primary",size:"small",onClick:()=>(async e=>{try{const t=await(0,I.q)({address:"discussionForum/files/download?FileId=".concat(e),headers:{"Content-Type":"application/octet-stream",Authorization:s.Autheticate_Id}}),a=await t.blob(),l=window.URL.createObjectURL(a),c=document.createElement("a");c.href=l,c.setAttribute("download","file_".concat(e)),document.body.appendChild(c),c.click(),c.parentNode.removeChild(c)}catch(t){console.error("Download Error",t)}})(e.FileId),children:(0,y.jsx)(f.c,{})})})]},t)))})]})}):(0,y.jsx)("h5",{className:"text-center text-muted my-5",children:"No Documents Available"})}),(0,y.jsx)(u.c,{children:(0,y.jsx)(m.c,{onClick:()=>W(!1),children:"Close"})})]})]})}}}]);
//# sourceMappingURL=3524.eedd9ae3.chunk.js.map