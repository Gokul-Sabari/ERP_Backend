"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[9252],{19252:(e,s,a)=>{a.r(s),a.d(s,{default:()=>ee});var n=a(69060),o=a(1908),t=a(56480),i=a(96464),l=a(84936),r=a(27454),c=a(58612),d=a(12572),u=a(3358),m=a(5548),h=a(44380),p=a(9572),x=a(56880),g=a(27532),j=a(89e3),f=a(93996),y=a(82656),v=a(26773),C=a(4488),b=a(90048),w=a(63468),I=a(43692),_=a(78092),k=a(85624),S=a(99904),N=a(33856),P=a(29504),A=a(5930),E=a(4016),L=a(60204),z=a(21420),D=a(12556),T=a(70296),O=a(83532),$=a(37956),F=a(80156),U=a(57704),R=a(12120),M=a(49608),B=a(23152),W=a(35064),q=a(36992),H=a(86e3),J=a(39308),V=a(35832),G=a(79476),K=a(82496);const Q=(0,D.cp)(i.c)((e=>{let{theme:s}=e;return{[`&.${l.c.head}`]:{backgroundColor:"#EDF0F7",color:"#000000",fontWeight:"bold",borderRight:"1px solid #e0e0e0","&:last-child":{borderRight:"none"}},[`&.${l.c.body}`]:{fontSize:14,padding:"12px 16px",borderRight:"1px solid #e0e0e0","&:last-child":{borderRight:"none"}}}})),X=(0,D.cp)(r.c)((e=>{let{highlight:s}=e;return{backgroundColor:s?"#84EAB3":"#fff",...s&&{borderLeft:"4px solid #1976d2"},"&:hover":{backgroundColor:s?"#84EAB5":"#f5f5f5"}}})),Y=(0,D.cp)("div")({display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"16px",padding:"16px",backgroundColor:"#f5f5f5",borderTop:"1px solid #e0e0e0"}),Z=["Ledger_Name","Ledger_Alias"];const ee=function(e){let{loadingOn:s,loadingOff:a}=e;const[i,l]=(0,n.useState)([]),[D,ee]=(0,n.useState)([]),[se,ae]=(0,n.useState)(0),[ne,oe]=(0,n.useState)(5),[te,ie]=(0,n.useState)([]),[le,re]=(0,n.useState)(!1),[ce,de]=(0,n.useState)([]),[ue,me]=(0,n.useState)([]),[he,pe]=(0,n.useState)([]),[xe,ge]=(0,n.useState)(!1),[je,fe]=(0,n.useState)({}),[ye,ve]=(0,n.useState)({}),[Ce,be]=(0,n.useState)(""),[we,Ie]=(0,n.useState)({key:null,direction:"asc"}),[_e,ke]=(0,n.useState)(!1),[Se,Ne]=(0,n.useState)({}),Pe=(0,J.gV)().user,Ae=JSON.parse(localStorage.getItem("user")),[Ee,Le]=(0,n.useState)(!1),[ze,De]=(0,n.useState)(null),[Te,Oe]=(0,n.useState)(!1),[$e,Fe]=(0,n.useState)(!1),[Ue,Re]=(0,n.useState)([]);(0,n.useEffect)((()=>{(async()=>{try{const e=await(0,o.q)({address:`masters/columns/dropDown?company_id=${null===Ae||void 0===Ae?void 0:Ae.companyId}`});e.success&&me(e.data)}catch(e){console.error("Error fetching columns:",e)}})()}),[null===Ae||void 0===Ae?void 0:Ae.companyId]),(0,n.useEffect)((()=>{!async function(){try{Oe(!0),s();const e=await(0,o.q)({address:`masters/displayColumn?company_id=${null===Ae||void 0===Ae?void 0:Ae.companyId}`});if(!e.success||!Array.isArray(e.data))return void console.error("No display columns found");const a=[...e.data].sort(((e,s)=>e.Position-s.Position));ie(a),de([...a]);const n=a.filter((e=>1===e.status&&!["Auto_Id","Ledger_Tally_Id"].includes(e.ColumnName))).sort(((e,s)=>e.Position-s.Position)).map((e=>({header:e.Alias_Name||e.ColumnName,accessor:e.ColumnName,position:e.Position})));ee(n);const t=await(0,o.q)({address:"masters/getlolDetails"});if(t.success&&Array.isArray(t.data)){pe(t.data);const e=n.map((e=>e.accessor)),s=t.data.map((s=>{const a={};return e.forEach((e=>{a[e]=s[e]||""})),a}));l(s)}}catch(e){console.error("Error loading data:",e)}finally{Oe(!1),a()}}()}),[$e,xe,null===Ae||void 0===Ae?void 0:Ae.companyId]);const Me=e=>{const s=te.find((s=>s.Id===e));return!!s&&1===s.status},Be=()=>{Le(!1),De(null),Oe(!1)},We=(e,s)=>{fe((a=>({...a,[e]:s})))},qe=(0,n.useMemo)((()=>{let e=[...he];if(Ce){const s=Ce.split(",").map((e=>e.trim().toLowerCase())).filter(Boolean);e=e.filter((e=>s.some((s=>Object.values(e).some((e=>String(e).toLowerCase().includes(s)))))))}return e=e.filter((e=>Object.keys(ye).every((s=>!ye[s]||String(e[s]).toLowerCase().includes(String(ye[s]).toLowerCase()))))),we.key&&e.sort(((e,s)=>e[we.key]<s[we.key]?"asc"===we.direction?-1:1:e[we.key]>s[we.key]?"asc"===we.direction?1:-1:0)),e}),[he,Ce,ye,we]);return(0,K.jsxs)(d.c,{sx:{p:3,backgroundColor:"white",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,K.jsxs)(d.c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,K.jsx)(x.c,{variant:"h5",children:"LOL List"}),(0,K.jsxs)(d.c,{sx:{display:"flex",alignItems:"center"},children:[Ue.length>0&&(0,K.jsx)(g.c,{label:`SELECTED ROWS : ${Ue.length} `,color:"primary",size:"small",sx:{mr:2}}),(0,K.jsx)(h.c,{variant:"outlined",size:"small",placeholder:"Search...",value:Ce,onChange:e=>be(e.target.value),sx:{width:250,mr:2,"& .MuiInputBase-root":{height:32}},InputProps:{startAdornment:(0,K.jsx)(p.c,{position:"start",children:(0,K.jsx)(U.c,{})}),endAdornment:Ce&&(0,K.jsx)(p.c,{position:"end",children:(0,K.jsx)(m.c,{size:"small",onClick:()=>be(""),children:(0,K.jsx)(F.c,{fontSize:"small"})})})}}),(0,K.jsx)(u.c,{title:"Column Settings",children:(0,K.jsx)(m.c,{onClick:()=>re(!0),children:(0,K.jsx)(R.c,{})})}),(0,K.jsx)(j.c,{variant:"contained",startIcon:(0,K.jsx)(U.c,{}),onClick:()=>{ve({...je}),ae(0)},disabled:0===Object.keys(je).length,sx:{ml:2},children:"Apply Filters"}),(0,K.jsx)(j.c,{variant:"outlined",startIcon:(0,K.jsx)(F.c,{}),onClick:()=>{fe({}),ve({}),be(""),ae(0)},disabled:0===Object.keys(ye).length&&!Ce,sx:{ml:1},children:"Clear All"}),(0,K.jsxs)(f.c,{onClick:()=>((e,s)=>{try{if(!Array.isArray(e)||!Array.isArray(s))throw new Error("Invalid data: columns and selectedRows must be arrays");const a=e.filter((e=>"Auto_Id"!==e.accessor&&"Ledger_Tally_Id"!==e.accessor)),n=[a.map((e=>"string"!==typeof e.header?(console.warn("Missing or invalid header for column:",e),"UNNAMED_COLUMN"):e.header)),...s.map((e=>a.map((s=>{var a;return null!==(a=e[s.accessor])&&void 0!==a?a:""}))))],o=V.c$.aoa_to_sheet(n),t=V.c$.book_new();V.c$.book_append_sheet(t,o,"SelectedData");const i=(new Date).toISOString().slice(0,10);V.a8(t,`selected_data_${i}.xlsx`)}catch(a){console.error("Excel export failed:",a),alert(`Export failed: ${a.message}`)}})(D,Ue),children:[(0,K.jsx)(M.c,{fontSize:"small",sx:{mr:1}})," Download"," "]}),(0,K.jsxs)(f.c,{onClick:()=>{Le(!0)},children:[(0,K.jsx)(B.c,{fontSize:"small",sx:{mr:1}}),"Upload"]}),(0,K.jsxs)(y.c,{open:Ee,fullWidth:!0,children:[(0,K.jsx)(v.c,{children:"Upload Excel File"}),(0,K.jsx)(C.c,{children:(0,K.jsxs)(d.c,{sx:{display:"flex",alignItems:"center",gap:2,mt:2},children:[(0,K.jsxs)(j.c,{variant:"contained",component:"label",children:["Browse",(0,K.jsx)("input",{type:"file",accept:".xls,.xlsx",hidden:!0,onChange:e=>{const s=e.target.files[0];s.size>5242880?alert("File size exceeds 5MB"):De(s)}})]}),(0,K.jsx)(x.c,{children:ze?ze.name:"No file selected"})]})}),(0,K.jsxs)(b.c,{children:[(0,K.jsx)(j.c,{onClick:Be,children:"Cancel"}),(0,K.jsx)(j.c,{onClick:async()=>{if(ze)try{Oe(!0),await(async e=>{try{const s=new FormData;s.append("file",e),s.append("company_id",null===Ae||void 0===Ae?void 0:Ae.Company_id),s.append("Created_By",null===Ae||void 0===Ae?void 0:Ae.UserId),s.append("isRetailer","1");const a=await fetch(`${G.c}masters/uploadExcel`,{method:"POST",body:s,headers:{Db:null===Pe||void 0===Pe?void 0:Pe.Company_id}});if(!a.ok){const e=await a.json().catch((()=>({})));throw new Error(e.message||"Upload failed")}const n=await a.json();return Oe(!1),n}catch(s){throw Oe(!1),console.error("Upload Error:",{message:s.message,stack:s.stack,time:(new Date).toISOString()}),new Error(`Upload failed: ${s.message}`)}})(ze),Be(),Fe((e=>!e)),t.m4.success("File uploaded successfully")}catch(e){t.m4.error(`Upload failed: ${e.message}`)}finally{Oe(!1)}},variant:"contained",disabled:!ze||Te,startIcon:Te?(0,K.jsx)(w.c,{size:20,color:"inherit"}):null,children:Te?"Uploading...":"Upload"})]})]})]})]}),(0,K.jsxs)(y.c,{open:le,onClose:()=>re(!1),maxWidth:"lg",fullWidth:!0,children:[(0,K.jsx)(v.c,{children:"Column Settings"}),(0,K.jsx)(C.c,{children:(0,K.jsx)("div",{className:"row",children:ue.sort(((e,s)=>e.Position-s.Position)).map((e=>{var s,a;return(0,K.jsx)("div",{className:"col-lg-4 col-md-6 p-2",children:(0,K.jsx)(I.c,{className:"p-2",children:(0,K.jsxs)("div",{className:"d-flex justify-content-between align-items-center flex-wrap",children:[(0,K.jsx)(_.c,{checked:Me(e.Id),onChange:s=>((e,s)=>{const a=ue.find((s=>s.Id===e));if((null===a||void 0===a?void 0:a.Position)<=5)return void t.m4.error("First 5 columns cannot be disabled");let n;if(te.some((s=>s.Id===e)))n=te.map((a=>a.Id===e?{...a,status:s?1:0}:a));else{const a=ue.find((s=>s.Id===e));n=a?[...te,{...a,status:s?1:0}]:[...te]}n.sort(((e,s)=>e.Position-s.Position)),ie(n)})(e.Id,s.target.checked),disabled:e.Position<=5,color:e.Position<=5?"default":"primary"}),(0,K.jsx)("div",{children:null===e||void 0===e?void 0:e.ColumnName}),(0,K.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,K.jsx)(h.c,{type:"number",size:"small",variant:"outlined",value:null!==(s=e.Position)&&void 0!==s?s:0,onChange:s=>((e,s)=>{const a=parseInt(s);isNaN(a)||me((s=>s.map((s=>s.Id===e?{...s,Position:a}:s))))})(e.Id,s.target.value),sx:{width:"70px"},inputProps:{min:1,readOnly:Z.includes(e.ColumnName)},disabled:Z.includes(e.ColumnName)}),(0,K.jsx)(h.c,{size:"small",variant:"outlined",value:null!==(a=e.Alias_Name)&&void 0!==a?a:"",onChange:s=>{return!Z.includes(e.ColumnName)&&(a=e.Id,n=s.target.value,void me((e=>e.map((e=>e.Id===a?{...e,Alias_Name:n}:e)))));var a,n},sx:{"& .MuiInputBase-input":{cursor:Z.includes(e.ColumnName)?"default":"text",backgroundColor:Z.includes(e.ColumnName)?"#f5f5f5":"inherit"}},inputProps:{readOnly:Z.includes(e.ColumnName)},disabled:Z.includes(e.ColumnName)})]})]})})},e.Id)}))})}),(0,K.jsxs)(b.c,{children:[(0,K.jsx)(j.c,{onClick:()=>{ie([...ce]),me([...ce])},variant:"outlined",children:"Reset"}),(0,K.jsx)(j.c,{onClick:()=>re(!1),color:"error",children:"Close"}),(0,K.jsx)(j.c,{onClick:async()=>{ge(!0);try{const e=te.map((e=>{const s=ue.find((s=>s.Id===e.Id));return s?{...e,Position:s.Position,Alias_Name:s.Alias_Name}:e})),s={},a=new Set;if(e.forEach((e=>{s[e.Position]&&a.add(e.Position),s[e.Position]=!0})),a.size>0){const e=Array.from(a).join(", ");return void t.m4.error(`Duplicate positions found: ${e}`)}ie(e),de(e);const n=await(0,o.q)({address:"masters/updateColumnChanges",method:"PUT",bodyData:{columns:e.map((e=>({id:e.Id,status:e.status,position:e.Position,alias_name:e.Alias_Name,column_name:e.ColumnName}))),company_id:null===Ae||void 0===Ae?void 0:Ae.companyId}});if(!n.success)throw new Error(n.message||"Failed to update column statuses");const i=e.filter((e=>1===e.status)).sort(((e,s)=>e.Position-s.Position)).map((e=>({header:e.Alias_Name||e.ColumnName,accessor:e.ColumnName,position:e.Position})));if(ee(i),he.length>0){const e=i.map((e=>e.accessor)),s=he.map((s=>{const a={};return e.forEach((e=>{a[e]=s[e]||""})),a}));l(s)}re(!1),t.m4.success("Changes Saved")}catch(e){console.error("Error updating column statuses:",e),t.m4.error(e.message||"Failed to update columns. Please try again.")}finally{ge(!1)}},variant:"contained",color:"primary",disabled:xe,children:xe?"Applying...":"Apply"})]})]}),(0,K.jsxs)(y.c,{open:_e,onClose:()=>ke(!1),maxWidth:"md",fullWidth:!0,children:[(0,K.jsx)(v.c,{children:"Edit Row"}),(0,K.jsx)("div",{className:"container-fluid",style:{maxHeight:"80vh",overflow:"auto"},children:(0,K.jsx)("div",{className:"row g-3",children:D.map((e=>(0,K.jsx)("div",{className:"col-12 col-sm-6 col-md-4",children:(0,K.jsxs)("div",{className:"form-group",children:[(0,K.jsx)("label",{className:"form-label",children:e.header}),(0,K.jsx)("input",{type:"text",className:"form-control form-control-lg",value:Se[e.accessor]||"",onChange:s=>Ne({...Se,[e.accessor]:s.target.value}),disabled:"Auto_Id"===e.accessor||"Ledger_Tally_Id"===e.accessor||"Ledger_Name"===e.accessor,style:{padding:"1rem 1rem",fontSize:"1rem"}})]})},e.accessor)))})}),(0,K.jsxs)(b.c,{children:[(0,K.jsx)(j.c,{onClick:()=>ke(!1),variant:"outlined",startIcon:(0,K.jsx)(W.c,{}),children:"Cancel"}),(0,K.jsx)(j.c,{onClick:async()=>{try{const e=await(0,o.q)({address:"masters/updateDetails",method:"PUT",bodyData:Se,headers:{Db:null===Pe||void 0===Pe?void 0:Pe.Company_id}});if(!e.success)throw new Error(e.message||"Failed to update row");pe((e=>e.map((e=>e.Auto_Id===Se.Auto_Id?Se:e)))),l((e=>e.map((e=>e.Auto_Id===Se.Auto_Id?Se:e)))),ke(!1),t.m4.success("Data updated successfully")}catch(e){console.error("Error updating row:",e),t.m4.error("Failed to update row")}},variant:"contained",color:"primary",startIcon:(0,K.jsx)(q.c,{}),children:"Save Changes"})]})]}),D.length>0&&he.length>0?(0,K.jsxs)(k.c,{elevation:0,sx:{border:"1px solid #e0e0e0"},children:[(0,K.jsx)(S.c,{children:(0,K.jsxs)(N.c,{stickyHeader:!0,"aria-label":"ledger table",sx:{minWidth:650},children:[(0,K.jsx)(c.c,{children:(0,K.jsxs)(r.c,{children:[(0,K.jsx)(Q,{align:"center",sx:{width:"80px"},children:"S.No"}),(0,K.jsx)(Q,{align:"center",sx:{width:"80px"},children:"CheckBox"}),(0,K.jsx)(Q,{align:"center",sx:{width:"80px"},children:"Actions"}),D.map((e=>(0,K.jsxs)(Q,{align:"center",children:[(0,K.jsxs)(d.c,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.header,(0,K.jsx)(u.c,{title:"Sort "+(we.key===e.accessor&&"asc"===we.direction?"Descending":"Ascending"),children:(0,K.jsx)(m.c,{size:"small",onClick:()=>(e=>{let s="asc";we.key===e&&"asc"===we.direction&&(s="desc"),Ie({key:e,direction:s})})(e.accessor),color:we.key===e.accessor?"primary":"default",children:we.key===e.accessor?"asc"===we.direction?(0,K.jsx)(T.c,{}):(0,K.jsx)(O.c,{}):(0,K.jsx)($.c,{})})})]}),(0,K.jsx)(h.c,{size:"small",variant:"outlined",placeholder:"Filter...",value:je[e.accessor]||"",onChange:s=>We(e.accessor,s.target.value),sx:{width:"100%",mt:1},InputProps:{endAdornment:je[e.accessor]&&(0,K.jsx)(p.c,{position:"end",children:(0,K.jsx)(m.c,{size:"small",onClick:()=>We(e.accessor,""),children:(0,K.jsx)(F.c,{fontSize:"small"})})})}})]},e.accessor)))]})}),(0,K.jsx)(P.c,{children:qe.slice(se*ne,se*ne+ne).map(((e,s)=>(0,K.jsxs)(X,{highlight:1===e.Is_Tally_Updated,children:[(0,K.jsx)(Q,{align:"center",children:se*ne+s+1}),(0,K.jsx)(Q,{children:(0,K.jsx)(m.c,{children:(0,K.jsx)("input",{type:"checkbox",checked:Ue.some((s=>s.Ledger_Tally_Id===e.Ledger_Tally_Id)),onChange:()=>(e=>{Re((s=>s.some((s=>s.Ledger_Tally_Id===e.Ledger_Tally_Id))?s.filter((s=>s.Ledger_Tally_Id!==e.Ledger_Tally_Id)):[...s,e]))})(e),onFocus:e=>e.target.blur(),style:{transform:"scale(1.5)",width:"14px",height:"20px"}})})}),(0,K.jsx)(Q,{align:"center",children:(0,K.jsx)(u.c,{title:"Edit",children:(0,K.jsx)(m.c,{onClick:()=>{return s=e,Ne({...s}),void ke(!0);var s},color:"primary",size:"small",sx:{"&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)",transform:"scale(1.1)"},transition:"transform 0.2s"},children:(0,K.jsx)(H.c,{fontSize:"small"})})})}),D.map((a=>(0,K.jsx)(Q,{align:"center",children:e[a.accessor]},`${s}-${a.accessor}`)))]},s)))})]})}),(0,K.jsxs)(Y,{children:[(0,K.jsx)(A.c,{component:"div",count:qe.length,rowsPerPage:ne,page:se,onPageChange:(e,s)=>{ae(s)},rowsPerPageOptions:[],sx:{"& .MuiTablePagination-toolbar":{padding:0,minHeight:"auto"},"& .MuiTablePagination-spacer":{display:"none"},"& .MuiTablePagination-actions":{marginLeft:"16px"}}}),(0,K.jsxs)(E.c,{variant:"outlined",size:"small",sx:{minWidth:120},children:[(0,K.jsx)(L.c,{children:"Rows per page"}),(0,K.jsx)(z.c,{value:ne,onChange:e=>{oe(parseInt(e.target.value,10)),ae(0)},label:"Rows per page",children:(()=>{const e=[5,10,15,30,60,120,240],s=Math.max(...e);return i.length>s?[...e]:e})().map((e=>(0,K.jsx)(f.c,{value:e,children:e},e)))})]})]})]}):(0,K.jsx)(x.c,{children:"Loading..."})]})}}}]);
//# sourceMappingURL=9252.282fb4d3.chunk.js.map