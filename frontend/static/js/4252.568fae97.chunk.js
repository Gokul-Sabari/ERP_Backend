"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[4252],{62344:(e,l,a)=>{a.d(l,{o$:()=>s,o5:()=>o,cF:()=>i,iI:()=>r,_8:()=>n});const t=a.p+"static/media/smt.aa4d4f940bbebff07a57.png",r={table:{style:{width:"auto",backgroundColor:"transparent"}},rows:{style:{backgroundColor:"transparent"}},headCells:{style:{backgroundColor:"#6b9080f8",color:"white",fontSize:"14px"}}},i={menu:(e,l)=>({...e,zIndex:9999}),menuPortal:e=>({...e,zIndex:9999}),groupHeading:e=>({...e,backgroundColor:"#f5f5f5",color:"#333",fontWeight:"bold",fontSize:"14px",padding:"8px 12px",borderBottom:"1px solid #ddd",textTransform:"uppercase"}),option:(e,l)=>({...e,backgroundColor:l.isSelected?"#2684FF":l.isFocused?"#E2ECF9":"white",color:l.isSelected?"white":"#333",padding:"10px 12px"})},s=[{id:1,headname:"Menu ID",variant:"head",align:"left",width:100},{id:2,headname:"MenuName"},{id:3,headname:"Read Rights"},{id:4,headname:"Add Rights"},{id:5,headname:"Edit Rights"},{id:6,headname:"Delete Rights"},{id:7,headname:"Print Rights"},{id:8,headname:"Action"}],o=[{dataBase:1,name:"SHANKAR TRADERS",business:"Wholesale Merchant in Dhall",address:"32, Chitrakara Street, Madurai - 01 <br /> Bill of Supply -Disclaimer Affidavlt Field Extemped",logo:t,gstin:"33AADFS6973R1ZD",phone:"984-313-1353, 984-335-5166",fssai:"12418012000818",bankAccount:"0021 5032 0885 122",ifsc:"TMBL0000002"},{dataBase:2,name:"SMT AGRO PRODUCTS",business:"",address:"H.O: 153, Chitrakara Street, 2nd Floor, Madurai -01 <br /> G.O: 746 Puliyur, Sayanapuram, Svga <br /> Bill of Supply -Disclaimer Affidavlt Field Extemped",logo:t,gstin:"33ACMFS3420Q1ZQ",phone:"0452-4371625",fssai:"12418012000818",bankAccount:"0025 3031 0875 947",ifsc:"TMBL0000002"},{dataBase:3,name:"BHAVANI TRADERS",business:"",address:"H.O: 152-A, Chitrakara Street, Madurai -01 <br /> G.O: 30/1-Rajman Nagar, Chintamani Main Road, Mdu-01 <br /> Tax Invoice",logo:t,gstin:"33AAEFB6728J1ZG",phone:"958-559-7641, 958-559-7614",fssai:"12418012000670",bankAccount:"0021 5005 0800 309",ifsc:"TMBL0000002"}],n=[{name:"PURCHASE_ORDER"},{name:"PURCHASE_INVOICE"},{name:"SALE_ORDER"},{name:"SALE_INVOICE"},{name:"JOURNAL"},{name:"STOCK_JOURNAL"},{name:"PAYMENT"},{name:"RECEIPT"},{name:"CONTRA"}]},28082:(e,l,a)=>{a.r(l),a.d(l,{default:()=>H});var t=a(69060),r=a(1908),i=a(39308),s=a(44380),o=a(12572),n=a(85624),d=a(67828),c=a(56880),g=a(89e3),h=a(77828),u=a(15786),m=a(99904),x=a(33856),p=a(58612),y=a(27454),b=a(96464),j=a(29504),k=a(5930),v=a(5548),f=a(3358),_=a(60476),A=a(82656),F=a(4488),N=a(90048),C=a(26773),T=a(75848),D=a(61988),B=a(36992),S=a(41459),I=a(46864),R=a(35064),P=a(86e3),w=a(74912),V=a(99852),E=a(62344),L=a(56480),Q=a(35372),$=a(21784),O=a(14499),z=a(49608),M=a(33452),G=a(82496);const W=e=>{var l,a,r;let{open:s,onClose:o,brokerData:n,transactionType:d,fromDate:c,toDate:h}=e;const u=(0,t.useRef)(null),m=(0,M.useReactToPrint)({content:()=>u.current}),x=(null===n||void 0===n?void 0:n.Items)||[];let p=0;p="salesNagal"===d?x.reduce(((e,l)=>e+parseFloat(l.Brok_Amt||0)),0):x.reduce(((e,l)=>e+parseFloat(l.Brokerage||0)),0);const y=x.reduce(((e,l)=>e+parseFloat(l.Coolie_Amt||0)),0),b=parseFloat((null===n||void 0===n?void 0:n.Total_Amount)||0),j=parseFloat((null===n||void 0===n?void 0:n.VilaiVasi)||0),k=b-p+y-j,f=Math.round(k),_=f-k,T=(()=>{const e=x.reduce(((e,l)=>{const a=Math.round(parseFloat(l.KGS)/parseFloat(l.QTY));return isNaN(a)||(e[a]=(e[a]||0)+parseFloat(l.QTY)),e}),{});return e?Object.entries(e).sort(((e,l)=>{let[a]=e,[t]=l;return a-t})).map((e=>{let[l,a]=e;return`${l}kg - ${a}`})).join(" & "):null})();return(0,G.jsx)(G.Fragment,{children:(0,G.jsxs)(A.c,{open:s,onClose:o,fullWidth:!0,maxWidth:"lg",children:[(0,G.jsxs)(C.c,{children:["salesNagal"===d?"Sales Nakal Report":"Delivery Nakal Report"," : ",null===n||void 0===n?void 0:n.Broker_Name,(0,G.jsx)(v.c,{"aria-label":"close",onClick:o,sx:{position:"absolute",right:8,top:8,color:e=>e.palette.grey[500]},children:(0,G.jsx)(O.c,{})})]}),(0,G.jsxs)(F.c,{ref:u,children:["salesNagal"===d?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsxs)("div",{className:"text-center mb-3",children:[(0,G.jsx)("h4",{children:"Broker Report Page"}),(0,G.jsxs)("p",{className:"mb-0",children:["Date: ",null===n||void 0===n||null===(l=n.Items)||void 0===l||null===(a=l[0])||void 0===a?void 0:a.Date]}),(0,G.jsxs)("p",{className:"mb-0",children:["Broker: ",null===n||void 0===n?void 0:n.Broker_Name]}),T&&(0,G.jsxs)("p",{className:"mb-0",children:["Pack Sizes: ",T]})]}),(0,G.jsxs)("table",{className:"table table-bordered",style:{fontSize:"12px"},children:[(0,G.jsx)("thead",{children:(0,G.jsxs)("tr",{children:[(0,G.jsx)("th",{children:"PARTY NAME"}),(0,G.jsx)("th",{children:"ALIAS NAME"}),(0,G.jsx)("th",{className:"text-end",children:"BILL RATE"}),(0,G.jsx)("th",{className:"text-end",children:"BROKER EXP"}),(0,G.jsx)("th",{className:"text-end",children:"QTY"}),(0,G.jsx)("th",{className:"text-end",children:"KGS"}),(0,G.jsx)("th",{className:"text-end",children:"AMOUNT"}),(0,G.jsx)("th",{className:"text-end",children:"VILAIVAASI"})]})}),(0,G.jsxs)("tbody",{children:[x.map(((e,l)=>(0,G.jsxs)("tr",{children:[(0,G.jsx)("td",{children:e.Retailer_Name||e.Ledger_Name}),(0,G.jsx)("td",{children:e.Short_Name}),(0,G.jsx)("td",{className:"text-end",children:e.Item_Rate}),(0,G.jsx)("td",{className:"text-end",children:(0,i.SA)(e.Brok_Amt||0)}),(0,G.jsx)("td",{className:"text-end",children:e.QTY}),(0,G.jsx)("td",{className:"text-end",children:e.KGS}),(0,G.jsx)("td",{className:"text-end",children:(0,i.SA)(e.Amount)}),(0,G.jsx)("td",{className:"text-end",children:(0,i.SA)(e.Vilaivasi_Rate)})]},l))),(0,G.jsxs)("tr",{children:[(0,G.jsx)("td",{colSpan:"4",className:"text-end fw-bold",children:"TOTAL"}),(0,G.jsx)("td",{className:"text-end fw-bold",children:(null===n||void 0===n?void 0:n.Total_Qty)||0}),(0,G.jsx)("td",{className:"text-end fw-bold",children:(null===n||void 0===n?void 0:n.Total_KGS)||0}),(0,G.jsx)("td",{className:"text-end fw-bold",children:(0,i.SA)((null===n||void 0===n?void 0:n.Total_Amount)||0)}),(0,G.jsx)("td",{className:"text-end fw-bold",children:(0,i.SA)((null===n||void 0===n?void 0:n.VilaiVasi)||0)})]}),(0,G.jsx)("tr",{children:(0,G.jsx)("td",{className:"text-end fw-bold",children:T})})]})]}),(0,G.jsx)("div",{className:"row mt-3",children:(0,G.jsx)("div",{className:"col-6 offset-6",children:(0,G.jsx)("table",{className:"table table-bordered",style:{fontSize:"12px"},children:(0,G.jsxs)("tbody",{children:[(0,G.jsxs)("tr",{children:[(0,G.jsx)("td",{className:"fw-bold",children:"COOLIE"}),(0,G.jsx)("td",{className:"text-end fw-bold",children:(0,i.SA)(y)})]}),(0,G.jsxs)("tr",{children:[(0,G.jsx)("td",{className:"fw-bold",children:"BROKERAGE"}),(0,G.jsxs)("td",{className:"text-end fw-bold",children:["- ",(0,i.SA)(p)]})]}),(0,G.jsxs)("tr",{children:[(0,G.jsx)("td",{className:"fw-bold",children:"VILAIVAASI"}),(0,G.jsxs)("td",{className:"text-end fw-bold",children:["- ",(0,i.SA)(j)]})]}),(0,G.jsxs)("tr",{children:[(0,G.jsx)("td",{className:"fw-bold",children:"ROUNDOFF"}),(0,G.jsx)("td",{className:"text-end fw-bold",children:function(e){const l=Number(e)||0;return`${l>=0?"+":""}${(0,i.SA)(l)}`}(_)})]}),(0,G.jsxs)("tr",{className:"bg-light",children:[(0,G.jsx)("td",{className:"fw-bold",children:"NET TOTAL"}),(0,G.jsx)("td",{className:"text-end fw-bold",children:(0,i.SA)(f)})]})]})})})})]}):(0,G.jsx)(G.Fragment,{children:(0,G.jsxs)("div",{style:{fontFamily:"Arial"},children:[(0,G.jsxs)("div",{style:{textAlign:"center",marginBottom:"20px"},children:[(0,G.jsx)("h3",{style:{marginBottom:"5px"},children:null===n||void 0===n?void 0:n.Broker_Name}),(0,G.jsx)("p",{style:{margin:"5px 0"},children:(null===n||void 0===n||null===(r=n.Items)||void 0===r?void 0:r.length)>0?(0,G.jsxs)(G.Fragment,{children:[c," "," TO "," ",h]}):"No date range available"})]}),(0,G.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:"12px"},children:[(0,G.jsx)("thead",{children:(0,G.jsxs)("tr",{style:{borderBottom:"1px solid #000"},children:[(0,G.jsx)("th",{style:{textAlign:"left",padding:"5px",width:"40%"},children:"NAME"}),(0,G.jsx)("th",{style:{textAlign:"left",padding:"5px",width:"10%"},children:"DATE"}),(0,G.jsx)("th",{style:{textAlign:"left",padding:"5px",width:"20%"},children:"ALIAS NAME"}),(0,G.jsx)("th",{style:{textAlign:"right",padding:"5px",width:"10%"},children:"BAGS"}),(0,G.jsx)("th",{style:{textAlign:"right",padding:"5px",width:"10%"},children:"QTY"}),(0,G.jsx)("th",{style:{textAlign:"right",padding:"5px",width:"10%"},children:"BROKERAGE EXP"})]})}),(0,G.jsxs)("tbody",{children:[x.map(((e,l)=>{var a;return(0,G.jsxs)("tr",{style:{borderBottom:"1px solid #ddd"},children:[(0,G.jsx)("td",{style:{padding:"5px"},children:e.Retailer_Name||e.Ledger_Name}),(0,G.jsx)("td",{style:{padding:"5px"},children:(null===(a=e.Date)||void 0===a?void 0:a.split("T")[0])||""}),(0,G.jsx)("td",{style:{padding:"5px"},children:e.Short_Name}),(0,G.jsx)("td",{style:{padding:"5px",textAlign:"right"},children:e.QTY}),(0,G.jsx)("td",{style:{padding:"5px",textAlign:"right"},children:e.KGS}),(0,G.jsx)("td",{style:{padding:"5px",textAlign:"right"},children:(0,i.SA)(e.Brokerage||0)})]},l)})),(0,G.jsxs)("tr",{style:{fontWeight:"bold",borderTop:"2px solid #000"},children:[(0,G.jsx)("td",{colSpan:"3",style:{padding:"5px",textAlign:"right"},children:"TOTAL"}),(0,G.jsx)("td",{style:{padding:"5px",textAlign:"right"},children:(null===n||void 0===n?void 0:n.Total_Qty)||0}),(0,G.jsx)("td",{style:{padding:"5px",textAlign:"right"},children:(null===n||void 0===n?void 0:n.Total_KGS)||0}),(0,G.jsx)("td",{style:{padding:"5px",textAlign:"right"},children:(0,i.SA)(p)})]})]})]})]})}),(0,G.jsx)("div",{className:"text-center mt-3 small",children:(0,G.jsx)("p",{children:"This is a computer generated report"})})]}),(0,G.jsxs)(N.c,{children:[(0,G.jsx)(g.c,{startIcon:(0,G.jsx)(O.c,{}),variant:"outlined",color:"error",onClick:o,children:"Close"}),(0,G.jsx)(g.c,{startIcon:(0,G.jsx)(z.c,{}),variant:"contained",color:"primary",onClick:m,children:"Download"})]})]})})};var Y=a(85592),K=a.n(Y),U=a(26592);const Z=e=>{let{open:l,onClose:a,brokerData:r,transactionType:i,fromDate:s,toDate:o}=e;const n=(null===r||void 0===r?void 0:r.Items)||[];let d;d="salesNagal"===i?n.reduce(((e,l)=>e+parseFloat(l.Brok_Amt||0)),0):n.reduce(((e,l)=>e+parseInt(l.Brokerage||0)),0);const c=n.reduce(((e,l)=>e+parseFloat(l.Coolie_Amt||0)),0),g=parseFloat((null===r||void 0===r?void 0:r.Total_Amount)||0),h=parseFloat((null===r||void 0===r?void 0:r.VilaiVasi)||0),u=g-d+c-h,m=Math.round(u),x=m-u,p=e=>{const l=Number(e)||0;return(l>=0?"+":"")+l.toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})},y=()=>{const e=n.reduce(((e,l)=>{const a=Math.round(parseFloat(l.KGS)/parseFloat(l.QTY));return isNaN(a)||(e[a]=(e[a]||0)+parseFloat(l.QTY)),e}),{});return Object.entries(e).sort(((e,l)=>{let[a]=e,[t]=l;return a-t})).map((e=>{let[l,a]=e;return`${l}kg - ${a}`})).join(" & ")},b=async()=>{try{var e;const l=new(K().Workbook),a=l.addWorksheet("Brokerage Report");l.created=new Date,l.modified=new Date;const t=a.addRow([(null===r||void 0===r?void 0:r.Broker_Name)||""]);t.font={bold:!0,size:14},t.alignment={horizontal:"center"},a.mergeCells("A1:F1");const i=a.addRow([(null===r||void 0===r||null===(e=r.Items)||void 0===e?void 0:e.length)>0?`${s} TO ${o}`:"No date range available"]);i.font={bold:!0},i.alignment={horizontal:"center"},a.mergeCells("A2:F2"),a.addRow([]);const c=[{header:"NAME",width:50},{header:"DATE",width:10},{header:"ALIAS NAME",width:40},{header:"BAGS",width:10},{header:"QTY",width:10},{header:"BROKERAGE EXP",width:15}];a.addRow(c.map((e=>e.header))).eachCell((e=>{e.font={bold:!0},e.border={top:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}})),c.forEach(((e,l)=>{a.getColumn(l+1).width=e.width})),n.forEach((e=>{var l;const t=a.addRow([e.Retailer_Name||e.Ledger_Name,(null===(l=e.Date)||void 0===l?void 0:l.split("T")[0])||"",e.Short_Name,e.QTY,e.KGS,Number(e.Brokerage||0)]);t.eachCell((e=>{e.font={bold:!0},e.border={top:{style:"thin",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}})),t.getCell(4).alignment={horizontal:"right"},t.getCell(5).alignment={horizontal:"right"},t.getCell(6).alignment={horizontal:"right"}}));const g=a.addRow(["","","TOTAL",Number(null===r||void 0===r?void 0:r.Total_Qty)||0,Number(null===r||void 0===r?void 0:r.Total_KGS)||0,d]);g.eachCell((e=>{e.font={bold:!0},e.border={top:{style:"medium",color:{argb:"FF000000"}},left:{style:"thin",color:{argb:"FF000000"}},bottom:{style:"thin",color:{argb:"FF000000"}},right:{style:"thin",color:{argb:"FF000000"}}}})),g.getCell(4).alignment={horizontal:"right"},g.getCell(5).alignment={horizontal:"right"},g.getCell(6).alignment={horizontal:"right"};const h=await l.xlsx.writeBuffer(),u=new Blob([h],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),m=URL.createObjectURL(u),x=document.createElement("a");x.href=m,x.download=`${null===r||void 0===r?void 0:r.Broker_Name}_${s}_to_${o}.xlsx`,x.click(),setTimeout((()=>{URL.revokeObjectURL(m)}),100)}catch(l){console.error("Error exporting to Excel:",l)}};return(0,t.useEffect)((()=>{l&&("salesNagal"===i?(async()=>{var e,l,a,t;const i=new(K().Workbook),s=i.addWorksheet("Broker Report"),o={style:"thick",color:{argb:"FF000000"}},g={border:{top:o,bottom:o,left:o,right:o}},u=s.addRow([`Broker Report: ${(null===r||void 0===r?void 0:r.Broker_Name)||""} - Date: ${null===r||void 0===r||null===(e=r.Items)||void 0===e||null===(l=e[0])||void 0===l?void 0:l.Date}`]);s.mergeCells(`A${u.number}:H${u.number}`),u.eachCell((e=>{e.style={...g,font:{bold:!0,size:14},alignment:{horizontal:"center"},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FFD9D9D9"}}}})),s.addRow([]);const b=s.addRow(["PARTY NAME","ALIAS NAME","BILL RATE","BROKER EXP","QTY","KGS","AMOUNT","VILAIVAASI"]);s.columns=[{width:50},{width:30},{width:15},{width:15},{width:10},{width:10},{width:15},{width:15}],b.eachCell((e=>{e.style={...g,font:{bold:!0,color:{argb:"FFFFFFFF"},size:12},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FF2F5496"}},alignment:{horizontal:"center",vertical:"middle"}}})),n.forEach(((e,l)=>{const a=s.addRow([e.Retailer_Name||e.Ledger_Name||"",e.Short_Name||"",e.Item_Rate||"",e.Brok_Amt||"",e.QTY||"",e.KGS||"",Number(e.Amount||0),Number(e.Vilaivasi_Rate||0)]);a.eachCell((e=>{e.style={...g,font:{size:11},alignment:{vertical:"middle"},fill:l%2===1?{type:"pattern",pattern:"solid",fgColor:{argb:"FFF2F2F2"}}:void 0}})),a.getCell(7).numFmt="#,##0.00",a.getCell(8).numFmt="#,##0.00"})),s.addRow(["","","","TOTAL",Number((null===r||void 0===r?void 0:r.Total_Qty)||0),Number((null===r||void 0===r?void 0:r.Total_KGS)||0),Number((null===r||void 0===r?void 0:r.Total_Amount)||0),Number((null===r||void 0===r?void 0:r.VilaiVasi)||0)]).eachCell(((e,l)=>{l>=4?(e.style={...g,font:{bold:!0,color:{argb:"FFFFFFFF"}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FF70AD47"}}},l>=5&&(e.numFmt=5===l||6===l?"0.00":"#,##0.00")):e.style=g})),s.addRow([]);const j=s.addRow([`Pack Sizes: ${y()}`]);s.mergeCells(`A${j.number}:H${j.number}`),j.eachCell((e=>{e.style={...g,font:{italic:!0},alignment:{horizontal:"left"}}})),s.addRow([]),[{label:"COOLIE",value:Number(c)},{label:"BROKERAGE",value:Number(-d)},{label:"VILAIVAASI",value:Number(-h)},{label:"ROUNDOFF",value:p(x)},{label:"NET TOTAL",value:Number(m)}].forEach((e=>{const l=s.addRow(["","","","","",e.label,e.value,""]);l.getCell(6).style={...g,font:{bold:!0,color:{argb:"FFFFFFFF"}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FF4472C4"}},alignment:{horizontal:"right"}},l.getCell(7).style={...g,font:{bold:!0,color:{argb:"FF000000"}},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"FFFFC000"}},alignment:{horizontal:"right"},numFmt:"#,##0.00"}})),s.addRow([]),s.addRow([]);const k=await i.xlsx.writeBuffer();(0,U.saveAs)(new Blob([k]),`Broker_Report_${(null===r||void 0===r?void 0:r.Broker_Name)||"Export"}_${null===r||void 0===r||null===(a=r.Items)||void 0===a||null===(t=a[0])||void 0===t?void 0:t.Date}.xlsx`)})().then((()=>{"function"===typeof a&&a()})):("purchase"===i||"sales"===i)&&b().then((()=>{"function"===typeof a&&a()})))}),[l,i]),null};var q=a(45180);const H=e=>{let{loadingOn:l,loadingOff:a}=e;const[O,z]=(0,t.useState)("salesNagal"),[M,Y]=(0,t.useState)({page:0,rowsPerPage:10}),[K,U]=(0,t.useState)({page:0,rowsPerPage:10}),[H,J]=(0,t.useState)(0),[X,ee]=(0,t.useState)({broker:[]}),[le,ae]=(0,t.useState)({deliveryReport:[],brokerageValues:{},filters:{FromDate:(new Date).toISOString().split("T")[0],ToDate:(new Date).toISOString().split("T")[0],Broker:{value:"",label:"ALL Brokers"},refresh:!1,filterDialog:!1},headerVilaiVasi:""}),[te,re]=(0,t.useState)({deliveryReport:[],brokerageValues:{},filters:{FromDate:(new Date).toISOString().split("T")[0],ToDate:(new Date).toISOString().split("T")[0],Broker:{value:"",label:"ALL Brokers"},refresh:!1,filterDialog:!1},headerVilaiVasi:""}),[ie,se]=(0,t.useState)({deliveryReport:[],brokerageValues:{},filters:{FromDate:(new Date).toISOString().split("T")[0],ToDate:(new Date).toISOString().split("T")[0],Broker:{value:"",label:"ALL Brokers"},refresh:!1,filterDialog:!1},headerBrokerage:""}),[oe,ne]=(0,t.useState)({FromDate:(new Date).toISOString().split("T")[0],ToDate:(new Date).toISOString().split("T")[0],Broker:{value:"",label:"ALL Brokers"},Ledger:{value:"",label:"All Ledger"},Item:{value:"",label:"All Item"},VilaiVasiZero:{value:"",label:"All"},refresh:!1,filterDialog:!1}),[de,ce]=(0,t.useState)([]),[ge,he]=(0,t.useState)({ledgers:[],items:[]}),[ue,me]=(0,t.useState)({}),[xe,pe]=(0,t.useState)(!1),ye=JSON.parse(localStorage.getItem("user")),[be,je]=(0,t.useState)(!1),[ke,ve]=(0,t.useState)(!1),[fe,_e]=(0,t.useState)(null),[Ae,Fe]=(0,t.useState)(null),[Ne,Ce]=(0,t.useState)(null),[Te,De]=(0,t.useState)(!1),[Be,Se]=(0,t.useState)(!1),[Ie,Re]=(0,t.useState)(null),[Pe,we]=(0,t.useState)(null),[Ve,Ee]=(0,t.useState)(!1),Le="salesNagal"===O?le:"sales"===O?te:ie,Qe="salesNagal"===O?ae:"sales"===O?re:se;(0,t.useEffect)((()=>{(0,r.q)({address:"reports/brokerageReport/getInvolvedBroker"}).then((e=>{e.success&&ee((l=>({...l,broker:(0,i.dq)(e.data)})))})).catch(console.error)}),[]),(0,t.useEffect)((()=>{(async()=>{try{l();const e="salesNagal"===O?"brokerageNakalReport/sales":"sales"===O?"brokerageNakalReport/salesEntry":"brokerageNakalReport/purchase",a=await(0,r.q)({address:`reports/${e}?FromDate=${Le.filters.FromDate}&ToDate=${Le.filters.ToDate}&broker=${Le.filters.Broker.value}`});if(a.success){const e=(0,i.dq)(a.data),l={};e.forEach((e=>{const a=`${e.Do_Id}-${e.Product_Id}`;l[a]=e.brokerage||""})),Qe((a=>({...a,deliveryReport:e,brokerageValues:l})))}else Qe((e=>({...e,deliveryReport:[],brokerageValues:{}})))}catch(e){console.error(e),Qe((e=>({...e,deliveryReport:[],brokerageValues:{}})))}finally{a()}})()}),[O,Le.filters.refresh]);const $e={salesNagal:{dataEntryColumns:[{label:"Date",key:"Date",align:"left",render:e=>{var l;return(null===(l=e.Date)||void 0===l?void 0:l.split("T")[0])||"N/A"}},{label:"Do No",key:"Do_Inv_No"},{label:"Product",key:"Product_Name"},{label:"Ledger_Name",key:"Retailer_Name"},{label:"Broker",key:"CostCenterGet"},{label:"Act_Qty",key:"Act_Qty",align:"right"},{label:"Qty",key:"displayQuantity",align:"right"},{label:"Rate",key:"Rate",align:"right",render:e=>e.Rate||e.Item_Rate},{label:"Pack",key:"Pack",align:"right"},{label:"Amount",key:"Amount",align:"right"},{label:"Brok.Rate",key:"Brokerage",align:"right",render:(e,l,a)=>(0,G.jsx)(s.c,{size:"small",type:"number",value:e.Brokerage,onChange:e=>a(l,"Brokerage",e.target.value),sx:{width:"80px"},inputProps:{step:"0.01"}})},{label:"Brokerage",key:"BrokerageAmount",align:"right",render:e=>(e.Brokerage*e.displayQuantity).toFixed(2)},{label:"Coolie.Rate",key:"Coolie",align:"right",render:(e,l,a)=>(0,G.jsx)(s.c,{size:"small",type:"number",value:e.Coolie,onChange:e=>a(l,"Coolie",e.target.value),sx:{width:"80px"},inputProps:{step:"0.01"}})},{label:"Coolie.Amt",key:"CoolieAmount",align:"right",render:e=>(e.Coolie*e.displayQuantity).toFixed(2)},{label:"VilaiVasi",key:"VilaiVasi",align:"right",render:(e,l,a,t,r)=>(0,G.jsx)(s.c,{size:"small",type:"number",value:t,onChange:r(e.Do_Id,e.Product_Id),sx:{width:"120px"},inputProps:{step:"0.01"}})},{label:"Narration",key:"Narration",align:"right"},{label:"Vilai Amt",key:"VilaiAmt",align:"right",render:(e,l,a,t,r,i)=>(+i(t,e.Act_Qty)).toFixed(2)}],listingColumns:[{label:"Broker",key:"Broker_Name"},{label:"Total KGS",key:"Total_KGS",align:"right"},{label:"Total Bill Qty",key:"Total_Qty",align:"right"},{label:"Total_Amount",key:"Total_Amount",align:"right"},{label:"Total_Broker_Exp",key:"Broker_Exp",align:"right"},{label:"Total_VilaiVasi",key:"VilaiVasi",align:"right"},{label:"Total_Bags",key:"Total_Bags",align:"right"}]},sales:{dataEntryColumns:[{label:"Date",key:"Date",align:"left",render:e=>{var l;return(null===(l=e.Date)||void 0===l?void 0:l.split("T")[0])||"N/A"}},{label:"Do No",key:"Do_Inv_No"},{label:"Product",key:"Product_Name"},{label:"Ledger_Name",key:"Retailer_Name"},{label:"Broker",key:"CostCenterGet"},{label:"Act_Qty",key:"Act_Qty",align:"right"},{label:"Qty",key:"displayQuantity",align:"right"},{label:"Rate",key:"Rate",align:"right",render:e=>e.Rate||e.Item_Rate},{label:"Pack",key:"Pack",align:"right"},{label:"Amount",key:"Amount",align:"right"},{label:"Brokerage",key:"Brokerage",align:"right",render:(e,l,a,t,r)=>(0,G.jsx)(s.c,{size:"small",type:"number",value:t,onChange:r(e.Do_Id,e.Product_Id),sx:{width:"120px"},inputProps:{step:"0.01"}})},{label:"Brokerage Amt",key:"BrokerageAmount",align:"right",render:(e,l,a,t)=>((parseFloat(t)||0)*(parseFloat(e.Act_Qty)||0)/100).toFixed(2)}],listingColumns:[{label:"Broker",key:"Broker_Name"},{label:"Total KGS",key:"Total_KGS",align:"right"},{label:"Total Bill Qty",key:"Total_Qty",align:"right"},{label:"Total_Amount",key:"Total_Amount",align:"right"},{label:"Total_Broker_Exp",key:"Broker_Exp",align:"right"},{label:"Total_Bags",key:"Total_Bags",align:"right"}]},purchase:{dataEntryColumns:[{label:"Date",key:"Date",align:"left",render:e=>{var l;return(null===(l=e.Po_Entry_Date)||void 0===l?void 0:l.split("T")[0])||"N/A"}},{label:"Invoice No",key:"Po_Inv_No"},{label:"Retailer",key:"Retailer_Name"},{label:"Broker",key:"CostCenterGet",align:"right"},{label:"Product",key:"Product_Name"},{label:"Act_Qty",key:"Act_Qty",align:"right"},{label:"Pack",key:"Pack",align:"right"},{label:"Qty",key:"displayQuantity",align:"right",render:e=>Number(e.displayQuantity).toFixed(2)},{label:"Rate",key:"Item_Rate",align:"right"},{label:"Amount",key:"Total_Invoice_value",align:"right"},{label:"Brokerage",key:"Brokerage",align:"right",render:(e,l,a,t,r)=>(0,G.jsx)(s.c,{size:"small",type:"number",value:t,onChange:r(e.Do_Id,e.Product_Id,e.PIN_Id),sx:{width:"120px"},inputProps:{step:"0.01"}})},{label:"Brokerage Amt",key:"BrokerageAmount",align:"right",render:(e,l,a,t)=>((parseFloat(t)||0)*(parseFloat(e.Act_Qty)||0)/100).toFixed(2)}],listingColumns:[{label:"Supplier",key:"Supplier_Name"},{label:"Total KGS",key:"Total_KGS",align:"right"},{label:"Total Bill Qty",key:"Total_Qty",align:"right"},{label:"Total_Amount",key:"Total_Amount",align:"right"},{label:"Total_Broker_Exp",key:"Broker_Exp",align:"right"},{label:"Total_Bags",key:"Total_Bags",align:"right"}]}};(0,t.useEffect)((()=>{(async()=>{try{l();let e="";"salesNagal"===O?e=`reports/brokerageNagal/list?FromDate=${oe.FromDate}&ToDate=${oe.ToDate}`:"purchase"===O?e=`reports/brokerageNagalDelivery/list?FromDate=${oe.FromDate}&ToDate=${oe.ToDate}`:"sales"===O&&(e=`reports//brokerageNagalSales/list?FromDate=${oe.FromDate}&ToDate=${oe.ToDate}`),oe.Broker.value&&(e+=`&broker=${oe.Broker.value}`),oe.Ledger.value&&(e+=`&ledger=${oe.Ledger.value}`),oe.Item.value&&(e+=`&item=${oe.Item.value}`),oe.VilaiVasiZero.value&&(e+=`&vilaivasiFilter=${oe.VilaiVasiZero.value}`);const a=await(0,r.q)({address:e});if(a.success){const e=(0,i.dq)(a.data);ce(e);const l=e.flatMap((e=>e.Items||[])),t=Array.from(new Map(l.map((e=>[e.Ledger_Tally_Id,{value:e.Ledger_Tally_Id,label:e.Ledger_Name}]))).values()),r=Array.from(new Map(l.map((e=>[e.Product_Id,{value:e.Product_Id,label:e.Product_Name}]))).values());he({ledgers:t,items:r})}}catch(e){console.error(e)}finally{a()}})()}),[oe.refresh,O]);const Oe=async()=>{try{l();const e={...Ne,TransactionType:O,Updated_By:null===ye||void 0===ye?void 0:ye.UserId};console.log("w",Ne),"salesNagal"===O?(e.Brok_Amt=(parseFloat(Ne.Brok_Rate)||0)*(parseFloat(Ne.QTY)||0),e.Coolie_Amt=(parseFloat(Ne.Coolie_Rate)||0)*(parseFloat(Ne.QTY)||0),e.Vilai_Vasi=parseFloat(Ne.Vilai_Vasi)||0,e.Vilaivasi_Rate=(parseFloat(Ne.Vilai_Vasi)||0)*(parseFloat(Ne.QTY)||0)/100):"sales"!==O&&"purchase"!==O||(e.Brokerage_Amt=(parseFloat(Ne.Brokerage)||0)*(parseFloat(Ne.Act_Qty)||0)/100,e.Brokerage=parseFloat(null===Ne||void 0===Ne?void 0:Ne.Act_Qty)/100*Ne.Brokerage_Amt);const a=await(0,r.q)({address:"reports/brokerageNagalPurchase/list",method:"PUT",bodyData:e,headers:{"Content-Type":"application/json"}});a.success?(L.m4.success("Item updated successfully!"),ne((e=>({...e,refresh:!e.refresh}))),Ce(null)):L.m4.error(a.message||"Update failed")}catch(e){L.m4.error("Update failed due to an error")}finally{a()}},ze=(e,l,a)=>t=>{const r=t.target.value,i="salesNagal"===O||"sales"===O?`${e}-${l}`:`${a}-${l}`;Qe((e=>({...e,brokerageValues:{...e.brokerageValues,[i]:r}})))},Me=()=>Qe((e=>({...e,filters:{...e.filters,filterDialog:!1}}))),Ge=()=>ne((e=>({...e,filterDialog:!1}))),We=(e,l,a)=>{const t=[...Le.deliveryReport];t[e][l]=parseFloat(a)||0,Qe((e=>({...e,deliveryReport:t})))},Ye=e=>{z(e),Y({page:0,rowsPerPage:10})},Ke=(0,t.useMemo)((()=>Le.deliveryReport.reduce(((e,l)=>(0,i.Q5)(e,l.displayQuantity||l.Qty||0)),0)),[Le.deliveryReport]),Ue=(0,t.useMemo)((()=>de.reduce(((e,l)=>(0,i.Q5)(e,l.Total_Bags||0)),0)),[de]),Ze=(e,l)=>(parseFloat(e)||0)/100*(parseFloat(l)||0),qe=(0,t.useMemo)((()=>de&&0!==de.length?de.reduce(((e,l)=>{const a=l.Broker_Name||l.Supplier_Name||"Unknown";return e[a]||(e[a]=[]),e[a].push(l),e}),{}):{}),[de]),He=(0,t.useMemo)((()=>Object.keys(qe)),[qe]),Je=(e,l)=>!!e&&(e.Product_Id===l.Product_Id&&e.Do_Inv_No===l.Do_Inv_No&&(e.Ledger_Tally_Id?e.Ledger_Tally_Id===l.Ledger_Tally_Id:e.Ledger_Name===l.Ledger_Name));return(0,G.jsxs)(o.c,{children:[(0,G.jsxs)(n.c,{sx:{p:3,mb:3},children:[(0,G.jsxs)(d.cp,{container:!0,justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,G.jsx)(c.c,{variant:"h5",component:"h2",children:"Brokerage Nagal Report"}),(0,G.jsxs)(o.c,{display:"flex",alignItems:"center",gap:2,children:[(0,G.jsxs)(o.c,{display:"flex",gap:1,children:[(0,G.jsx)(g.c,{variant:"salesNagal"===O?"contained":"outlined",onClick:()=>Ye("salesNagal"),children:"SalesNagal"}),(0,G.jsx)(g.c,{variant:"purchase"===O?"contained":"outlined",onClick:()=>Ye("purchase"),children:"Purchase"}),(0,G.jsx)(g.c,{variant:"sales"===O?"contained":"outlined",onClick:()=>Ye("sales"),children:"Sales"})]}),(0,G.jsx)(g.c,{variant:"outlined",startIcon:(0,G.jsx)(D.c,{}),onClick:()=>{0===H?Qe((e=>({...e,filters:{...e.filters,filterDialog:!0}}))):ne((e=>({...e,filterDialog:!0})))},children:"Filters"}),(0,G.jsxs)(c.c,{component:"span",variant:"body1",children:["Total Bags:"," ",(0,G.jsx)("strong",{children:0===H?Ke:Ue})]})]})]}),(0,G.jsxs)(h.c,{value:H,onChange:(e,l)=>J(l),sx:{mb:3},children:[(0,G.jsx)(u.c,{label:"Data Entry"}),(0,G.jsx)(u.c,{label:"Listing"})]}),0===H&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsxs)(o.c,{mb:1,sx:{display:"flex",justifyContent:"flex-end",alignItems:"center",gap:2},children:[(0,G.jsx)(c.c,{sx:{fontWeight:"bold"},children:"salesNagal"===O?"VilaiVasi (All):":"Brokerage (All):"}),(0,G.jsx)(s.c,{type:"number",size:"small",value:Le.headerVilaiVasi,inputProps:{step:"1"},onChange:e=>{const l=e.target.value;Qe((e=>{const a={...e.brokerageValues};return e.deliveryReport.forEach((e=>{const t="salesNagal"===O||"sales"===O?`${e.Do_Id}-${e.Product_Id}`:`${e.PIN_Id}-${e.Product_Id}`;a[t]=l})),{...e,headerVilaiVasi:l,brokerageValues:a}}))},placeholder:`Set ${"salesNagal"===O?"VilaiVasi":"Brokerage"} for all`,sx:{"& .MuiInputBase-input":{height:40,boxSizing:"border-box"}}}),(0,G.jsx)(g.c,{variant:"outlined",size:"small",onClick:()=>{Qe((e=>{const l={...e.brokerageValues};return e.deliveryReport.forEach((e=>{const a="salesNagal"===O||"sales"===O?`${e.Do_Id}-${e.Product_Id}`:`${e.PIN_Id}-${e.Product_Id}`;l[a]=""})),{...e,headerVilaiVasi:"",brokerageValues:l}}))},children:"Clear All"})]}),(0,G.jsxs)(m.c,{component:n.c,children:[(0,G.jsxs)(x.c,{size:"small",children:[(0,G.jsx)(p.c,{children:(0,G.jsx)(y.c,{sx:{backgroundColor:"primary.main"},children:$e[O].dataEntryColumns.map((e=>(0,G.jsx)(b.c,{sx:{color:"white",fontWeight:"bold"},align:e.align||"left",children:e.label},e.key)))})}),(0,G.jsx)(j.c,{children:Le.deliveryReport.length>0?Le.deliveryReport.slice(M.page*M.rowsPerPage,M.page*M.rowsPerPage+M.rowsPerPage).map(((e,l)=>{const a=Le.brokerageValues["salesNagal"===O||"sales"===O?`${e.Do_Id}-${e.Product_Id}`:`${e.PIN_Id}-${e.Product_Id}`]||"";return(0,G.jsx)(y.c,{hover:!0,children:$e[O].dataEntryColumns.map((t=>(0,G.jsx)(b.c,{align:t.align||"left",children:t.render?t.render(e,l,We,a,ze,Ze):e[t.key]},t.key)))},l)})):(0,G.jsx)(y.c,{children:(0,G.jsx)(b.c,{colSpan:$e[O].dataEntryColumns.length,align:"center",children:"No data found"})})})]}),(0,G.jsx)(k.c,{rowsPerPageOptions:[10,25,50,100],component:"div",count:Le.deliveryReport.length,rowsPerPage:M.rowsPerPage,page:M.page,onPageChange:(e,l)=>Y({...M,page:l}),onRowsPerPageChange:e=>Y({page:0,rowsPerPage:parseInt(e.target.value,10)})})]}),(0,G.jsx)(o.c,{sx:{mt:3,display:"flex",justifyContent:"flex-end"},children:(0,G.jsx)(g.c,{variant:"contained",color:"primary",startIcon:(0,G.jsx)(B.c,{}),onClick:async()=>{l();try{pe(!0);const e=Le.deliveryReport.map((e=>{const l="salesNagal"===O||"sales"===O?`${e.Do_Id}-${e.Product_Id}`:`${e.PIN_Id}-${e.Product_Id}`,a=Le.brokerageValues[l]||e.Brokerage||0;return"salesNagal"===O?{...e,brokerage:parseFloat(a)||0,Vilai_Vasi:parseFloat(a)||0,Vilaivasi_Rate:(parseFloat(a)||0)/100*(parseFloat(e.Act_Qty)||0),Brok_Rate:(null===e||void 0===e?void 0:e.Brokerage)||0,Brok_Amt:((null===e||void 0===e?void 0:e.Brokerage)||0)*((null===e||void 0===e?void 0:e.displayQuantity)||0),Coolie_Rate:(null===e||void 0===e?void 0:e.Coolie)||0,Coolie_Amt:((null===e||void 0===e?void 0:e.Coolie)||0)*((null===e||void 0===e?void 0:e.displayQuantity)||0),Amount:(null===e||void 0===e?void 0:e.Amount)||0,Created_By:null===ye||void 0===ye?void 0:ye.UserId}:{...e,brokerage:(parseFloat(a)||0)*(parseFloat(e.Act_Qty)||0)/100,Created_By:null===ye||void 0===ye?void 0:ye.UserId}}));let l;l="salesNagal"===O?"reports/brokerageNagal/create":"sales"===O?"reports/brokerageNagal/createSales":"reports/brokerageNakal/deliveryCreate";const a=await(0,r.q)({address:l,method:"POST",bodyData:e,headers:{"Content-Type":"application/json"}});if(a.success){let e;e="salesNagal"===O?"Sales Nagal created successfully!":"sales"===O?"Sales brokerage created successfully!":"Purchase nakal created successfully!",L.m4.success(e),Qe((e=>({...e,filters:{...e.filters,refresh:!e.filters.refresh}})))}else L.m4.error(a.message||"Save operation failed")}catch(e){console.error("Save error:",e),L.m4.error("Save failed due to an error")}finally{pe(!1),a()}},disabled:xe,size:"large",children:xe?"Saving...":`Save ${"salesNagal"===O?"sales"===O?"Sales":"Purchase":"Sales Nagal"} Brokerage`})})]}),1===H&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(o.c,{sx:{mb:2,display:"flex",justifyContent:"flex-end"},children:(0,G.jsx)(g.c,{variant:"outlined",color:"error",startIcon:(0,G.jsx)(q.c,{}),onClick:()=>Ee(!0),disabled:0===de.length,children:"Delete All"})}),(0,G.jsxs)(m.c,{component:n.c,children:[(0,G.jsxs)(x.c,{size:"small",children:[(0,G.jsx)(p.c,{children:(0,G.jsxs)(y.c,{sx:{backgroundColor:"primary.main"},children:[$e[O].listingColumns.map((e=>(0,G.jsx)(b.c,{sx:{color:"white",fontWeight:"bold"},align:e.align||"left",children:e.label},e.key))),(0,G.jsx)(b.c,{sx:{color:"white",fontWeight:"bold"},align:"right",children:"Actions"})]})}),(0,G.jsx)(j.c,{children:He.length>0?He.slice(K.page*K.rowsPerPage,K.page*K.rowsPerPage+K.rowsPerPage).map(((e,l)=>{const a=qe[e][0];return(0,G.jsxs)(t.Fragment,{children:[(0,G.jsxs)(y.c,{hover:!0,children:[(0,G.jsxs)(b.c,{children:[(0,G.jsx)(v.c,{size:"small",onClick:()=>(e=>me((l=>({...l,[e]:!l[e]}))))(e),children:ue[e]?(0,G.jsx)(S.c,{}):(0,G.jsx)(I.c,{})}),e]}),$e[O].listingColumns.slice(1).map((e=>(0,G.jsx)(b.c,{align:e.align||"left",children:a[e.key]||"0.00"},e.key))),(0,G.jsx)(b.c,{align:"right",children:(0,G.jsxs)(o.c,{display:"flex",gap:1,justifyContent:"flex-end",children:[(0,G.jsx)(f.c,{title:"Preview PDF",children:(0,G.jsx)(v.c,{color:"primary",onClick:()=>{_e(a),je(!0)},children:(0,G.jsx)(Q.c,{})})}),(0,G.jsx)(f.c,{title:"Preview Excel",children:(0,G.jsx)(v.c,{color:"primary",onClick:()=>{Fe(a),ve(!0)},children:(0,G.jsx)($.c,{})})}),(0,G.jsx)(f.c,{title:"Delete",children:(0,G.jsx)(v.c,{color:"error",onClick:e=>{e.stopPropagation(),we(a),De(!0)},children:(0,G.jsx)(q.c,{})})})]})})]}),(0,G.jsx)(y.c,{children:(0,G.jsx)(b.c,{style:{padding:0},colSpan:$e[O].listingColumns.length+1,children:(0,G.jsx)(_.c,{in:ue[e],timeout:"auto",unmountOnExit:!0,children:(0,G.jsxs)(o.c,{margin:1,children:[(0,G.jsxs)(c.c,{variant:"h6",gutterBottom:!0,component:"div",children:["Details for ",e]}),(0,G.jsxs)(x.c,{size:"small",children:[(0,G.jsx)(p.c,{children:(0,G.jsxs)(y.c,{children:[(0,G.jsx)(b.c,{children:"Date"}),(0,G.jsx)(b.c,{children:"Do/Inv No"}),(0,G.jsx)(b.c,{children:"salesNagal"===O||"sales"===O?"Retailer":"Supplier"}),(0,G.jsx)(b.c,{children:"Product"}),(0,G.jsx)(b.c,{children:"Short Name"}),(0,G.jsx)(b.c,{align:"right",children:"QTY"}),(0,G.jsx)(b.c,{align:"right",children:"KGS"}),(0,G.jsx)(b.c,{align:"right",children:"Amount"}),(0,G.jsx)(b.c,{align:"right",children:"Act Qty"}),(0,G.jsx)(b.c,{align:"right",children:"salesNagal"===O?"Broker Amt":"Brok.Amt"}),"salesNagal"===O&&(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(b.c,{align:"right",children:"Brok.Rate"}),(0,G.jsx)(b.c,{align:"right",children:"Coolie.Amt"}),(0,G.jsx)(b.c,{align:"right",children:"Coolie.Rate"}),(0,G.jsx)(b.c,{align:"right",children:"Vilai_Vasi"}),(0,G.jsx)(b.c,{align:"right",children:"Vilaiva.Rat"})]}),Ne&&("sales"===O||"purchase"===O)&&(0,G.jsx)(b.c,{align:"right",children:"Brokerage"}),(0,G.jsx)(b.c,{align:"right",children:"Actions"})]})}),(0,G.jsx)(j.c,{children:qe[e].flatMap((e=>{var l;return null===(l=e.Items)||void 0===l?void 0:l.map(((e,l)=>(0,G.jsxs)(y.c,{children:[(0,G.jsx)(b.c,{children:e.Date}),(0,G.jsx)(b.c,{children:e.Do_Inv_No||e.Po_Inv_No}),(0,G.jsx)(b.c,{children:e.Retailer_Name||e.Supplier_Name}),(0,G.jsx)(b.c,{children:e.Product_Name}),(0,G.jsx)(b.c,{children:e.Short_Name}),(0,G.jsx)(b.c,{align:"right",children:e.QTY}),(0,G.jsx)(b.c,{align:"right",children:e.KGS}),(0,G.jsx)(b.c,{align:"right",children:"salesNagal"===O||"sales"===O?e.Amount:e.Total_Invoice_value}),(0,G.jsx)(b.c,{align:"right",children:"salesNagal"===O?e.QTY:e.Act_Qty}),Je(Ne,e)?(0,G.jsxs)(G.Fragment,{children:["salesNagal"===O?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(b.c,{align:"right",children:((Ne.Brok_Rate||0)*(Ne.QTY||0)).toFixed(2)}),(0,G.jsx)(b.c,{align:"right",sx:{minWidth:120},children:(0,G.jsx)(s.c,{size:"small",type:"number",value:Ne.Brok_Rate||"",onChange:e=>{const l=parseFloat(e.target.value)||0;Ce({...Ne,Brok_Rate:l,Brok_Amt:(l*(Ne.QTY||0)).toFixed(2)})},inputProps:{step:"0.01",style:{textAlign:"right"}}})}),(0,G.jsx)(b.c,{align:"right",children:((Ne.Coolie_Rate||0)*(Ne.QTY||0)).toFixed(2)}),(0,G.jsx)(b.c,{align:"right",sx:{minWidth:120},children:(0,G.jsx)(s.c,{size:"small",type:"number",value:Ne.Coolie_Rate||"",onChange:e=>{const l=parseFloat(e.target.value)||0;Ce({...Ne,Coolie_Rate:l,Coolie_Amt:(l*(Ne.QTY||0)).toFixed(2)})},inputProps:{step:"0.01",style:{textAlign:"right"}}})}),(0,G.jsx)(b.c,{align:"right",sx:{minWidth:120},children:(0,G.jsx)(s.c,{size:"small",type:"number",value:Ne.Vilai_Vasi||"",onChange:e=>{const l=parseFloat(e.target.value)||0;Ce({...Ne,Vilai_Vasi:l,Vilaivasi_Rate:(l/100*(Ne.QTY||0)).toFixed(2)})},inputProps:{step:"1",style:{textAlign:"right"}}})}),(0,G.jsx)(b.c,{align:"right",children:((Ne.Vilai_Vasi||0)*(Ne.QTY||0)/100).toFixed(2)})]}):"sales"===O?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(b.c,{align:"right",children:Ne.Brokerage_Amt&&Ne.Act_Qty?(Ne.Brokerage_Amt*Ne.Act_Qty/100).toFixed(2):"0.00"}),(0,G.jsx)(b.c,{align:"right",sx:{minWidth:120},children:(0,G.jsx)(s.c,{size:"small",type:"number",value:Ne.Brokerage_Amt||"",onChange:e=>{const l=parseFloat(e.target.value)||0,a=Ne.Act_Qty?100*l/Ne.Act_Qty:0;Ce({...Ne,Brokerage_Amt:l,Brokerage:a.toFixed(2)})},inputProps:{step:"0.01",style:{textAlign:"right"}}})})]}):(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(b.c,{align:"right",children:Ne.Brokerage_Amt&&Ne.Act_Qty?(Ne.Brokerage_Amt*Ne.Act_Qty/100).toFixed(2):"0.00"}),(0,G.jsx)(b.c,{align:"right",sx:{minWidth:120},children:(0,G.jsx)(s.c,{size:"small",type:"number",value:Ne.Brokerage_Amt||"",onChange:e=>{const l=parseFloat(e.target.value)||0,a=Ne.Act_Qty?100*l/Ne.Act_Qty:0;Ce({...Ne,Brokerage_Amt:l,Brokerage:a.toFixed(2)})},inputProps:{step:"0.01",style:{textAlign:"right"}}})})]}),(0,G.jsx)(b.c,{align:"right",children:(0,G.jsxs)(o.c,{display:"flex",gap:1,justifyContent:"flex-end",children:[(0,G.jsx)(f.c,{title:"Save changes",children:(0,G.jsx)(v.c,{color:"primary",size:"small",onClick:Oe,children:(0,G.jsx)(B.c,{fontSize:"small"})})}),(0,G.jsx)(f.c,{title:"Cancel editing",children:(0,G.jsx)(v.c,{color:"secondary",size:"small",onClick:()=>Ce(null),children:(0,G.jsx)(R.c,{fontSize:"small"})})})]})})]}):(0,G.jsxs)(G.Fragment,{children:["salesNagal"===O?(0,G.jsxs)(G.Fragment,{children:[(0,G.jsx)(b.c,{align:"right",children:e.Brok_Amt||"0.00"}),(0,G.jsx)(b.c,{align:"right",children:e.Brok_Rate||"0.00"}),(0,G.jsx)(b.c,{align:"right",children:e.Coolie_Amt||"0.00"}),(0,G.jsx)(b.c,{align:"right",children:e.Coolie_Rate||"0.00"}),(0,G.jsx)(b.c,{align:"right",children:e.Vilai_Vasi||"0.00"}),(0,G.jsx)(b.c,{align:"right",children:e.Vilaivasi_Rate||"0.00"})]}):(0,G.jsx)(G.Fragment,{children:(0,G.jsx)(b.c,{align:"right",children:e.Brokerage||"0.00"})}),(0,G.jsx)(b.c,{align:"right",children:(0,G.jsxs)(o.c,{display:"flex",gap:1,justifyContent:"flex-end",children:[(0,G.jsx)(f.c,{title:"Delete this item",children:(0,G.jsx)(v.c,{color:"error",size:"small",onClick:l=>{l.stopPropagation(),Re(e),Se(!0)},children:(0,G.jsx)(q.c,{fontSize:"small"})})}),(0,G.jsx)(f.c,{title:"Edit this item",children:(0,G.jsx)(v.c,{color:"primary",size:"small",onClick:()=>(e=>{var l,a,t,r,i,s,o,n,d,c,g,h,u,m,x;null===ye||void 0===ye||ye.UserId,null===ye||void 0===ye||ye.UserId,"salesNagal"===O?Ce({...e,Brok_Rate:null!==(l=null!==(a=null!==(t=e.Brok_Rate)&&void 0!==t?t:e.Brokerage_Rate)&&void 0!==a?a:e.Brokerage)&&void 0!==l?l:"",Brok_Amt:null!==(r=e.Brok_Amt)&&void 0!==r?r:((null!==(i=e.Brok_Rate)&&void 0!==i?i:0)*(null!==(s=e.QTY)&&void 0!==s?s:0)).toFixed(2),Coolie_Rate:null!==(o=null!==(n=e.Coolie_Rate)&&void 0!==n?n:e.Coolie)&&void 0!==o?o:"",Coolie_Amt:null!==(d=e.Coolie_Amt)&&void 0!==d?d:((null!==(c=e.Coolie_Rate)&&void 0!==c?c:0)*(null!==(g=e.QTY)&&void 0!==g?g:0)).toFixed(2),Vilai_Vasi:null!==(h=e.Vilai_Vasi)&&void 0!==h?h:"",Vilaivasi_Rate:null!==(u=e.Vilaivasi_Rate)&&void 0!==u?u:((null!==(m=e.Vilai_Vasi)&&void 0!==m?m:0)*(null!==(x=e.Act_Qty)&&void 0!==x?x:0)/100).toFixed(2),Id:e.Id}):"sales"!==O&&"purchase"!==O||Ce(e)})(e),children:(0,G.jsx)(P.c,{fontSize:"small"})})})]})})]})]},l)))}))})]})]})})})})]},l)})):(0,G.jsx)(y.c,{children:(0,G.jsx)(b.c,{colSpan:$e[O].listingColumns.length+1,align:"center",children:"No data found"})})})]}),(0,G.jsx)(k.c,{rowsPerPageOptions:[10,25,50,100],component:"div",count:He.length,rowsPerPage:K.rowsPerPage,page:K.page,onPageChange:(e,l)=>U({...K,page:l}),onRowsPerPageChange:e=>U({page:0,rowsPerPage:parseInt(e.target.value,10)})})]})]}),(0,G.jsx)(W,{open:be,onClose:()=>je(!1),brokerData:fe,transactionType:O,fromDate:oe.FromDate,toDate:oe.ToDate}),(0,G.jsx)(Z,{open:ke,onClose:()=>ve(!1),brokerData:Ae,transactionType:O,fromDate:oe.FromDate,toDate:oe.ToDate})]}),(0,G.jsxs)(A.c,{open:Le.filters.filterDialog&&0===H,onClose:Me,maxWidth:"sm",fullWidth:!0,children:[(0,G.jsxs)(F.c,{children:[(0,G.jsxs)(o.c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,G.jsxs)(c.c,{variant:"h6",children:["sales"===O?"Sales":"salesNagal"===O?"SalesNagal":"Purchase"," Data Entry Filters"]}),(0,G.jsx)(v.c,{onClick:Me,children:(0,G.jsx)(w.c,{})})]}),(0,G.jsxs)(d.cp,{container:!0,spacing:2,children:[(0,G.jsx)(d.cp,{item:!0,xs:12,children:(0,G.jsx)(s.c,{fullWidth:!0,type:"date",label:"From Date",value:Le.filters.FromDate,onChange:e=>Qe((l=>({...l,filters:{...l.filters,FromDate:e.target.value}}))),InputLabelProps:{shrink:!0}})}),(0,G.jsx)(d.cp,{item:!0,xs:12,children:(0,G.jsx)(s.c,{fullWidth:!0,type:"date",label:"To Date",value:Le.filters.ToDate,onChange:e=>Qe((l=>({...l,filters:{...l.filters,ToDate:e.target.value}}))),InputLabelProps:{shrink:!0}})}),(0,G.jsx)(d.cp,{item:!0,xs:12,children:(0,G.jsx)(V.cp,{fullWidth:!0,label:"Brokers",value:Le.filters.Broker,onChange:e=>Qe((l=>({...l,filters:{...l.filters,Broker:e}}))),options:[{value:"",label:"ALL Brokers"},...X.broker],styles:E.cF,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Broker"})})]})]}),(0,G.jsxs)(N.c,{children:[(0,G.jsx)(g.c,{onClick:Me,children:"Cancel"}),(0,G.jsx)(g.c,{variant:"contained",onClick:()=>{Qe((e=>({...e,headerVilaiVasi:"",brokerageValues:{},filters:{...e.filters,refresh:!e.filters.refresh,filterDialog:!1}})))},children:"Apply Filters"})]})]}),(0,G.jsxs)(A.c,{open:oe.filterDialog&&1===H,onClose:Ge,maxWidth:"sm",fullWidth:!0,children:[(0,G.jsxs)(F.c,{children:[(0,G.jsxs)(o.c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,G.jsx)(c.c,{variant:"h6",children:"Listing Filters"}),(0,G.jsx)(v.c,{onClick:Ge,children:(0,G.jsx)(w.c,{})})]}),(0,G.jsxs)(d.cp,{container:!0,spacing:2,children:[(0,G.jsx)(d.cp,{item:!0,xs:5,children:(0,G.jsx)(s.c,{fullWidth:!0,type:"date",label:"From Date",value:oe.FromDate,onChange:e=>ne((l=>({...l,FromDate:e.target.value}))),InputLabelProps:{shrink:!0}})}),(0,G.jsx)(d.cp,{item:!0,xs:5,children:(0,G.jsx)(s.c,{fullWidth:!0,type:"date",label:"To Date",value:oe.ToDate,onChange:e=>ne((l=>({...l,ToDate:e.target.value}))),InputLabelProps:{shrink:!0}})}),(0,G.jsx)(d.cp,{item:!0,xs:2,style:{display:"flex",alignItems:"flex-end"},children:(0,G.jsx)(g.c,{variant:"contained",color:"primary",onClick:()=>{ne((e=>({...e,refresh:!e.refresh})))},style:{height:"30px",width:"100%"},children:"Search"})}),"salesNagal"===O?(0,G.jsx)(G.Fragment,{children:(0,G.jsx)(d.cp,{item:!0,xs:12,children:(0,G.jsx)(V.cp,{fullWidth:!0,value:oe.VilaiVasiZero,onChange:e=>ne((l=>({...l,VilaiVasiZero:e}))),options:[{value:"",label:"All"},{value:"zero",label:"VilaiVasi Zero"},{value:"nonzero",label:"VilaiVasi Non-Zero"}],styles:E.cF,menuPortalTarget:document.body,placeholder:"VilaiVasi Zero/Non-Zero"})})}):(0,G.jsx)(G.Fragment,{}),(0,G.jsx)(d.cp,{item:!0,xs:12,children:(0,G.jsx)(V.cp,{fullWidth:!0,label:"Brokers",value:oe.Broker,onChange:e=>ne((l=>({...l,Broker:e}))),options:[{value:"",label:"ALL Brokers"},...X.broker],styles:E.cF,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Broker"})}),(0,G.jsx)(d.cp,{item:!0,xs:12,children:(0,G.jsx)(V.cp,{fullWidth:!0,label:"Ledger",value:oe.Ledger,onChange:e=>ne((l=>({...l,Ledger:e}))),options:[{value:"",label:"ALL Ledger"},...ge.ledgers],styles:E.cF,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Ledger"})}),(0,G.jsx)(d.cp,{item:!0,xs:12,children:(0,G.jsx)(V.cp,{fullWidth:!0,label:"Item",value:oe.Item,onChange:e=>ne((l=>({...l,Item:e}))),options:[{value:"",label:"ALL Item"},...ge.items],styles:E.cF,menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Item"})})]})]}),(0,G.jsxs)(N.c,{children:[(0,G.jsx)(g.c,{onClick:Ge,children:"Cancel"}),(0,G.jsx)(g.c,{variant:"contained",onClick:()=>{ne((e=>({...e,refresh:!e.refresh,filterDialog:!1})))},children:"Apply Filters"})]})]}),(0,G.jsxs)(A.c,{open:Te,onClose:()=>De(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,G.jsx)(C.c,{id:"alert-dialog-title",children:"Confirm Deletion"}),(0,G.jsx)(F.c,{children:(0,G.jsxs)(F.c,{id:"alert-dialog-description",children:["Are you sure you want to delete ",(null===Pe||void 0===Pe?void 0:Pe.Broker_Name)||(null===Pe||void 0===Pe?void 0:Pe.Supplier_Name),"'s records?"]})}),(0,G.jsxs)(N.c,{children:[(0,G.jsx)(g.c,{onClick:()=>De(!1),children:"Cancel"}),(0,G.jsx)(g.c,{onClick:async()=>{try{l();const e=await(0,r.q)({address:"reports/brokerageNagalPurchase/list",method:"DELETE",bodyData:{TransactionType:O,Broker:Pe.Broker_Id||Pe.Supplier_Id,FromDate:oe.FromDate,ToDate:oe.ToDate},headers:{"Content-Type":"application/json"}});e.success&&(L.m4.success(e.message||"Deleted successfully!"),ne((e=>({...e,refresh:!e.refresh}))))}catch(e){L.m4.error("Delete failed due to an error")}finally{a(),De(!1)}},color:"error",autoFocus:!0,children:"Delete"})]})]}),(0,G.jsxs)(A.c,{open:Be,onClose:()=>Se(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,G.jsx)(C.c,{id:"alert-dialog-title",children:"Confirm Item Deletion"}),(0,G.jsx)(F.c,{children:(0,G.jsxs)(T.c,{id:"alert-dialog-description",children:["Are you sure you want to delete this ",null===Ie||void 0===Ie?void 0:Ie.Product_Name," item?"]})}),(0,G.jsxs)(N.c,{children:[(0,G.jsx)(g.c,{onClick:()=>Se(!1),children:"Cancel"}),(0,G.jsx)(g.c,{onClick:async()=>{try{l();const e=await(0,r.q)({address:"reports/brokerageNagalPurchase/list",method:"DELETE",bodyData:{Id:Ie.Id,Do_Id:Ie.Do_Id,Product_Id:Ie.Product_Id,PIN_Id:Ie.PIN_Id,FromDate:oe.FromDate,ToDate:oe.ToDate,TransactionType:O},headers:{"Content-Type":"application/json"}});e.success&&(L.m4.success(e.message||"Item deleted successfully!"),ne((e=>({...e,refresh:!e.refresh}))))}catch(e){L.m4.error("Item delete failed due to an error")}finally{a(),Se(!1)}},color:"error",autoFocus:!0,children:"Delete"})]})]}),(0,G.jsxs)(A.c,{open:Ve,onClose:()=>Ee(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,G.jsx)(C.c,{id:"alert-dialog-title",children:"Confirm Bulk Deletion"}),(0,G.jsx)(F.c,{children:(0,G.jsx)(T.c,{id:"alert-dialog-description",children:"Are you sure you want to delete ALL filtered records? This action cannot be undone."})}),(0,G.jsxs)(N.c,{children:[(0,G.jsx)(g.c,{onClick:()=>Ee(!1),children:"Cancel"}),(0,G.jsx)(g.c,{onClick:async()=>{try{l();const e=await(0,r.q)({address:"reports/brokerageNagalPurchase/list",method:"DELETE",bodyData:{FromDate:oe.FromDate,ToDate:oe.ToDate,Broker:oe.Broker.value,Ledger:oe.Ledger.value,Item:oe.Item.value,TransactionType:O}});e.success&&(L.m4.success(e.message||"All records deleted successfully!"),ne((e=>({...e,refresh:!e.refresh}))))}catch(e){L.m4.error("Bulk delete failed due to an error")}finally{a(),Ee(!1)}},color:"error",autoFocus:!0,children:"Delete All"})]})]})]})}}}]);
//# sourceMappingURL=4252.568fae97.chunk.js.map