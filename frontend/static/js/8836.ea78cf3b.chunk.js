"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[8836],{38836:(e,s,a)=>{a.r(s),a.d(s,{default:()=>se});var o=a(30800),t=a(69060),c=a(1908),n=a(56480),i=a(96464),l=a(84936),r=a(27454),d=a(12572),u=a(56880),m=a(58612),h=a(3358),p=a(5548),x=a(44380),g=a(9572),j=a(27532),f=a(89e3),y=a(93996),v=a(82656),C=a(26773),k=a(4488),S=a(43692),b=a(78092),I=a(90048),w=a(63468),_=a(85624),N=a(99904),P=a(33856),A=a(29504),E=a(5930),z=a(4016),T=a(60204),D=a(21420),L=a(12556),U=a(70296),F=a(83532),O=a(37956),R=a(80156),M=a(57704),B=a(12120),W=a(49608),q=a(23152),H=a(35064),$=a(36992),J=a(86e3),V=a(35832),G=a(39308),K=a(79476),Q=a(82496);const X=(0,L.cp)(i.c)((e=>{let{theme:s}=e;return{["&.".concat(l.c.head)]:{backgroundColor:"#EDF0F7",color:"#000000",fontWeight:"bold",borderRight:"1px solid #e0e0e0","&:last-child":{borderRight:"none"}},["&.".concat(l.c.body)]:{fontSize:14,padding:"12px 16px",borderRight:"1px solid #e0e0e0","&:last-child":{borderRight:"none"}}}})),Y=(0,L.cp)(r.c)((e=>{let{highlight:s}=e;return(0,o.c)((0,o.c)({backgroundColor:s?"#84EAB3":"#fff"},s&&{borderLeft:"4px solid #1976d2"}),{},{"&:hover":{backgroundColor:s?"#84EAB5":"#f5f5f5"}})})),Z=(0,L.cp)("div")({display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"16px",padding:"16px",backgroundColor:"#f5f5f5",borderTop:"1px solid #e0e0e0"}),ee=["Stock_Item"];const se=function(){const[e,s]=(0,t.useState)([]),[a,i]=(0,t.useState)([]),[l,L]=(0,t.useState)(0),[se,ae]=(0,t.useState)(5),[oe,te]=(0,t.useState)([]),[ce,ne]=(0,t.useState)(!1),[ie,le]=(0,t.useState)([]),[re,de]=(0,t.useState)([]),[ue,me]=(0,t.useState)([]),[he,pe]=(0,t.useState)(!1),[xe,ge]=(0,t.useState)({}),[je,fe]=(0,t.useState)({}),[ye,ve]=(0,t.useState)(""),[Ce,ke]=(0,t.useState)({key:null,direction:"asc"}),[Se,be]=(0,t.useState)([]),[Ie,we]=(0,t.useState)(!1),[_e,Ne]=(0,t.useState)({}),[Pe,Ae]=(0,t.useState)(!1),[Ee,ze]=(0,t.useState)(!1),[Te,De]=(0,t.useState)(!1),[Le,Ue]=(0,t.useState)(null),Fe=(0,G.gV)().user,Oe=JSON.parse(localStorage.getItem("user"));(0,t.useEffect)((()=>{(async()=>{try{const e=await(0,c.q)({address:"masters/columns/dropDownLos?company_id=".concat(null===Oe||void 0===Oe?void 0:Oe.companyId)});e.success&&de(e.data)}catch(e){console.error("Error fetching columns:",e)}})()}),[null===Oe||void 0===Oe?void 0:Oe.companyId]),Ee&&(d.c,u.c),(0,t.useEffect)((()=>{!async function(){try{const e=await(0,c.q)({address:"masters/displayLosColumn?company_id=".concat(null===Oe||void 0===Oe?void 0:Oe.companyId)});if(!e.success||!Array.isArray(e.data))return void console.error("No display columns found");const a=[...e.data].sort(((e,s)=>e.Position-s.Position));te(a),le([...a]);const o=a.filter((e=>1===e.status&&!["Auto_Id","Stock_Tally_Id"].includes(e.ColumnName))).sort(((e,s)=>e.Position-s.Position)).map((e=>({header:e.Alias_Name||e.ColumnName,accessor:e.ColumnName,position:e.Position})));i(o);const t=await(0,c.q)({address:"masters/getlosDetails"});if(t.success&&Array.isArray(t.data)){me(t.data);const e=o.map((e=>e.accessor)),a=t.data.map((s=>{const a={};return e.forEach((e=>{a[e]=s[e]||""})),a}));s(a)}}catch(e){console.error("Error loading data:",e)}}()}),[Te,he]);const Re=e=>{const s=oe.find((s=>s.Id===e));return!!s&&1===s.status},Me=(e,s)=>{ge((a=>(0,o.c)((0,o.c)({},a),{},{[e]:s})))},Be=(0,t.useMemo)((()=>{let e=[...ue];if(ye){const s=ye.split(",").map((e=>e.trim().toLowerCase())).filter(Boolean);e=e.filter((e=>s.some((s=>Object.values(e).some((e=>String(e).toLowerCase().includes(s)))))))}return e=e.filter((e=>Object.keys(je).every((s=>!je[s]||String(e[s]).toLowerCase().includes(String(je[s]).toLowerCase()))))),Ce.key&&e.sort(((e,s)=>e[Ce.key]<s[Ce.key]?"asc"===Ce.direction?-1:1:e[Ce.key]>s[Ce.key]?"asc"===Ce.direction?1:-1:0)),e}),[ue,ye,je,Ce]),We=()=>{Ae(!1),Ue(null),ze(!1)},qe=async e=>{try{const s=new FormData;s.append("file",e),s.append("company_id",null===Oe||void 0===Oe?void 0:Oe.Company_id),s.append("Created_By",null===Oe||void 0===Oe?void 0:Oe.UserId),s.append("isRetailer","1");const a=await fetch("".concat(K.c,"masters/uploadLosExcel"),{method:"POST",body:s,headers:{Db:null===Fe||void 0===Fe?void 0:Fe.Company_id}});if(!a.ok){const e=await a.json().catch((()=>({})));throw new Error(e.message||"Upload failed")}const o=await a.json();return ze(!1),o}catch(s){throw ze(!1),console.error("Upload Error:",{message:s.message,stack:s.stack,time:(new Date).toISOString()}),new Error("Upload failed: ".concat(s.message))}};return(0,Q.jsxs)(d.c,{sx:{p:3,backgroundColor:"white",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,Q.jsxs)(d.c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,Q.jsx)(u.c,{variant:"h5",children:"LOS LIST"}),(0,Q.jsxs)(d.c,{sx:{display:"flex",alignItems:"center"},children:[Se.length>0&&(0,Q.jsx)(j.c,{label:"SELECTED ROWS : ".concat(Se.length," "),color:"primary",size:"small",sx:{mr:2}}),(0,Q.jsx)(x.c,{variant:"outlined",size:"small",placeholder:"Search...",value:ye,onChange:e=>ve(e.target.value),sx:{width:250,mr:2,"& .MuiInputBase-root":{height:32}},InputProps:{startAdornment:(0,Q.jsx)(g.c,{position:"start",children:(0,Q.jsx)(M.c,{})}),endAdornment:ye&&(0,Q.jsx)(g.c,{position:"end",children:(0,Q.jsx)(p.c,{size:"small",onClick:()=>ve(""),children:(0,Q.jsx)(R.c,{fontSize:"small"})})})}}),(0,Q.jsx)(h.c,{title:"Column Settings",children:(0,Q.jsx)(p.c,{onClick:()=>ne(!0),children:(0,Q.jsx)(B.c,{})})}),(0,Q.jsx)(f.c,{variant:"contained",startIcon:(0,Q.jsx)(M.c,{}),onClick:()=>{fe((0,o.c)({},xe)),L(0)},disabled:0===Object.keys(xe).length,sx:{ml:2},children:"Apply Filters"}),(0,Q.jsx)(f.c,{variant:"outlined",startIcon:(0,Q.jsx)(R.c,{}),onClick:()=>{ge({}),fe({}),ve(""),L(0)},disabled:0===Object.keys(je).length&&!ye,sx:{ml:1},children:"Clear All"}),(0,Q.jsxs)(y.c,{onClick:()=>((e,s)=>{try{if(!Array.isArray(e)||!Array.isArray(s))throw new Error("Invalid data: columns and selectedRows must be arrays");const a=e.filter((e=>"Auto_Id"!==e.accessor&&"Stock_Tally_Id"!==e.accessor)),o=[a.map((e=>"string"!==typeof e.header?(console.warn("Missing or invalid header for column:",e),"UNNAMED_COLUMN"):e.header)),...s.map((e=>a.map((s=>{var a;return null!==(a=e[s.accessor])&&void 0!==a?a:""}))))],t=V.c$.aoa_to_sheet(o),c=V.c$.book_new();V.c$.book_append_sheet(c,t,"SelectedData");const n=(new Date).toISOString().slice(0,10);V.a8(c,"selected_data_".concat(n,".xlsx"))}catch(a){console.error("Excel export failed:",a),alert("Export failed: ".concat(a.message))}})(a,Se),children:[(0,Q.jsx)(W.c,{fontSize:"small",sx:{mr:1}})," Download"," "]}),(0,Q.jsxs)(y.c,{onClick:()=>{Ae(!0)},children:[(0,Q.jsx)(q.c,{fontSize:"small",sx:{mr:1}}),"Upload"]})]})]}),(0,Q.jsxs)(v.c,{open:ce,onClose:()=>ne(!1),maxWidth:"lg",fullWidth:!0,children:[(0,Q.jsx)(C.c,{children:"Column Settings"}),(0,Q.jsx)(k.c,{children:(0,Q.jsx)("div",{className:"row",children:re.sort(((e,s)=>e.Position-s.Position)).map((e=>{var s,a;return(0,Q.jsx)("div",{className:"col-lg-4 col-md-6 p-2",children:(0,Q.jsx)(S.c,{className:"p-2",children:(0,Q.jsxs)("div",{className:"d-flex justify-content-between align-items-center flex-wrap",children:[(0,Q.jsx)(b.c,{checked:Re(e.Id),onChange:s=>((e,s)=>{const a=re.find((s=>s.Id===e));if((null===a||void 0===a?void 0:a.Position)<=5)return void n.m4.error("First 5 columns cannot be disabled");let t;if(oe.some((s=>s.Id===e)))t=oe.map((a=>a.Id===e?(0,o.c)((0,o.c)({},a),{},{status:s?1:0}):a));else{const a=re.find((s=>s.Id===e));t=a?[...oe,(0,o.c)((0,o.c)({},a),{},{status:s?1:0})]:[...oe]}t.sort(((e,s)=>e.Position-s.Position)),te(t)})(e.Id,s.target.checked),disabled:e.Position<=5,color:e.Position<=5?"default":"primary"}),(0,Q.jsx)("div",{children:null===e||void 0===e?void 0:e.ColumnName}),(0,Q.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,Q.jsx)(x.c,{type:"number",size:"small",variant:"outlined",value:null!==(s=e.Position)&&void 0!==s?s:0,onChange:s=>((e,s)=>{const a=parseInt(s);isNaN(a)||de((s=>s.map((s=>s.Id===e?(0,o.c)((0,o.c)({},s),{},{Position:a}):s))))})(e.Id,s.target.value),sx:{width:"70px"},inputProps:{min:1,readOnly:ee.includes(e.ColumnName)},disabled:ee.includes(e.ColumnName)}),(0,Q.jsx)(x.c,{size:"small",variant:"outlined",value:null!==(a=e.Alias_Name)&&void 0!==a?a:"",onChange:s=>{return!ee.includes(e.ColumnName)&&(a=e.Id,t=s.target.value,void de((e=>e.map((e=>e.Id===a?(0,o.c)((0,o.c)({},e),{},{Alias_Name:t}):e)))));var a,t},sx:{"& .MuiInputBase-input":{cursor:ee.includes(e.ColumnName)?"default":"text",backgroundColor:ee.includes(e.ColumnName)?"#f5f5f5":"inherit"}},inputProps:{readOnly:ee.includes(e.ColumnName)},disabled:ee.includes(e.ColumnName)})]})]})})},e.Id)}))})}),(0,Q.jsxs)(I.c,{children:[(0,Q.jsx)(f.c,{onClick:()=>{te([...ie]),de([...ie])},variant:"outlined",children:"Reset"}),(0,Q.jsx)(f.c,{onClick:()=>ne(!1),color:"error",children:"Close"}),(0,Q.jsx)(f.c,{onClick:async()=>{pe(!0);try{const e=oe.map((e=>{const s=re.find((s=>s.Id===e.Id));return s?(0,o.c)((0,o.c)({},e),{},{Position:s.Position,Alias_Name:s.Alias_Name}):e})),a={},t=new Set;if(e.forEach((e=>{a[e.Position]&&t.add(e.Position),a[e.Position]=!0})),t.size>0){const e=Array.from(t).join(", ");return void n.m4.error("Duplicate positions found: ".concat(e))}te(e),le(e);const l=await(0,c.q)({address:"masters/updateLosColumnChanges",method:"PUT",bodyData:{columns:e.map((e=>({id:e.Id,status:e.status,position:e.Position,alias_name:e.Alias_Name,column_name:e.ColumnName}))),company_id:null===Oe||void 0===Oe?void 0:Oe.companyId}});if(!l.success)throw new Error(l.message||"Failed to update column statuses");const r=e.filter((e=>1===e.status)).sort(((e,s)=>e.Position-s.Position)).map((e=>({header:e.Alias_Name||e.ColumnName,accessor:e.ColumnName,position:e.Position})));if(i(r),ue.length>0){const e=r.map((e=>e.accessor)),a=ue.map((s=>{const a={};return e.forEach((e=>{a[e]=s[e]||""})),a}));s(a)}ne(!1),n.m4.success("Changes Saved")}catch(e){console.error("Error updating column statuses:",e),n.m4.error(e.message||"Failed to update columns. Please try again.")}finally{pe(!1)}},variant:"contained",color:"primary",disabled:he,children:he?"Applying...":"Apply"})]})]}),(0,Q.jsxs)(v.c,{open:Pe,fullWidth:!0,children:[(0,Q.jsx)(C.c,{children:"Upload Excel File"}),(0,Q.jsx)(k.c,{children:(0,Q.jsxs)(d.c,{sx:{display:"flex",alignItems:"center",gap:2,mt:2},children:[(0,Q.jsxs)(f.c,{variant:"contained",component:"label",children:["Browse",(0,Q.jsx)("input",{type:"file",accept:".xls,.xlsx",hidden:!0,onChange:e=>{const s=e.target.files[0];s.size>5242880?alert("File size exceeds 5MB"):Ue(s)}})]}),(0,Q.jsx)(u.c,{children:Le?Le.name:"No file selected"})]})}),(0,Q.jsxs)(I.c,{children:[(0,Q.jsx)(f.c,{onClick:We,children:"Cancel"}),(0,Q.jsx)(f.c,{onClick:async()=>{if(Le)try{ze(!0),await qe(Le),We(),De((e=>!e)),n.m4.success("File uploaded successfully")}catch(e){n.m4.error("Upload failed: ".concat(e.message))}finally{ze(!1)}},variant:"contained",disabled:!Le||Ee,startIcon:Ee?(0,Q.jsx)(w.c,{size:20,color:"inherit"}):null,children:Ee?"Uploading...":"Upload"})]})]}),(0,Q.jsxs)(v.c,{open:Ie,onClose:()=>we(!1),maxWidth:"md",fullWidth:!0,children:[(0,Q.jsx)(C.c,{children:"Edit Row"}),(0,Q.jsx)(k.c,{children:(0,Q.jsx)("div",{className:"container-fluid",style:{maxHeight:"80vh",overflow:"auto"},children:(0,Q.jsx)("div",{className:"row g-3",children:a.map((e=>(0,Q.jsx)("div",{className:"col-12 col-sm-6 col-md-4",children:(0,Q.jsxs)("div",{className:"form-group",children:[(0,Q.jsx)("label",{className:"form-label",children:e.header}),(0,Q.jsx)("input",{type:"text",className:"form-control form-control-lg",value:_e[e.accessor]||"",onChange:s=>Ne((0,o.c)((0,o.c)({},_e),{},{[e.accessor]:s.target.value})),disabled:"Auto_Id"===e.accessor||"Stock_Tally_Id"===e.accessor||"Stock_Item"===e.accessor,style:{padding:"1rem 1rem",fontSize:"1rem"}})]})},e.accessor)))})})}),(0,Q.jsxs)(I.c,{children:[(0,Q.jsx)(f.c,{onClick:()=>we(!1),variant:"outlined",startIcon:(0,Q.jsx)(H.c,{}),children:"Cancel"}),(0,Q.jsx)(f.c,{onClick:async()=>{try{const e=await(0,c.q)({address:"masters/updateLosDetails",method:"PUT",bodyData:_e,headers:{Db:null===Fe||void 0===Fe?void 0:Fe.Company_id}});if(!e.success)throw new Error(e.message||"Failed to update row");me((e=>e.map((e=>e.Auto_Id===_e.Auto_Id?_e:e)))),s((e=>e.map((e=>e.Auto_Id===_e.Auto_Id?_e:e)))),we(!1),n.m4.success("Row updated successfully")}catch(e){n.m4.error("Failed to update row")}},variant:"contained",color:"primary",startIcon:(0,Q.jsx)($.c,{}),children:"Save Changes"})]})]}),a.length>0&&ue.length>0?(0,Q.jsxs)(_.c,{elevation:0,sx:{border:"1px solid #e0e0e0"},children:[(0,Q.jsx)(N.c,{children:(0,Q.jsxs)(P.c,{stickyHeader:!0,"aria-label":"ledger table",sx:{minWidth:650},children:[(0,Q.jsx)(m.c,{children:(0,Q.jsxs)(r.c,{children:[(0,Q.jsx)(X,{align:"center",sx:{width:"80px"},children:"S.No"}),(0,Q.jsx)(X,{align:"center",sx:{width:"80px"},children:"CheckBox"}),(0,Q.jsx)(X,{align:"center",sx:{width:"80px"},children:"Actions"}),a.map((e=>(0,Q.jsxs)(X,{align:"center",children:[(0,Q.jsxs)(d.c,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.header,(0,Q.jsx)(h.c,{title:"Sort ".concat(Ce.key===e.accessor&&"asc"===Ce.direction?"Descending":"Ascending"),children:(0,Q.jsx)(p.c,{size:"small",onClick:()=>(e=>{let s="asc";Ce.key===e&&"asc"===Ce.direction&&(s="desc"),ke({key:e,direction:s})})(e.accessor),color:Ce.key===e.accessor?"primary":"default",children:Ce.key===e.accessor?"asc"===Ce.direction?(0,Q.jsx)(U.c,{}):(0,Q.jsx)(F.c,{}):(0,Q.jsx)(O.c,{})})})]}),(0,Q.jsx)(x.c,{size:"small",variant:"outlined",placeholder:"Filter...",value:xe[e.accessor]||"",onChange:s=>Me(e.accessor,s.target.value),sx:{width:"100%",mt:1},InputProps:{endAdornment:xe[e.accessor]&&(0,Q.jsx)(g.c,{position:"end",children:(0,Q.jsx)(p.c,{size:"small",onClick:()=>Me(e.accessor,""),children:(0,Q.jsx)(R.c,{fontSize:"small"})})})}})]},e.accessor)))]})}),(0,Q.jsx)(A.c,{children:Be.slice(l*se,l*se+se).map(((e,s)=>(0,Q.jsxs)(Y,{highlight:1===e.Is_Tally_Updated||"1"===e.Is_Tally_Updated,children:[(0,Q.jsx)(X,{align:"center",children:l*se+s+1}),(0,Q.jsx)(X,{children:(0,Q.jsx)(p.c,{children:(0,Q.jsx)("input",{type:"checkbox",checked:Se.some((s=>s.Stock_Tally_Id===e.Stock_Tally_Id)),onChange:()=>(e=>{be((s=>s.some((s=>s.Stock_Tally_Id===e.Stock_Tally_Id))?s.filter((s=>s.Stock_Tally_Id!==e.Stock_Tally_Id)):[...s,e]))})(e),onFocus:e=>e.target.blur(),style:{transform:"scale(1.5)",width:"14px",height:"20px"}})})}),(0,Q.jsx)(X,{align:"center",children:(0,Q.jsx)(h.c,{title:"Edit",children:(0,Q.jsx)(p.c,{onClick:()=>{return s=e,Ne((0,o.c)({},s)),void we(!0);var s},color:"primary",size:"small",sx:{"&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)",transform:"scale(1.1)"},transition:"transform 0.2s"},children:(0,Q.jsx)(J.c,{fontSize:"small"})})})}),a.map((a=>(0,Q.jsx)(X,{align:"center",children:e[a.accessor]},"".concat(s,"-").concat(a.accessor))))]},s)))})]})}),(0,Q.jsxs)(Z,{children:[(0,Q.jsx)(E.c,{component:"div",count:Be.length,rowsPerPage:se,page:l,onPageChange:(e,s)=>{L(s)},rowsPerPageOptions:[],sx:{"& .MuiTablePagination-toolbar":{padding:0,minHeight:"auto"},"& .MuiTablePagination-spacer":{display:"none"},"& .MuiTablePagination-actions":{marginLeft:"16px"}}}),(0,Q.jsxs)(z.c,{variant:"outlined",size:"small",sx:{minWidth:120},children:[(0,Q.jsx)(T.c,{children:"Rows per page"}),(0,Q.jsx)(D.c,{value:se,onChange:e=>{ae(parseInt(e.target.value,10)),L(0)},label:"Rows per page",children:(()=>{const s=[5,10,15,30,60,120,240],a=Math.max(...s);return e.length>a?[...s]:s})().map((e=>(0,Q.jsx)(y.c,{value:e,children:e},e)))})]})]})]}):(0,Q.jsx)(u.c,{children:"Loading..."})]})}}}]);
//# sourceMappingURL=8836.ea78cf3b.chunk.js.map