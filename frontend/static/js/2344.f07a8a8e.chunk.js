"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[2344],{42344:(e,l,i)=>{i.r(l),i.d(l,{default:()=>w});var d=i(30800),n=i(69060),o=i(43692),a=i(89e3),s=i(84436),r=i(15786),t=i(78092),c=i(3358),v=i(82656),u=i(26773),m=i(4488),b=i(90048),_=i(33808),x=i(70288),h=i(58985),p=i(36992),j=i(18256),N=i(29720),T=i(61584),f=i(44048),C=i(39308),I=i(56480),g=i(51560),J=i(77536),S=i(1908),y=i(82496);const w=()=>{var e,l,i,w,k,B;const F=JSON.parse(localStorage.getItem("user")),D=(0,g.i6)(),{contextObj:A}=(0,n.useContext)(J.a),Q=(0,g.IT)().state,O={Report_Type_Id:"",reportName:"",tables:[],tableJoins:[],currentTab:"tbl_Q_Pay_Summarry",previewDialog:!1,createdBy:F.UserId},[R,V]=(0,n.useState)(O),[q,E]=(0,n.useState)([]),K=null===R||void 0===R||null===(e=R.tables)||void 0===e?void 0:e.reduce(((e,l)=>e+(Boolean(Number(null===l||void 0===l?void 0:l.isChecked))?1:0)),0),M=null===R||void 0===R||null===(l=R.tables)||void 0===l?void 0:l.reduce(((e,l)=>{var i;return e+(Boolean(Number(null===l||void 0===l?void 0:l.isChecked))?null===l||void 0===l||null===(i=l.columns)||void 0===i?void 0:i.reduce(((e,l)=>e+((0,C.Qr)(null===l||void 0===l?void 0:l.isVisible,1)?1:0)),0):0)}),0),P=(0,y.jsx)("span",{className:"p-2 mt-3 border rounded-3 d-inline-block w-auto",children:(0,y.jsx)("table",{children:(0,y.jsxs)("tbody",{children:[(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:" border-end",children:"Tables Selected"}),(0,y.jsx)("td",{className:"px-2 blue-text",children:K})]}),(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:" border-end",children:"Columns Selected\u2003\u2003"}),(0,y.jsx)("td",{className:"px-2 blue-text",children:M})]})]})})});(0,n.useEffect)((()=>{const e=null===Q||void 0===Q?void 0:Q.ReportState;(0,C.CY)(e)&&V((l=>{var i,n,o,a;return(0,d.c)((0,d.c)({},l),{},{Report_Type_Id:null!==(i=null===e||void 0===e?void 0:e.Report_Type_Id)&&void 0!==i?i:"",reportName:null!==(n=null===e||void 0===e?void 0:e.reportName)&&void 0!==n?n:"",tables:null!==(o=[...null===e||void 0===e?void 0:e.tables])&&void 0!==o?o:[],createdBy:null!==(a=null===e||void 0===e?void 0:e.createdBy)&&void 0!==a?a:null===F||void 0===F?void 0:F.UserId})}))}),[]),(0,n.useEffect)((()=>{(0,S.q)({address:"reports/tablesAndColumns"}).then((e=>{null!==e&&void 0!==e&&e.success&&E(null===e||void 0===e?void 0:e.data)})).catch((e=>console.log(e)))}),[]);const U=(e,l,i)=>{V((n=>{const o=[...n.tableJoins],a=(0,d.c)({},o[l]);return a[i]=e,"Join_First_Table_Id"===i&&(a.Join_First_Table_Column=""),"Join_Second_Table_Id"===i&&(a.Join_Second_Table_Column=""),(null===a||void 0===a?void 0:a.Join_First_Table_Id)===(null===a||void 0===a?void 0:a.Join_Second_Table_Id)&&(a.Join_Second_Table_Id=""),o[l]=a,(0,d.c)((0,d.c)({},n),{},{tableJoins:[...o]})}))};return(0,C.Qr)(null===A||void 0===A?void 0:A.Add_Rights,1)&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(o.c,{children:[(0,y.jsxs)("div",{className:"p-2 border-bottom fa-16 fw-bold d-flex justify-content-between align-items-center",children:[(0,y.jsx)("span",{className:"text-primary text-uppercase ps-3",children:null!==R&&void 0!==R&&R.Report_Type_Id?"Modify Report Template":"Report Templates Creation"}),(0,y.jsx)(a.c,{variant:"outlined",onClick:()=>D(-1),startIcon:(0,y.jsx)(_.c,{}),children:"Back"})]}),(0,y.jsxs)(s.c,{children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"w-100",children:"Report Name"}),(0,y.jsx)("input",{type:"text",className:"cus-inpt w-auto",value:R.reportName,onChange:e=>V((0,d.c)((0,d.c)({},R),{},{reportName:e.target.value}))})]}),P,(0,y.jsx)(f.c,{className:"d-flex flex-wrap mt-3",children:(0,y.jsxs)(j.cp,{value:R.currentTab,children:[(0,y.jsx)(N.c,{indicatorColor:"transparent",onChange:(e,l)=>V((0,d.c)((0,d.c)({},R),{},{currentTab:l})),variant:"scrollable",scrollButtons:"auto",orientation:"vertical",allowScrollButtonsMobile:!0,sx:{maxHeight:"400px"},children:q.map(((e,l)=>{var i;return(0,y.jsx)(r.c,{sx:R.currentTab===(null===e||void 0===e?void 0:e.Table_Name)?{backgroundColor:"#c6d7eb"}:{},className:Boolean(null===(i=R.tables.find((l=>l.Table_Name===(null===e||void 0===e?void 0:e.Table_Name))))||void 0===i?void 0:i.isChecked)?"text-success fw-bold":"text-primary",label:null===e||void 0===e?void 0:e.AliasName,value:null===e||void 0===e?void 0:e.Table_Name},l)}))}),q.map(((e,l)=>{var i,n;return(0,y.jsxs)(T.c,{value:null===e||void 0===e?void 0:e.Table_Name,className:"flex-grow-1 p-3 border rounded-2",children:[(0,y.jsxs)("div",{className:"d-flex align-items-center mb-4 border-bottom",children:[(0,y.jsx)(t.c,{checked:Boolean(null===(i=R.tables.find((l=>l.Table_Name===(null===e||void 0===e?void 0:e.Table_Name))))||void 0===i?void 0:i.isChecked),onChange:l=>{return i=null===e||void 0===e?void 0:e.Table_Name,n=l.target.checked,o=null===e||void 0===e?void 0:e.AliasName,void V((e=>{var l,a,s;const r=[...e.tables],t=r.findIndex((e=>e.Table_Name===i)),c=[],v=null===q||void 0===q?void 0:q.findIndex((e=>e.Table_Name===i)),u=null===(l=q[v])||void 0===l||null===(a=l.Columns)||void 0===a?void 0:a.findIndex((e=>(0,C.Qr)(null===e||void 0===e?void 0:e.IS_Default,1))),m=-1!==u?null===(s=q[v])||void 0===s?void 0:s.Columns[u]:{};var b;return-1!==u&&(m.Order_By="",m.isVisible=!0),c.push(m),-1!==t?(r[t].isChecked=n,r[t].columns=n?c:[]):r.push({Table_Id:(null===q||void 0===q||null===(b=q.find((e=>(null===e||void 0===e?void 0:e.Table_Name)===i)))||void 0===b?void 0:b.Table_Id)||"",Table_Name:i,AliasName:o,isChecked:n,columns:c}),(0,d.c)((0,d.c)({},e),{},{tables:r.filter((e=>Boolean(Number(null===e||void 0===e?void 0:e.isChecked))))})}));var i,n,o}}),(0,y.jsxs)("h6",{className:"fa-13 mb-0 fw-bold ",children:[null===e||void 0===e?void 0:e.AliasName," TABLE"]})]}),(0,y.jsx)("div",{className:"cus-grid",children:null===e||void 0===e||null===(n=e.Columns)||void 0===n?void 0:n.map(((l,i)=>{var n,a,s,r,c,v;return(0,y.jsx)("div",{children:(0,y.jsxs)(o.c,{className:"p-2 d-flex justify-content-between align-items-center flex-wrap ".concat(i%2===0?"bg-light":""),children:[(0,y.jsxs)("div",{className:"d-flex justify-content-between align-items-center flex-wrap",children:[(0,y.jsx)(t.c,{checked:Boolean(null===l||void 0===l?void 0:l.IS_Default)||Boolean(null===(n=R.tables.find((l=>l.Table_Name===(null===e||void 0===e?void 0:e.Table_Name))))||void 0===n||null===(a=n.columns)||void 0===a||null===(s=a.find((e=>e.Column_Name===(null===l||void 0===l?void 0:l.Column_Name))))||void 0===s?void 0:s.isVisible),disabled:Boolean(null===l||void 0===l?void 0:l.IS_Default),onChange:i=>{return n=null===e||void 0===e?void 0:e.Table_Name,o=l,a=i.target.checked,void V((e=>{const l=[...e.tables],i=l.findIndex((e=>e.Table_Name===n));if(-1!==i){const e=l[i].columns||[],n=null===e||void 0===e?void 0:e.findIndex((e=>(null===e||void 0===e?void 0:e.Column_Name)===(null===o||void 0===o?void 0:o.Column_Name)));-1!==n?e[n].isVisible=a?1:0:e.push((0,d.c)((0,d.c)({},o),{},{Order_By:"",isVisible:a?1:0})),l[i].columns=null===e||void 0===e?void 0:e.filter((e=>(0,C.Qr)(null===e||void 0===e?void 0:e.isVisible,1)))}return(0,d.c)((0,d.c)({},e),{},{tables:l})}));var n,o,a}}),(0,y.jsx)("h6",{className:"fa-12 m-0 fw-bold",children:null===l||void 0===l?void 0:l.Column_Name})]}),(0,y.jsx)("input",{type:"number",className:"p-1 border cus-inpt ".concat(i%2!==0?"bg-light":""),style:{width:"80px"},placeholder:"Order",value:(null===(r=R.tables.find((l=>l.Table_Name===(null===e||void 0===e?void 0:e.Table_Name))))||void 0===r||null===(c=r.columns)||void 0===c||null===(v=c.find((e=>e.Column_Name===(null===l||void 0===l?void 0:l.Column_Name))))||void 0===v?void 0:v.Order_By)||"",onChange:i=>{return n=null===e||void 0===e?void 0:e.Table_Name,o=l,a=i.target.value,void V((e=>{const l=[...e.tables],i=l.findIndex((e=>e.Table_Name===n));if(-1!==i){const e=l[i].columns||[],n=null===e||void 0===e?void 0:e.findIndex((e=>(null===e||void 0===e?void 0:e.Column_Name)===(null===o||void 0===o?void 0:o.Column_Name)));-1!==n?e[n].Order_By=a:e.push((0,d.c)((0,d.c)({},o),{},{Order_By:a,isVisible:!0})),l[i].columns=e}return(0,d.c)((0,d.c)({},e),{},{tables:l})}));var n,o,a}})]})},i)}))})]},l)}))]})})]}),(0,y.jsx)("hr",{className:"mt-2 mb-0"}),(0,y.jsx)("div",{className:"p-3 d-flex justify-content-end",children:(0,y.jsx)(c.c,{title:M<=4&&"Select Minimum 5 Columns",children:(0,y.jsx)("span",{children:(0,y.jsx)(a.c,{variant:"outlined",startIcon:(0,y.jsx)(x.c,{}),disabled:!(null!==R&&void 0!==R&&R.reportName)||0===K||M<=4,onClick:M>50?()=>I.m4.warn("Maximum 50 Column limit exceeded"):()=>(()=>{var e;const l=null===(e=R.tables)||void 0===e?void 0:e.reduce(((e,l)=>e+(Boolean(null===l||void 0===l?void 0:l.isChecked)?1:0)),0);V((e=>(0,d.c)((0,d.c)({},e),{},{previewDialog:!0,tableJoins:l>1?Array.from({length:(0,C.od)(l,1)}).map(((e,l)=>({Join_First_Table_Id:"",Join_First_Table_Column:"",Join_Second_Table_Id:"",Join_Second_Table_Column:""}))):[]})))})(),children:"Preview"})})})})]}),(0,y.jsxs)(v.c,{open:null===R||void 0===R?void 0:R.previewDialog,onClose:()=>V((e=>(0,d.c)((0,d.c)({},e),{},{previewDialog:!1}))),fullScreen:!0,children:[(0,y.jsx)(u.c,{children:"Define Table Joins"}),(0,y.jsxs)("form",{onSubmit:e=>{e.preventDefault(),(()=>{var e;const l=new Set;if(null===(e=R.tableJoins)||void 0===e||e.forEach((e=>{l.add(e.Join_First_Table_Id),l.add(e.Join_Second_Table_Id)})),l.size!==R.tableJoins.length+1&&R.tables.length>1)return I.m4.error("Invalid table joins");V((e=>(0,d.c)((0,d.c)({},e),{},{previewDialog:!1}))),(0,S.q)({address:"reports/template",method:null!==R&&void 0!==R&&R.Report_Type_Id?"PUT":"POST",bodyData:R}).then((e=>{null!==e&&void 0!==e&&e.success?(V(O),D(-1),I.m4.success(e.message)):I.m4.error(e.message)})).catch((e=>console.log(e)))})()},children:[(0,y.jsxs)(m.c,{children:[P,(0,y.jsx)("div",{className:"table-responsive",children:(0,y.jsxs)("table",{className:"table",children:[(0,y.jsx)("thead",{children:(0,y.jsx)("tr",{children:null===R||void 0===R||null===(i=R.tables)||void 0===i?void 0:i.map(((e,l)=>{var i;return(0,y.jsx)(n.Fragment,{children:(0,y.jsxs)("th",{className:"border fa-14 text-center",children:[null===e||void 0===e?void 0:e.AliasName," ( ",null===e||void 0===e||null===(i=e.columns)||void 0===i?void 0:i.length," )"]})},l)}))})}),(0,y.jsx)("tbody",{children:(0,y.jsx)("tr",{children:null===R||void 0===R||null===(w=R.tables)||void 0===w?void 0:w.map(((e,l)=>{var i;return(0,y.jsx)(n.Fragment,{children:(0,y.jsx)("td",{className:"border fa-13 text-center",children:null===e||void 0===e||null===(i=e.columns)||void 0===i?void 0:i.map(((e,l)=>(0,y.jsx)("p",{children:null===e||void 0===e?void 0:e.Column_Name},l)))})},l)}))})})]})}),(null===R||void 0===R||null===(k=R.tables)||void 0===k?void 0:k.length)>1&&(0,y.jsx)("div",{className:"p-2 cus-grid",children:null===R||void 0===R||null===(B=R.tableJoins)||void 0===B?void 0:B.map(((e,l)=>{var i,d,n,o,a,s,r,t;return(0,y.jsxs)("div",{className:" p-2",children:[(0,y.jsxs)("h5",{className:"border-bottom pb-2 text-center",children:["JOIN - ",l+1]}),(0,y.jsx)("div",{className:"p-2 mt-3 border rounded-3 ",children:(0,y.jsx)("table",{className:"w-100",children:(0,y.jsxs)("tbody",{children:[(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"fa-13 blue-text",children:"Table - 1"}),(0,y.jsx)("td",{className:"fa-13 ",children:(0,y.jsxs)("select",{value:null===e||void 0===e?void 0:e.Join_First_Table_Id,className:"cus-inpt ",onChange:e=>U(e.target.value,l,"Join_First_Table_Id"),required:!0,children:[(0,y.jsx)("option",{value:"",children:"Select"}),null===R||void 0===R||null===(i=R.tables)||void 0===i?void 0:i.map(((e,l)=>{var i;return(0,y.jsx)("option",{value:null===e||void 0===e?void 0:e.Table_Id,disabled:null===R||void 0===R||null===(i=R.tableJoins)||void 0===i?void 0:i.find((l=>(0,C.Qr)(l.Join_First_Table_Id,null===e||void 0===e?void 0:e.Table_Id))),children:null===e||void 0===e?void 0:e.AliasName},l)}))]})})]}),(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"fa-13 blue-text",children:"Table - 2"}),(0,y.jsx)("td",{className:"fa-13 ",children:(0,y.jsxs)("select",{value:null===e||void 0===e?void 0:e.Join_Second_Table_Id,className:"cus-inpt ",onChange:e=>U(e.target.value,l,"Join_Second_Table_Id"),required:!0,children:[(0,y.jsx)("option",{value:"",children:"Select"}),null===R||void 0===R||null===(d=R.tables)||void 0===d?void 0:d.map(((l,i)=>(0,y.jsx)("option",{value:null===l||void 0===l?void 0:l.Table_Id,disabled:(0,C.Qr)(null===e||void 0===e?void 0:e.Join_First_Table_Id,null===l||void 0===l?void 0:l.Table_Id),children:null===l||void 0===l?void 0:l.AliasName},i)))]})})]}),(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"fa-13 blue-text",children:"Table - 1 Key"}),(0,y.jsx)("td",{className:"fa-13 ",children:(0,y.jsxs)("select",{value:null===e||void 0===e?void 0:e.Join_First_Table_Column,className:"cus-inpt ",onChange:e=>U(e.target.value,l,"Join_First_Table_Column"),required:!0,children:[(0,y.jsx)("option",{value:"",children:"Select"}),(null===e||void 0===e?void 0:e.Join_First_Table_Id)&&(null===(n=[...null===R||void 0===R?void 0:R.tables])||void 0===n||null===(o=n.find((l=>(0,C.Qr)(null===l||void 0===l?void 0:l.Table_Id,null===e||void 0===e?void 0:e.Join_First_Table_Id))))||void 0===o||null===(a=o.columns)||void 0===a?void 0:a.map(((e,l)=>(0,C.Qr)(null===e||void 0===e?void 0:e.IS_Join_Key,1)&&(0,y.jsx)("option",{value:null===e||void 0===e?void 0:e.Column_Name,children:null===e||void 0===e?void 0:e.Column_Name},l))))]})})]}),(0,y.jsxs)("tr",{children:[(0,y.jsx)("td",{className:"fa-13 blue-text",children:"Table - 2 Key"}),(0,y.jsx)("td",{className:"fa-13 ",children:(0,y.jsxs)("select",{value:null===e||void 0===e?void 0:e.Join_Second_Table_Column,className:"cus-inpt ",onChange:e=>U(e.target.value,l,"Join_Second_Table_Column"),required:!0,children:[(0,y.jsx)("option",{value:"",children:"Select"}),(null===e||void 0===e?void 0:e.Join_Second_Table_Id)&&(null===(s=[...null===R||void 0===R?void 0:R.tables])||void 0===s||null===(r=s.find((l=>(0,C.Qr)(null===l||void 0===l?void 0:l.Table_Id,null===e||void 0===e?void 0:e.Join_Second_Table_Id))))||void 0===r||null===(t=r.columns)||void 0===t?void 0:t.map(((e,l)=>(0,C.Qr)(null===e||void 0===e?void 0:e.IS_Join_Key,1)&&(0,y.jsx)("option",{value:null===e||void 0===e?void 0:e.Column_Name,children:null===e||void 0===e?void 0:e.Column_Name},l))))]})})]})]})})})]},l)}))})]}),(0,y.jsxs)(b.c,{children:[(0,y.jsx)(a.c,{onClick:()=>V((e=>(0,d.c)((0,d.c)({},e),{},{previewDialog:!1}))),type:"button",startIcon:(0,y.jsx)(h.c,{}),children:"Back"}),(0,y.jsx)(a.c,{type:"submit",startIcon:(0,y.jsx)(p.c,{}),children:"Submit"})]})]})]})]})}}}]);
//# sourceMappingURL=2344.f07a8a8e.chunk.js.map