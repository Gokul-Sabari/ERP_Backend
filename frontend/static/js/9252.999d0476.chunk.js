"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[9252],{19252:(e,s,a)=>{a.r(s),a.d(s,{default:()=>Q});var t=a(30800),n=a(69060),o=a(1908),c=a(56480),i=a(96464),r=a(84936),l=a(27454),d=a(58612),u=a(12572),m=a(3358),h=a(5548),p=a(44380),x=a(9572),g=a(56880),j=a(89e3),v=a(82656),y=a(26773),f=a(4488),C=a(43692),b=a(78092),k=a(90048),I=a(85624),w=a(99904),P=a(33856),S=a(29504),N=a(5930),_=a(4016),A=a(60204),z=a(21420),L=a(93996),E=a(12556),D=a(70296),R=a(83532),O=a(37956),T=a(80156),F=a(57704),W=a(12120),q=a(35064),M=a(36992),H=a(86e3),U=a(39308),B=a(82496);const J=(0,E.cp)(i.c)((e=>{let{theme:s}=e;return{["&.".concat(r.c.head)]:{backgroundColor:"#b8b8b8",color:"#000000",fontWeight:"bold",borderRight:"1px solid #e0e0e0","&:last-child":{borderRight:"none"}},["&.".concat(r.c.body)]:{fontSize:14,padding:"12px 16px",borderRight:"1px solid #e0e0e0","&:last-child":{borderRight:"none"}}}})),V=(0,E.cp)(l.c)((e=>{let{theme:s}=e;return{"&:nth-of-type(even)":{backgroundColor:s.palette.action.hover},"&:hover":{backgroundColor:s.palette.action.selected}}})),G=(0,E.cp)("div")({display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"16px",padding:"16px",backgroundColor:"#f5f5f5",borderTop:"1px solid #e0e0e0"}),K=["Auto_Id","Ledger_Tally_Id","Ledger_Name","Ledger_Alias","Actual_Party_Name_with_Brokers"];const Q=function(){const[e,s]=(0,n.useState)([]),[a,i]=(0,n.useState)([]),[r,E]=(0,n.useState)(0),[Q,X]=(0,n.useState)(5),[Y,Z]=(0,n.useState)([]),[$,ee]=(0,n.useState)(!1),[se,ae]=(0,n.useState)([]),[te,ne]=(0,n.useState)([]),[oe,ce]=(0,n.useState)([]),[ie,re]=(0,n.useState)(!1),[le,de]=(0,n.useState)({}),[ue,me]=(0,n.useState)({}),[he,pe]=(0,n.useState)(""),[xe,ge]=(0,n.useState)({key:null,direction:"asc"}),[je,ve]=(0,n.useState)(!1),[ye,fe]=(0,n.useState)({}),Ce=(0,U.gV)().user,be=JSON.parse(localStorage.getItem("user"));(0,n.useEffect)((()=>{(async()=>{try{const e=await(0,o.q)({address:"masters/columns/dropDown?company_id=".concat(null===be||void 0===be?void 0:be.companyId)});e.success&&ne(e.data)}catch(e){console.error("Error fetching columns:",e)}})()}),[null===be||void 0===be?void 0:be.companyId]),(0,n.useEffect)((()=>{!async function(){try{const e=await(0,o.q)({address:"masters/displayColumn?company_id=".concat(null===be||void 0===be?void 0:be.companyId)});if(!e.success||!Array.isArray(e.data))return void console.error("No display columns found");const a=[...e.data].sort(((e,s)=>e.Position-s.Position));Z(a),ae([...a]);const t=a.filter((e=>1===e.status)).sort(((e,s)=>e.Position-s.Position)).map((e=>({header:e.Alias_Name||e.ColumnName,accessor:e.ColumnName,position:e.Position})));i(t);const n=await(0,o.q)({address:"masters/getlolDetails"});if(n.success&&Array.isArray(n.data)){ce(n.data);const e=t.map((e=>e.accessor)),a=n.data.map((s=>{const a={};return e.forEach((e=>{a[e]=s[e]||""})),a}));s(a)}}catch(e){console.error("Error loading data:",e)}}()}),[]);const ke=e=>{const s=Y.find((s=>s.Id===e));return!!s&&1===s.status},Ie=(e,s)=>{de((a=>(0,t.c)((0,t.c)({},a),{},{[e]:s})))},we=(0,n.useMemo)((()=>{let e=[...oe];return he&&(e=e.filter((e=>Object.values(e).some((e=>String(e).toLowerCase().includes(he.toLowerCase())))))),e=e.filter((e=>Object.keys(ue).every((s=>!ue[s]||String(e[s]).toLowerCase().includes(String(ue[s]).toLowerCase()))))),xe.key&&e.sort(((e,s)=>e[xe.key]<s[xe.key]?"asc"===xe.direction?-1:1:e[xe.key]>s[xe.key]?"asc"===xe.direction?1:-1:0)),e}),[oe,he,ue,xe]);return(0,B.jsxs)(u.c,{sx:{p:3,backgroundColor:"white",borderRadius:"8px",boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,B.jsxs)(u.c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[(0,B.jsx)(g.c,{variant:"h5",children:"LOL List"}),(0,B.jsxs)(u.c,{sx:{display:"flex",alignItems:"center"},children:[(0,B.jsx)(p.c,{variant:"outlined",size:"small",placeholder:"Search...",value:he,onChange:e=>pe(e.target.value),sx:{width:300,mr:2},InputProps:{startAdornment:(0,B.jsx)(x.c,{position:"start",children:(0,B.jsx)(F.c,{})}),endAdornment:he&&(0,B.jsx)(x.c,{position:"end",children:(0,B.jsx)(h.c,{size:"small",onClick:()=>pe(""),children:(0,B.jsx)(T.c,{fontSize:"small"})})})}}),(0,B.jsx)(m.c,{title:"Column Settings",children:(0,B.jsx)(h.c,{onClick:()=>ee(!0),children:(0,B.jsx)(W.c,{})})}),(0,B.jsx)(j.c,{variant:"contained",startIcon:(0,B.jsx)(F.c,{}),onClick:()=>{me((0,t.c)({},le)),E(0)},disabled:0===Object.keys(le).length,sx:{ml:2},children:"Apply Filters"}),(0,B.jsx)(j.c,{variant:"outlined",startIcon:(0,B.jsx)(T.c,{}),onClick:()=>{de({}),me({}),pe(""),E(0)},disabled:0===Object.keys(ue).length&&!he,sx:{ml:1},children:"Clear All"})]})]}),(0,B.jsxs)(v.c,{open:$,onClose:()=>ee(!1),maxWidth:"lg",fullWidth:!0,children:[(0,B.jsx)(y.c,{children:"Column Settings"}),(0,B.jsx)(f.c,{children:(0,B.jsx)("div",{className:"row",children:te.sort(((e,s)=>e.Position-s.Position)).map((e=>{var s,a;return(0,B.jsx)("div",{className:"col-lg-4 col-md-6 p-2",children:(0,B.jsx)(C.c,{className:"p-2",children:(0,B.jsxs)("div",{className:"d-flex justify-content-between align-items-center flex-wrap",children:[(0,B.jsx)(b.c,{checked:ke(e.Id),onChange:s=>((e,s)=>{const a=te.find((s=>s.Id===e));if((null===a||void 0===a?void 0:a.Position)<=5)return void c.m4.error("First 5 columns cannot be disabled");let n;if(Y.some((s=>s.Id===e)))n=Y.map((a=>a.Id===e?(0,t.c)((0,t.c)({},a),{},{status:s?1:0}):a));else{const a=te.find((s=>s.Id===e));n=a?[...Y,(0,t.c)((0,t.c)({},a),{},{status:s?1:0})]:[...Y]}n.sort(((e,s)=>e.Position-s.Position)),Z(n)})(e.Id,s.target.checked),disabled:e.Position<=5,color:e.Position<=5?"default":"primary"}),(0,B.jsx)("div",{children:null===e||void 0===e?void 0:e.ColumnName}),(0,B.jsxs)("div",{className:"d-flex align-items-center gap-2",children:[(0,B.jsx)(p.c,{type:"number",size:"small",variant:"outlined",value:null!==(s=e.Position)&&void 0!==s?s:0,onChange:s=>((e,s)=>{const a=parseInt(s);isNaN(a)||ne((s=>s.map((s=>s.Id===e?(0,t.c)((0,t.c)({},s),{},{Position:a}):s))))})(e.Id,s.target.value),sx:{width:"70px"},inputProps:{min:1,readOnly:K.includes(e.ColumnName)},disabled:K.includes(e.ColumnName)}),(0,B.jsx)(p.c,{size:"small",variant:"outlined",value:null!==(a=e.Alias_Name)&&void 0!==a?a:"",onChange:s=>{return a=e.Id,n=s.target.value,void ne((e=>e.map((e=>e.Id===a?(0,t.c)((0,t.c)({},e),{},{Alias_Name:n}):e))));var a,n}})]})]})})},e.Id)}))})}),(0,B.jsxs)(k.c,{children:[(0,B.jsx)(j.c,{onClick:()=>{Z([...se]),ne([...se])},variant:"outlined",children:"Reset"}),(0,B.jsx)(j.c,{onClick:()=>ee(!1),color:"error",children:"Close"}),(0,B.jsx)(j.c,{onClick:async()=>{re(!0);try{const e=Y.map((e=>{const s=te.find((s=>s.Id===e.Id));return s?(0,t.c)((0,t.c)({},e),{},{Position:s.Position,Alias_Name:s.Alias_Name}):e})),a={},n=new Set;if(e.forEach((e=>{a[e.Position]&&n.add(e.Position),a[e.Position]=!0})),n.size>0){const e=Array.from(n).join(", ");return void c.m4.error("Duplicate positions found: ".concat(e))}Z(e),ae(e);const r=await(0,o.q)({address:"masters/updateColumnChanges",method:"PUT",bodyData:{columns:e.map((e=>({id:e.Id,status:e.status,position:e.Position,alias_name:e.Alias_Name,column_name:e.ColumnName}))),company_id:null===be||void 0===be?void 0:be.companyId}});if(!r.success)throw new Error(r.message||"Failed to update column statuses");const l=e.filter((e=>1===e.status)).sort(((e,s)=>e.Position-s.Position)).map((e=>({header:e.Alias_Name||e.ColumnName,accessor:e.ColumnName,position:e.Position})));if(i(l),oe.length>0){const e=l.map((e=>e.accessor)),a=oe.map((s=>{const a={};return e.forEach((e=>{a[e]=s[e]||""})),a}));s(a)}ee(!1),c.m4.success("Changes Saved")}catch(e){console.error("Error updating column statuses:",e),c.m4.error(e.message||"Failed to update columns. Please try again.")}finally{re(!1)}},variant:"contained",color:"primary",disabled:ie,children:ie?"Applying...":"Apply"})]})]}),(0,B.jsxs)(v.c,{open:je,onClose:()=>ve(!1),maxWidth:"md",fullWidth:!0,children:[(0,B.jsx)(y.c,{children:"Edit Row"}),(0,B.jsx)("div",{className:"container-fluid",style:{maxHeight:"80vh",overflow:"auto"},children:(0,B.jsx)("div",{className:"row g-3",children:a.map((e=>(0,B.jsx)("div",{className:"col-12 col-sm-6 col-md-4",children:(0,B.jsxs)("div",{className:"form-group",children:[(0,B.jsx)("label",{className:"form-label",children:e.header}),(0,B.jsx)("input",{type:"text",className:"form-control form-control-lg",value:ye[e.accessor]||"",onChange:s=>fe((0,t.c)((0,t.c)({},ye),{},{[e.accessor]:s.target.value})),disabled:"Auto_Id"===e.accessor||"Ledger_Tally_Id"===e.accessor||"Ledger_Name"===e.accessor,style:{padding:"1rem 1rem",fontSize:"1rem"}})]})},e.accessor)))})}),(0,B.jsxs)(k.c,{children:[(0,B.jsx)(j.c,{onClick:()=>ve(!1),variant:"outlined",startIcon:(0,B.jsx)(q.c,{}),children:"Cancel"}),(0,B.jsx)(j.c,{onClick:async()=>{try{const e=await(0,o.q)({address:"masters/updateDetails",method:"PUT",bodyData:ye,headers:{Db:null===Ce||void 0===Ce?void 0:Ce.Company_id}});if(!e.success)throw new Error(e.message||"Failed to update row");ce((e=>e.map((e=>e.Auto_Id===ye.Auto_Id?ye:e)))),s((e=>e.map((e=>e.Auto_Id===ye.Auto_Id?ye:e)))),ve(!1),c.m4.success("Data updated successfully")}catch(e){console.error("Error updating row:",e),c.m4.error("Failed to update row")}},variant:"contained",color:"primary",startIcon:(0,B.jsx)(M.c,{}),children:"Save Changes"})]})]}),a.length>0&&oe.length>0?(0,B.jsxs)(I.c,{elevation:0,sx:{border:"1px solid #e0e0e0"},children:[(0,B.jsx)(w.c,{children:(0,B.jsxs)(P.c,{stickyHeader:!0,"aria-label":"ledger table",sx:{minWidth:650},children:[(0,B.jsx)(d.c,{children:(0,B.jsxs)(l.c,{children:[(0,B.jsx)(J,{align:"center",sx:{width:"80px"},children:"S.No"}),(0,B.jsx)(J,{align:"center",sx:{width:"80px"},children:"Actions"}),a.map((e=>(0,B.jsxs)(J,{align:"center",children:[(0,B.jsxs)(u.c,{sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:[e.header,(0,B.jsx)(m.c,{title:"Sort ".concat(xe.key===e.accessor&&"asc"===xe.direction?"Descending":"Ascending"),children:(0,B.jsx)(h.c,{size:"small",onClick:()=>(e=>{let s="asc";xe.key===e&&"asc"===xe.direction&&(s="desc"),ge({key:e,direction:s})})(e.accessor),color:xe.key===e.accessor?"primary":"default",children:xe.key===e.accessor?"asc"===xe.direction?(0,B.jsx)(D.c,{}):(0,B.jsx)(R.c,{}):(0,B.jsx)(O.c,{})})})]}),(0,B.jsx)(p.c,{size:"small",variant:"outlined",placeholder:"Filter...",value:le[e.accessor]||"",onChange:s=>Ie(e.accessor,s.target.value),sx:{width:"100%",mt:1},InputProps:{endAdornment:le[e.accessor]&&(0,B.jsx)(x.c,{position:"end",children:(0,B.jsx)(h.c,{size:"small",onClick:()=>Ie(e.accessor,""),children:(0,B.jsx)(T.c,{fontSize:"small"})})})}})]},e.accessor)))]})}),(0,B.jsx)(S.c,{children:we.slice(r*Q,r*Q+Q).map(((e,s)=>(0,B.jsxs)(V,{children:[(0,B.jsx)(J,{align:"center",children:r*Q+s+1}),(0,B.jsx)(J,{align:"center",children:(0,B.jsx)(m.c,{title:"Edit",children:(0,B.jsx)(h.c,{onClick:()=>{return s=e,fe((0,t.c)({},s)),void ve(!0);var s},color:"primary",size:"small",sx:{"&:hover":{backgroundColor:"rgba(25, 118, 210, 0.08)",transform:"scale(1.1)"},transition:"transform 0.2s"},children:(0,B.jsx)(H.c,{fontSize:"small"})})})}),a.map((a=>(0,B.jsx)(J,{align:"center",children:e[a.accessor]},"".concat(s,"-").concat(a.accessor))))]},s)))})]})}),(0,B.jsxs)(G,{children:[(0,B.jsx)(N.c,{component:"div",count:we.length,rowsPerPage:Q,page:r,onPageChange:(e,s)=>{E(s)},rowsPerPageOptions:[],sx:{"& .MuiTablePagination-toolbar":{padding:0,minHeight:"auto"},"& .MuiTablePagination-spacer":{display:"none"},"& .MuiTablePagination-actions":{marginLeft:"16px"}}}),(0,B.jsxs)(_.c,{variant:"outlined",size:"small",sx:{minWidth:120},children:[(0,B.jsx)(A.c,{children:"Rows per page"}),(0,B.jsx)(z.c,{value:Q,onChange:e=>{X(parseInt(e.target.value,10)),E(0)},label:"Rows per page",children:(()=>{const s=[5,10,15,30,60,120,240],a=Math.max(...s);return e.length>a?[...s]:s})().map((e=>(0,B.jsx)(L.c,{value:e,children:e},e)))})]})]})]}):(0,B.jsx)(g.c,{children:"Loading..."})]})}}}]);
//# sourceMappingURL=9252.999d0476.chunk.js.map