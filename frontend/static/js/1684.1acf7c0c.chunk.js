"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[1684],{62344:(e,t,a)=>{a.d(t,{o$:()=>r,o5:()=>l,cF:()=>s,iI:()=>c});var n=a(30800);const o=a.p+"static/media/smt.aa4d4f940bbebff07a57.png",c={table:{style:{width:"auto",backgroundColor:"transparent"}},rows:{style:{backgroundColor:"transparent"}},headCells:{style:{backgroundColor:"#6b9080f8",color:"white",fontSize:"14px"}}},s={control:(e,t)=>(0,n.c)((0,n.c)({},e),{},{height:"45px",background:"rgba(255, 255, 255, 0.322)"}),menu:(e,t)=>(0,n.c)((0,n.c)({},e),{},{zIndex:9999}),menuPortal:e=>(0,n.c)((0,n.c)({},e),{},{zIndex:9999})},r=[{id:1,headname:"Menu ID",variant:"head",align:"left",width:100},{id:2,headname:"MenuName"},{id:3,headname:"Read Rights"},{id:4,headname:"Add Rights"},{id:5,headname:"Edit Rights"},{id:6,headname:"Delete Rights"},{id:7,headname:"Print Rights"},{id:8,headname:"Action"}],l=[{dataBase:1,name:"SHANKAR TRADERS",business:"Wholesale Merchant in Dhall",address:"32, Chitrakara Street, Madurai - 01 <br /> Bill of Supply -Disclaimer Affidavlt Field Extemped",logo:o,gstin:"33AADFS6973R1ZD",phone:"984-313-1353, 984-335-5166",fssai:"12418012000818",bankAccount:"0021 5032 0885 122",ifsc:"TMBL0000002"},{dataBase:2,name:"SMT AGRO PRODUCTS",business:"",address:"H.O: 153, Chitrakara Street, 2nd Floor, Madurai -01 <br /> G.O: 746 Puliyur, Sayanapuram, Svga <br /> Bill of Supply -Disclaimer Affidavlt Field Extemped",logo:o,gstin:"33ACMFS3420Q1ZQ",phone:"0452-4371625",fssai:"12418012000818",bankAccount:"0025 3031 0875 947",ifsc:"TMBL0000002"},{dataBase:3,name:"BHAVANI TRADERS",business:"",address:"H.O: 152-A, Chitrakara Street, Madurai -01 <br /> G.O: 30/1-Rajman Nagar, Chintamani Main Road, Mdu-01 <br /> Tax Invoice",logo:o,gstin:"33AAEFB6728J1ZG",phone:"958-559-7641, 958-559-7614",fssai:"12418012000670",bankAccount:"0021 5005 0800 309",ifsc:"TMBL0000002"}]},27112:(e,t,a)=>{a.r(t),a.d(t,{default:()=>N});var n=a(30800),o=a(69060),c=a(82656),s=a(26773),r=a(4488),l=a(71448),d=a(44380),i=a(90048),u=a(89e3),m=a(43692),p=a(84436),h=a(27532),y=a(40656),g=a(62344),v=a(1908),f=a(13724),D=a(35832),A=a(77536),x=a(56480),b=a(82496);const N=(e,t)=>{var a;const[N,C]=(0,o.useState)(!0),S=JSON.parse(localStorage.getItem("user")),I=null===S||void 0===S?void 0:S.UserTypeId,w=S,[E,j]=(0,o.useState)([]),[_,k]=(0,o.useState)([]),{contextObj:T}=(0,o.useContext)(A.a),[L,M]=(0,o.useState)([]),R=null===T||void 0===T?void 0:T.Add_Rights,O=()=>{const e=new Date,t=e.getFullYear(),a=(e.getMonth()+1).toString().padStart(2,"0");return"".concat(t,"-").concat(a)},F={From:O(),To:O(),EmpId:0,Name:""},[P,U]=(0,o.useState)(!1),[B,$]=(0,o.useState)(F),[H,W]=(0,o.useState)([]),[z,q]=(0,o.useState)(!1),[V,G]=(0,o.useState)("ALL"),[J,Z]=(0,o.useState)(B);(0,o.useEffect)((()=>{const e=setTimeout((()=>{Z(B)}),500);return()=>clearTimeout(e)}),[B]),(0,o.useEffect)((()=>{const e=null===S||void 0===S?void 0:S.UserTypeId,t=null===S||void 0===S?void 0:S.UserId,a=null===S||void 0===S?void 0:S.Company_id;(0,v.q)({address:"masters/users/employee/dropDown?Company_id=".concat(a),headers:{Authorization:"Bearer ".concat(localStorage.getItem("Autheticate_Id"))}}).then((a=>{if(a.success){let o=[];1===Number(e)||0===Number(e)||1===Number(R)?(o=a.data,$((e=>(0,n.c)((0,n.c)({},e),{},{EmpId:0,Name:"ALL"}))),q(!1),G("ALL")):(o=a.data.filter((e=>e.UserId===t)),$((e=>(0,n.c)((0,n.c)({},e),{},{EmpId:t,Name:null===S||void 0===S?void 0:S.Name}))),q(!0),G(null===S||void 0===S?void 0:S.Name)),W(o)}})).catch((e=>console.error("Error fetching employees:",e)))}),[null===S||void 0===S?void 0:S.UserTypeId,null===S||void 0===S?void 0:S.UserId,null===S||void 0===S?void 0:S.Company_id,null===S||void 0===S?void 0:S.Name]);const Q=e=>{if(!e)return 0;const[t,a]=e.split("-");return new Date(t,a,0).getDate()};(0,o.useEffect)((()=>{const{From:e,EmpId:t}=J;e&&(t||0===t)&&((async(e,t)=>{try{const a=null===S||void 0===S?void 0:S.UserTypeId,[n,o]=e.split("-"),c="".concat(n,"-").concat(o,"-01"),s=Q("".concat(n,"-").concat(o)),r="".concat(n,"-").concat(o,"-").concat(s),l=await(0,v.q)({address:"userModule/employeActivity/trackActivitylogAttendance?FromDate=".concat(c,"&ToDate=").concat(r,"&UserTypeId=").concat(a,"&UserId=").concat(t),headers:{Authorization:"Bearer ".concat(localStorage.getItem("Autheticate_Id"))}});l.success&&j(l.data)}catch(a){console.error("Error fetching attendance data:",a)}})(e,t),Y())}),[J]);const Y=async()=>{C(!0);try{const e=await(0,v.q)({address:"masters/Employeedetails/dropDown?Company_id=".concat(w.Company_id)});e.success&&k(e.data)}catch(e){console.error(e),x.m4.error("Failed to fetch employees for dropdown")}finally{C(!1)}},K=e=>{if(!e)return"--";const[t]=e.split("T");return"".concat(t," ")};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(c.c,{open:P,maxWidth:"md",PaperProps:{style:{width:"500px",height:"500px"}},children:[(0,b.jsx)(s.c,{children:"Add Employee"}),(0,b.jsx)(r.c,{children:(0,b.jsx)(l.c,{multiple:!0,options:[{UserId:"all",Name:"ALL"},..._],getOptionLabel:e=>e.Name,isOptionEqualToValue:(e,t)=>e.UserId===t.UserId,onChange:(e,t)=>{if(t.some((e=>"all"===e.UserId)))M(_);else{const e=t.filter(((e,t,a)=>t===a.findIndex((t=>t.UserId===e.UserId))));M(e)}},value:L.some((e=>"all"===e.UserId))?[{UserId:"all",Name:"ALL"}]:L,renderInput:e=>(0,b.jsx)(d.c,(0,n.c)((0,n.c)({},e),{},{placeholder:"Employees"}))})}),(0,b.jsxs)(i.c,{className:"d-flex justify-content-between flex-wrap",children:[(0,b.jsx)(u.c,{type:"button",variant:"outlined",onClick:()=>M([]),children:"Clear"}),(0,b.jsxs)("span",{children:[(0,b.jsx)(u.c,{onClick:()=>{U(!1)},children:"Cancel"}),(0,b.jsx)(u.c,{onClick:()=>{var e;const t=E.filter((e=>L.some((t=>Number(t.UserId)===Number(e.User_Mgt_Id)||"ALL"===t.UserId)))),a=t.reduce(((e,t)=>{const a=t.username;return e[a]||(e[a]=[]),e[a].push(t),e}),{});if(0===Object.keys(a).length)return void x.m4.error("No attendance data found");const o=D.c$.book_new(),c=null===(e=t[0])||void 0===e?void 0:e.LogDate;if(!c)return void console.error("No log date found in the filtered attendance data.");const s=new Date(c),r=s.getFullYear(),l=s.toLocaleString("default",{month:"long"});Object.entries(a).forEach((e=>{let[t,a]=e;const c=a.map((e=>{const t=e.AttendanceDetails?e.AttendanceDetails.split(",").map((e=>e.trim())):[],a={};let o=!0;for(let n=0;n<6;n++){const e=t[n]||"--";a["Punch ".concat(n+1)]=e,"--"!==e&&(o=!1)}const c=o?"A":"P";return(0,n.c)({Employee:e.username,"Log Date":K(e.LogDate),"Attendance Status":c},a)})),s=["Employee","Log Date","Attendance Status",...Array.from({length:6},((e,t)=>"Punch ".concat(t+1)))],r=c.map((e=>s.reduce(((t,a)=>(t[a]=e[a]||"--",t)),{}))),l=t.slice(0,31),d=D.c$.json_to_sheet(r);D.c$.book_append_sheet(o,d,l)}));const d="Attendance_Report_".concat(l,"_").concat(r,".xlsx");D.a8(o,d)},children:"Download"})]})]})]}),(0,b.jsx)(m.c,{children:(0,b.jsxs)(p.c,{sx:{minHeight:"50vh"},children:[(0,b.jsxs)("div",{className:"ps-3 pb-2 pt-0 d-flex align-items-center justify-content-between border-bottom mb-3",children:[(0,b.jsx)("h6",{className:"fa-18",children:"Employee Attendance"}),Number(1===I)||0===Number(I)?(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)("div",{className:"d-flex align-items-center justify-content-start gap-3",children:[(0,b.jsx)(u.c,{onClick:()=>{const e=E.map((e=>{const t=e.AttendanceDetails?e.AttendanceDetails.split(",").map((e=>e.trim())):[],a={};let o=!0;for(let n=0;n<6;n++){const e=t[n]||"--";a["Punch ".concat(n+1)]=e,"--"!==e&&(o=!1)}const c=o?"A":"P";return(0,n.c)({Employee:e.username,"Log Date":K(e.LogDate),"Attendance Status":c},a)})),t=["Employee","Log Date","Attendance Status",...Array.from({length:6},((e,t)=>"Punch ".concat(t+1)))],a=e.map((e=>t.reduce(((t,a)=>(t[a]=e[a]||"--",t)),{}))),o=D.c$.json_to_sheet(a),c=D.c$.book_new();D.c$.book_append_sheet(c,o,"Attendance Report"),D.a8(c,"Attendance_Report.xlsx")},variant:"contained",disabled:0===(null===B||void 0===B?void 0:B.EmpId)||"ALL"===(null===B||void 0===B?void 0:B.Name),children:"Individual Report"}),(0,b.jsx)(u.c,{onClick:()=>{(async()=>{try{const e=B.From,[t,a]=e.split("-"),o="".concat(t,"-").concat(a,"-01"),c=Q("".concat(t,"-").concat(a)),s="".concat(t,"-").concat(a,"-").concat(c),r=await(0,v.q)({address:"userModule/employeActivity/employeeAttendanceModuledownload?FromDate=".concat(o,"&ToDate=").concat(s)});if(r.success){const e=r.data;console.log("overalldata",e);const t=(e,t)=>{const a=[],n=new Date(e),o=new Date(t);for(;n<=o;)a.push(new Date(n).toISOString().split("T")[0]),n.setDate(n.getDate()+1);return{days:a,count:a.length}},{days:a}=t(o,s),c=e.map((e=>{let t=[];try{t=e.AttendanceDetails?JSON.parse(e.AttendanceDetails):[]}catch(s){console.error("Error parsing AttendanceDetails for employee:",e.username,s),t=[]}const o={};let c=0;return a.forEach(((e,a)=>{if(0===new Date(e).getDay())o["Day ".concat(a+1)]="H";else if(Array.isArray(t)){const n=t.find((t=>t.Date===e));o["Day ".concat(a+1)]=n?n.AttendanceStatus:"A",n&&"P"===n.AttendanceStatus&&c++}else o["Day ".concat(a+1)]="A"})),(0,n.c)({EmployeeName:e.username||e.Name,TotalPresent:c},o)})),l=["EmployeeName","TotalPresent",...a.map(((e,t)=>"Day ".concat(t+1)))],d=D.c$.json_to_sheet(c);D.c$.sheet_add_aoa(d,[l],{origin:"A1"});const i=D.c$.book_new();D.c$.book_append_sheet(i,d,"Overall Attendance Report"),D.a8(i,"Overall_Attendance_Report.xlsx")}}catch(e){console.error("Error downloading overall report:",e)}})(null===B||void 0===B||B.From,null===B||void 0===B||B.To)},children:"Monthly Report"}),(0,b.jsx)(u.c,{onClick:()=>{U(!0)},children:"Cummulative Monthly Report"}),(0,b.jsx)(u.c,{onClick:async()=>{try{const e=B.From,[t,a]=e.split("-"),n="".concat(t,"-").concat(a,"-01"),o=Q("".concat(t,"-").concat(a)),c="".concat(t,"-").concat(a,"-").concat(o),s=await(0,v.q)({address:"userModule/employeActivity/employeeAttendanceModuledownload?FromDate=".concat(n,"&ToDate=").concat(c)});if(s.success){const e=s.data,o=(e,t)=>{const a=[],n=new Date(e),o=new Date(t);let c=0;for(;n<=o;){const e=new Date(n).toISOString().split("T")[0];a.push(e),0===n.getDay()&&c++,n.setDate(n.getDate()+1)}return 0===a.length&&a.push("No days in this range"),{days:a,sundayCount:c,totalDays:a.length}},{days:r,sundayCount:l,totalDays:d}=o(n,c);let i=0,u=0;const m=e.map((e=>{const n=e.AttendanceDetails?JSON.parse(e.AttendanceDetails):[];let o=0,c=0;return r.forEach((e=>{if(Array.isArray(n)){const t=n.find((t=>t.Date===e));if(0===new Date(e).getDay())return;t?"P"===t.AttendanceStatus?o++:"A"===t.AttendanceStatus&&c++:c++}})),i+=o,u+=c,{EmployeeName:e.Name,EmployeeID:e.EmployeeID,Month:"".concat(a,"-").concat(t),Branch:e.Branch,NumberOfSundays:l,NumberOfDaysInMonth:d,TotalWorkingDays:o,TotalLeaveDays:c}})).map((e=>({EmployeeName:e.EmployeeName,EmployeeID:e.EmployeeID,Month:e.Month,Branch:e.Branch,NumberOfSundays:e.NumberOfSundays,NumberOfDaysInMonth:e.NumberOfDaysInMonth,TotalWorkingDays:e.TotalWorkingDays,TotalLeaveDays:e.TotalLeaveDays}))),p=D.c$.json_to_sheet(m),h=["EmployeeName","EmployeeID","Month","Branch","NumberOfSundays","NumberOfDaysInMonth","TotalWorkingDays","TotalLeaveDays"];D.c$.sheet_add_aoa(p,[h],{origin:"A1"});const y=D.c$.book_new();D.c$.book_append_sheet(y,p,"Attendance Summary Report"),D.a8(y,"Attendance_Summary_Report.xlsx")}}catch(e){console.error("Error downloading overall report:",e)}},children:"Summary"})]})}):(0,b.jsx)("div",{children:" "})]}),(0,b.jsxs)("div",{className:"px-2 row mb-4",children:[(0,b.jsxs)("div",{className:"col-xl-2 col-lg-3 col-md-4 col-sm-6 p-2",children:[(0,b.jsx)("label",{children:"Employee"}),(0,b.jsx)(y.cp,{value:{value:null===B||void 0===B?void 0:B.EmpId,label:null===B||void 0===B?void 0:B.Name},onChange:e=>$((0,n.c)((0,n.c)({},B),{},{EmpId:e.value,Name:e.label})),options:[{value:0,label:"ALL"},...H.map((e=>({value:null===e||void 0===e?void 0:e.UserId,label:null===e||void 0===e?void 0:e.Name})))],styles:g.cF,isSearchable:!0,placeholder:V,isDisabled:z})]}),(0,b.jsxs)("div",{className:"col-xl-2 col-lg-3 col-md-4 col-sm-6 p-2",children:[(0,b.jsx)("label",{children:"From"}),(0,b.jsx)("input",{type:"month",className:"cus-inpt",value:null===B||void 0===B||null===(a=B.From)||void 0===a?void 0:a.slice(0,7),onChange:e=>{const t=e.target.value,[a,n]=t.split("-"),o="".concat(a,"-").concat(n,"-01"),c=(e=>{if(!e)return 0;const[t,a]=e.split("-");return new Date(t,a,0).getDate()})("".concat(a,"-").concat(n)),s="".concat(a,"-").concat(n,"-").concat(c);$({From:o,To:s,EmpId:B.EmpId||0,Name:null===B||void 0===B?void 0:B.Name})}})]})]}),(0,b.jsx)(f.cp,{dataArray:E,columns:[{isCustomCell:!0,Cell:e=>{let{row:t}=e;return t.username},ColumnHeader:"Employee",isVisible:1,width:"20%",CellProps:{sx:{padding:"10px",textAlign:"left",fontWeight:"bold"}}},{isCustomCell:!0,Cell:e=>{let{row:t}=e;return K(t.LogDate||"--")},ColumnHeader:"Log Date",isVisible:1,width:"20%",CellProps:{sx:{padding:"10px",textAlign:"center",color:"gray"}}},{isCustomCell:!0,ColumnHeader:"Punch Details",isVisible:1,width:"40%",CellProps:{sx:{display:"flex",flexWrap:"wrap",justifyContent:"center"}},Cell:e=>{let{row:t}=e;return(0,b.jsx)("div",{style:{display:"flex",flexWrap:"wrap",justifyContent:"center"},children:t.AttendanceDetails?t.AttendanceDetails.split(",").map((e=>e.trim())).filter((e=>""!==e)).map(((e,t)=>{const a=e.split(" (")[0];return(0,b.jsx)(h.c,{label:a,variant:"outlined",size:"small",sx:{margin:"2px",color:"green"}},t)})):(0,b.jsx)("div",{children:"No Punch Details"})})}}],EnableSerialNumber:!0,CellSize:"small",disablePagination:!1})]})})]})}},84436:(e,t,a)=>{a.d(t,{c:()=>g});var n=a(45072),o=a(95656),c=a(69060),s=a(79736),r=a(21412),l=a(12556),d=a(49836),i=a(10099),u=a(33448);function m(e){return(0,u.cp)("MuiCardContent",e)}(0,i.c)("MuiCardContent",["root"]);var p=a(82496);const h=["className","component"],y=(0,l.cp)("div",{name:"MuiCardContent",slot:"Root",overridesResolver:(e,t)=>t.root})((()=>({padding:16,"&:last-child":{paddingBottom:24}}))),g=c.forwardRef((function(e,t){const a=(0,d.C)({props:e,name:"MuiCardContent"}),{className:c,component:l="div"}=a,i=(0,o.c)(a,h),u=(0,n.c)({},a,{component:l}),g=(e=>{const{classes:t}=e;return(0,r.c)({root:["root"]},m,t)})(u);return(0,p.jsx)(y,(0,n.c)({as:l,className:(0,s.c)(g.root,c),ownerState:u,ref:t},i))}))}}]);
//# sourceMappingURL=1684.1acf7c0c.chunk.js.map