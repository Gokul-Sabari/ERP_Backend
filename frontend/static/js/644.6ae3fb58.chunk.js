"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[644],{80644:(e,l,s)=>{s.r(l),s.d(l,{default:()=>k});var a=s(30800),t=s(69060),o=s(43692),r=s(89e3),n=s(84436),c=s(5548),d=s(62344),i=s(56480),u=s(39308),m=s(96064),v=s(81256),p=s(86e3),x=s(45180),h=s(1908),_=s(13724),g=s(128),j=s(51560),I=s(63656),b=s(40656),N=s(82496);const S=e=>{let{StaffArray:l=[],setStaffArray:s,costCenter:t=[],costCategory:o=[]}=e;return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)("div",{className:"d-flex align-items-center flex-wrap mb-2 border-bottom pb-2",children:[(0,N.jsx)("h6",{className:"flex-grow-1 m-0",children:"Staff Involved"}),(0,N.jsx)(r.c,{variant:"outlined",color:"primary",type:"button",onClick:()=>s((e=>[...e,(0,a.c)({},I.IF)])),children:"Add"})]}),(0,N.jsxs)("table",{className:"table table-bordered",children:[(0,N.jsx)("thead",{children:(0,N.jsxs)("tr",{children:[(0,N.jsx)("th",{className:"fa-13",children:"Sno"}),(0,N.jsx)("th",{className:"fa-13",children:"Staff Name"}),(0,N.jsx)("th",{className:"fa-13",children:"Category"}),(0,N.jsx)("th",{className:"fa-13",children:"#"})]})}),(0,N.jsx)("tbody",{children:(0,u.dq)(l).map(((e,r)=>(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{className:"fa-13 vctr text-center",children:r+1}),(0,N.jsx)("td",{className:"fa-13 w-100 p-0",children:(0,N.jsx)(b.cp,{value:{value:null===e||void 0===e?void 0:e.Emp_Id,label:null===e||void 0===e?void 0:e.Emp_Name},onChange:e=>s((l=>l.map(((l,s)=>{if((0,u.Qr)(s,r)){const s=(0,u.dq)(t).find((l=>(0,u.Qr)(null===l||void 0===l?void 0:l.Cost_Center_Id,e.value)));return(0,a.c)((0,a.c)({},l),{},{Emp_Type_Id:(0,u.Q$)(null===l||void 0===l?void 0:l.Emp_Type_Id)?Number(null===l||void 0===l?void 0:l.Emp_Type_Id):(0,u.Q$)(s.User_Type)?Number(s.User_Type):0,Emp_Id:Number(e.value),Emp_Name:e.label})}return l})))),options:[...(0,u.dq)(t).filter((e=>!l.some((l=>(0,u.Qr)(l.Emp_Id,e.Cost_Center_Id)))))].map((e=>({value:e.Cost_Center_Id,label:e.Cost_Center_Name}))),styles:d.cF,isSearchable:!0,placeholder:"Select Staff"})}),(0,N.jsx)("td",{className:"fa-13 vctr p-0",style:{maxWidth:"130px",minWidth:"100px"},children:(0,N.jsxs)("select",{value:null===e||void 0===e?void 0:e.Emp_Type_Id,onChange:e=>s((l=>l.map(((l,s)=>(0,u.Qr)(s,r)?(0,a.c)((0,a.c)({},l),{},{Emp_Type_Id:e.target.value}):l)))),className:"cus-inpt p-2 border-0",children:[(0,N.jsx)("option",{value:"",children:"Select"}),(0,u.dq)(o).map(((e,l)=>(0,N.jsx)("option",{value:null===e||void 0===e?void 0:e.Cost_Category_Id,children:null===e||void 0===e?void 0:e.Cost_Category},l)))]})}),(0,N.jsx)("td",{className:"fa-13 vctr p-0",children:(0,N.jsx)(c.c,{onClick:()=>{s((e=>e.filter(((e,l)=>r!==l))))},size:"small",children:(0,N.jsx)(x.c,{color:"error"})})})]},r)))})]})]})};var f=s(64568);const y=e=>{var l;let{invoiceInfo:s={},setInvoiceInfo:t,retailers:o=[],voucherType:r=[],branches:n=[],onChangeRetailer:c,stockItemLedgerName:i=[]}=e;const m="cus-inpt p-2";return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)("div",{className:"row",children:[(0,N.jsxs)("div",{className:"col-sm-8 p-2",children:[(0,N.jsx)("label",{className:"fa-13",children:"Party Name"}),(0,N.jsx)(b.cp,{value:{value:null===s||void 0===s?void 0:s.Retailer_Id,label:null===s||void 0===s?void 0:s.Retailer_Name},onChange:e=>{t((l=>(0,a.c)((0,a.c)({},l),{},{Retailer_Id:e.value,Retailer_Name:e.label}))),c&&c()},options:[{value:"",label:"Search",isDisabled:!0},...(0,u.dq)(o).map((e=>({value:null===e||void 0===e?void 0:e.Retailer_Id,label:null===e||void 0===e?void 0:e.Retailer_Name})))],styles:d.cF,isSearchable:!0,placeholder:"Select Vendor",maxMenuHeight:300})]}),(0,N.jsxs)("div",{className:"col-sm-4 p-2",children:[(0,N.jsx)("label",{className:"fa-13",children:"Voucher Type"}),(0,N.jsx)(b.cp,{value:{value:s.Voucher_Type,label:null===(l=(0,u.dq)(r).find((e=>(0,u.Qr)(e.Vocher_Type_Id,s.Voucher_Type))))||void 0===l?void 0:l.Voucher_Type},onChange:e=>t((l=>(0,a.c)((0,a.c)({},l),{},{Voucher_Type:e.value}))),options:[{value:"",label:"Search",isDisabled:!0},...(0,u.dq)(r).filter((e=>"SALES"===(null===e||void 0===e?void 0:e.Type))).map((e=>({value:null===e||void 0===e?void 0:e.Vocher_Type_Id,label:null===e||void 0===e?void 0:e.Voucher_Type})))],styles:d.cF,isSearchable:!0,required:!0,placeholder:"Select Voucher Type",maxMenuHeight:300,isDisabled:(0,u.Q$)(null===s||void 0===s?void 0:s.Do_Id)})]}),(0,N.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,N.jsxs)("label",{className:"fa-13",children:["Entry Date ",(0,N.jsx)(f.c,{})]}),(0,N.jsx)("input",{value:null===s||void 0===s?void 0:s.Do_Date,type:"date",required:!0,className:m,onChange:e=>t((l=>(0,a.c)((0,a.c)({},l),{},{Do_Date:e.target.value})))})]}),(0,N.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,N.jsxs)("label",{className:"fa-13",children:["Branch ",(0,N.jsx)(f.c,{})]}),(0,N.jsxs)("select",{className:m,value:null===s||void 0===s?void 0:s.Branch_Id,required:!0,onChange:e=>t((l=>(0,a.c)((0,a.c)({},l),{},{Branch_Id:e.target.value}))),children:[(0,N.jsx)("option",{value:"",children:"select"}),n.map(((e,l)=>(0,N.jsx)("option",{value:null===e||void 0===e?void 0:e.BranchId,children:null===e||void 0===e?void 0:e.BranchName},l)))]})]}),(0,N.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,N.jsxs)("label",{className:"fa-13",children:["GST Type ",(0,N.jsx)(f.c,{})]}),(0,N.jsxs)("select",{className:m,onChange:e=>t((l=>(0,a.c)((0,a.c)({},l),{},{GST_Inclusive:Number(e.target.value)}))),value:s.GST_Inclusive,required:!0,children:[(0,N.jsx)("option",{value:1,children:"Inclusive Tax"}),(0,N.jsx)("option",{value:0,children:"Exclusive Tax"}),(0,N.jsx)("option",{value:2,children:"Not Taxable"})]})]}),(0,N.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,N.jsx)("label",{className:"fa-13",children:"Tax Type"}),(0,N.jsxs)("select",{className:m,onChange:e=>t((l=>(0,a.c)((0,a.c)({},l),{},{IS_IGST:Number(e.target.value)}))),value:s.IS_IGST,children:[(0,N.jsx)("option",{value:"0",children:"GST"}),(0,N.jsx)("option",{value:"1",children:"IGST"})]})]}),(0,N.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,N.jsx)("label",{className:"fa-13",children:"Stock Item Ledger Name"}),(0,N.jsx)(b.cp,{value:{value:s.Stock_Item_Ledger_Name,label:s.Stock_Item_Ledger_Name},onChange:e=>t((l=>(0,a.c)((0,a.c)({},l),{},{Stock_Item_Ledger_Name:e.value}))),options:[{value:"",label:"Search",isDisabled:!0},...i.map((e=>({value:null===e||void 0===e?void 0:e.Stock_Item_Ledger_Name,label:null===e||void 0===e?void 0:e.Stock_Item_Ledger_Name})))],styles:d.cF,menuPortalTarget:document.body,required:!0,isSearchable:!0,placeholder:"Select",maxMenuHeight:300})]}),(0,N.jsxs)("div",{className:"col-xl-3 col-md-4 col-sm-6 p-2",children:[(0,N.jsx)("label",{className:"fa-13",children:"Status"}),(0,N.jsxs)("select",{value:null===s||void 0===s?void 0:s.Cancel_status,className:m,onChange:e=>t((l=>(0,a.c)((0,a.c)({},l),{},{Cancel_status:e.target.value}))),children:[(0,N.jsx)("option",{value:"",disabled:!0,children:"Select"}),(0,N.jsx)("option",{value:"1",children:"New"}),(0,N.jsx)("option",{value:"2",children:"Progess"}),(0,N.jsx)("option",{value:"3",children:"Completed"}),(0,N.jsx)("option",{value:"0",children:"Canceled"})]})]})]}),(0,N.jsx)("label",{className:"fa-13",children:"Narration"}),(0,N.jsx)("textarea",{className:"cus-inpt fa-14",rows:2,value:s.Narration,onChange:e=>t((l=>(0,a.c)((0,a.c)({},l),{},{Narration:e.target.value})))})]})},T=function(){var e;let l=arguments.length>1?arguments[1]:void 0;return null!==(e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).find((e=>(0,u.Qr)(e.Product_Id,l))))&&void 0!==e?e:{}},C=e=>{let{invoiceProducts:l=[],invoiceExpences:s=[],isNotTaxableBill:a,isInclusive:o,IS_IGST:r,products:n=[]}=e;const c=(0,t.useMemo)((()=>(0,u.dq)(s).reduce(((e,l)=>(0,u.Q5)(e,null===l||void 0===l?void 0:l.Expence_Value)),0)),[s]),d=(0,t.useMemo)((()=>{const e=l.reduce(((e,l)=>{const s=(0,u.kR)(null===l||void 0===l?void 0:l.Amount);if(a)return(0,u.Q5)(e,s);const t=T(n,l.Item_Id),c=r?t.Igst_P:t.Gst_P;return o?(0,u.Q5)(e,(0,g.O)(s,c,"remove").with_tax):(0,u.Q5)(e,(0,g.O)(s,c,"add").with_tax)}),0);return(0,u.Q5)(e,c)}),[l,a,n,r,o,c]),i=(0,t.useMemo)((()=>{const e=l.reduce(((e,l)=>{const s=(0,u.kR)(null===l||void 0===l?void 0:l.Amount);if(a)return{TotalValue:(0,u.Q5)(e.TotalValue,s),TotalTax:0};const t=T(n,l.Item_Id),c=r?t.Igst_P:t.Gst_P,d=(0,g.O)(s,c,o?"remove":"add");return{TotalValue:(0,u.Q5)(e.TotalValue,d.without_tax),TotalTax:(0,u.Q5)(e.TotalTax,d.tax_amount)}}),{TotalValue:0,TotalTax:0}),t=(0,u.dq)(s).reduce(((e,l)=>(0,u.Q5)(e,r?null===l||void 0===l?void 0:l.Igst_Amo:(0,u.Q5)(null===l||void 0===l?void 0:l.Cgst_Amo,null===l||void 0===l?void 0:l.Sgst_Amo))),0);return{TotalValue:e.TotalValue,TotalTax:(0,u.Q5)(e.TotalTax,t)}}),[l,a,n,r,o,s]);return(0,N.jsx)(N.Fragment,{children:(0,N.jsx)("table",{className:"table",children:(0,N.jsxs)("tbody",{children:[(0,N.jsxs)("tr",{children:[(0,N.jsxs)("td",{className:"border p-2",rowSpan:r?5:6,children:["Total in words: ",(0,u.m4)(parseInt(d))]}),(0,N.jsx)("td",{className:"border p-2",children:"Total Taxable Amount"}),(0,N.jsx)("td",{className:"border p-2",children:(0,u.SA)(i.TotalValue)})]}),r?(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{className:"border p-2",children:"IGST"}),(0,N.jsx)("td",{className:"border p-2",children:(0,u.SA)((0,u.kR)(i.TotalTax))})]}):(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{className:"border p-2",children:"CGST"}),(0,N.jsx)("td",{className:"border p-2",children:(0,u.SA)((0,u.kR)(i.TotalTax/2))})]}),(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{className:"border p-2",children:"SGST"}),(0,N.jsx)("td",{className:"border p-2",children:(0,u.SA)((0,u.kR)(i.TotalTax/2))})]})]}),(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{className:"border p-2",children:"Total Expences"}),(0,N.jsx)("td",{className:"border p-2",children:(0,u.kR)(c)})]}),(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{className:"border p-2",children:"Round Off"}),(0,N.jsx)("td",{className:"border p-2",children:(0,u.kR)(Math.round(d)-d)})]}),(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{className:"border p-2",children:"Total"}),(0,N.jsx)("td",{className:"border p-2",children:(0,u.SA)(Math.round(d))})]})]})})})};var A=s(664),E=s(52204);const w=e=>{let{invoiceExpences:l=[],setInvoiceExpences:s,expenceMaster:t=[],IS_IGST:n,taxType:d}=e;return(0,N.jsx)(N.Fragment,{children:(0,N.jsxs)(o.c,{children:[(0,N.jsxs)("div",{className:"d-flex align-items-center justify-content-between flex-wrap px-3 py-2",children:[(0,N.jsx)("h5",{className:"m-0",children:"Expenses"}),(0,N.jsx)(r.c,{variant:"outlined",type:"button",onClick:()=>{s((e=>[...e,(0,a.c)((0,a.c)({},I.ox),{},{Sno:e.length})]))},children:"Add"})]}),(0,N.jsx)("div",{className:"table-responsive",children:(0,N.jsxs)("table",{className:"table table-bordered m-0",children:[(0,N.jsx)("thead",{className:"table-light",children:(0,N.jsx)("tr",{children:["S.No","Expense","Expense Value","Action"].map(((e,l)=>(0,N.jsx)("th",{className:"fa-13 bg-light",children:e},l)))})}),(0,N.jsxs)("tbody",{style:{fontSize:"13px"},children:[l.map(((e,o)=>{var r;return(0,N.jsxs)("tr",{children:[(0,N.jsx)("td",{children:o+1}),(0,N.jsx)("td",{className:"p-0 vctr",style:{minWidth:"180px"},children:(0,N.jsx)(b.cp,{value:{value:null===e||void 0===e?void 0:e.Expense_Id,label:(null===(r=t.find((l=>(0,u.Qr)(l.Id,null===e||void 0===e?void 0:e.Expense_Id))))||void 0===r?void 0:r.Expence_Name)||""},onChange:e=>((e,l)=>{const o=t.find((e=>(0,u.Qr)(e.Id,l.value)))||{};s((l=>l.map(((l,s)=>s!==e?l:(0,a.c)((0,a.c)({},l),{},{Expense_Id:o.Id,Expence_Value:0})))))})(o,e),options:t.filter((e=>!l.some((l=>l.Expense_Id===e.Id)))).map((e=>({value:e.Id,label:e.Expence_Name}))),menuPortalTarget:document.body,isSearchable:!0,placeholder:"Select Expense"})}),(0,N.jsx)("td",{className:"p-0 vctr",children:(0,N.jsx)("input",{onInput:u.mE,className:"cus-inpt p-2 border-0",value:(0,u.gH)(e.Expence_Value)||"",disabled:!(0,u.Q$)(e.Expense_Id),onChange:e=>((e,l,t)=>{s((s=>s.map(((s,o)=>{if(o!==e)return s;const r=(0,a.c)((0,a.c)({},s),{},{[l]:t});if("Expence_Value"===l){const e=s.Cgst?(0,u.gH)(s.Cgst):0,l=s.Sgst?(0,u.gH)(s.Sgst):0,a=s.Igst?(0,u.gH)(s.Igst):0,o=(0,u.gH)(t),c=n?a:(0,u.Q5)(e,l),i=(0,g.O)(o,c,d);r.Cgst_Amo=e>0&&!n?i.cgst_amount:0,r.Sgst_Amo=l>0&&!n?i.sgst_amount:0,r.Igst_Amo=a>0&&n?i.igst_amount:0}if("Igst"===l){const e=n?(0,u.gH)(t):0,l=n?0:(0,u.yy)((0,u.gH)(t),2),a=n?0:(0,u.yy)((0,u.gH)(t),2),o=(0,u.gH)(s.Expence_Value),c=n?e:(0,u.Q5)(l,a),i=(0,g.O)(o,c,d);r.Cgst=l,r.Sgst=a,r.Cgst_Amo=l>0?i.cgst_amount:0,r.Sgst_Amo=a>0?i.sgst_amount:0,r.Igst_Amo=e>0?i.igst_amount:0}return r}))))})(o,"Expence_Value",e.target.value)})}),(0,N.jsx)("td",{className:"p-0 vctr  text-center ",children:(0,N.jsx)(c.c,{onClick:()=>(e=>{s((l=>l.filter(((l,s)=>s!==e))))})(o),size:"small",children:(0,N.jsx)(x.c,{color:"error",fontSize:"small"})})})]},o)})),0===l.length&&(0,N.jsx)("tr",{children:(0,N.jsx)("td",{className:"text-center",colSpan:6,children:"No rows"})})]})]})})]})})},Q=(0,u.gV)().user,k=e=>{let{loadingOn:l,loadingOff:s}=e;const d=(0,j.i6)(),b=(0,j.IT)().state,[f,T]=(0,t.useState)({products:[],branch:[],retailers:[],voucherType:[],uom:[],staff:[],staffType:[],brand:[],godown:[],expence:[],stockInGodown:[],stockItemLedgerName:[]}),[k,G]=(0,t.useState)({addProductDialog:!1,importFromSaleOrder:!1}),[V,P]=(0,t.useState)(I.ai),[O,q]=(0,t.useState)([]),[H,R]=(0,t.useState)([]),[L,D]=(0,t.useState)([]),[F,z]=(0,t.useState)(null),M=(0,u.Qr)(V.GST_Inclusive,1),B=(0,u.Qr)(V.GST_Inclusive,2),$=(0,u.Qr)(V.IS_IGST,1),U=B?"zerotax":M?"remove":"add",W=3-O.length;(0,t.useEffect)((()=>{(async()=>{try{l&&l();const[e,s,t,o,r,n,c,d,i,m,v]=await Promise.all([(0,h.q)({address:"masters/branch/dropDown"}),(0,h.q)({address:"masters/products"}),(0,h.q)({address:"masters/retailers/dropDown?Company_Id=".concat(null===Q||void 0===Q?void 0:Q.Company_id)}),(0,h.q)({address:"purchase/voucherType"}),(0,h.q)({address:"masters/uom"}),(0,h.q)({address:"dataEntry/costCenter"}),(0,h.q)({address:"dataEntry/costCenter/category"}),(0,h.q)({address:"dataEntry/godownLocationMaster"}),(0,h.q)({address:"masters/defaultAccountMaster"}),(0,h.q)({address:"sales/stockInGodown"}),(0,h.q)({address:"purchase/stockItemLedgerName?type=SALES"})]),p=(e.success?e.data:[]).sort(((e,l)=>String(null===e||void 0===e?void 0:e.BranchName).localeCompare(null===l||void 0===l?void 0:l.BranchName))),x=(s.success?s.data:[]).sort(((e,l)=>String(null===e||void 0===e?void 0:e.Product_Name).localeCompare(null===l||void 0===l?void 0:l.Product_Name))),_=(t.success?t.data:[]).sort(((e,l)=>String(null===e||void 0===e?void 0:e.Retailer_Name).localeCompare(null===l||void 0===l?void 0:l.Retailer_Name))),g=(o.success?o.data:[]).sort(((e,l)=>String(null===e||void 0===e?void 0:e.Voucher_Type).localeCompare(null===l||void 0===l?void 0:l.Voucher_Type))),j=(r.success?r.data:[]).sort(((e,l)=>String(e.Units).localeCompare(l.Units))),I=(n.success?n.data:[]).sort(((e,l)=>String(null===e||void 0===e?void 0:e.Cost_Center_Name).localeCompare(null===l||void 0===l?void 0:l.Cost_Center_Name))),b=(c.success?c.data:[]).sort(((e,l)=>String(null===e||void 0===e?void 0:e.Cost_Category).localeCompare(null===l||void 0===l?void 0:l.Cost_Category))),N=(d.success?d.data:[]).sort(((e,l)=>String(null===e||void 0===e?void 0:e.Godown_Name).localeCompare(null===l||void 0===l?void 0:l.Godown_Name))),S=(i.success?(0,u.dq)(i.data):[]).sort(((e,l)=>String(null===e||void 0===e?void 0:e.Account_Name).localeCompare(null===l||void 0===l?void 0:l.Account_Name))),f=(m.success?m.data:[]).sort(((e,l)=>String(null===e||void 0===e?void 0:e.stock_item_name).localeCompare(null===l||void 0===l?void 0:l.stock_item_name))),y=(v.success?v.data:[]).sort(((e,l)=>String(null===e||void 0===e?void 0:e.Stock_Item_Ledger_Name).localeCompare(null===l||void 0===l?void 0:l.Stock_Item_Ledger_Name)));T((e=>(0,a.c)((0,a.c)({},e),{},{products:x,branch:p,retailers:_,voucherType:g,uom:j,staff:I,staffType:b,godown:N,brand:(0,u.Un)(x,"Brand",["Brand_Name"]),expence:S.filter((e=>!(0,u.m2)(e.Type,"DEFAULT"))).map((e=>({Id:e.Acc_Id,Expence_Name:e.Account_Name}))),stockInGodown:f,stockItemLedgerName:y})))}catch(e){console.error("Error fetching data:",e)}finally{s&&s()}})()}),[null===Q||void 0===Q?void 0:Q.Company_id]);(0,t.useEffect)((()=>{q((e=>[...e].map((e=>Object.fromEntries(Object.entries(e).map((l=>{let[s,a]=l;const t=function(){var e;let l=arguments.length>1?arguments[1]:void 0;return null!==(e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).find((e=>(0,u.Qr)(e.Product_Id,l))))&&void 0!==e?e:{}}(f.products,null===e||void 0===e?void 0:e.Item_Id),o=$?t.Igst_P:t.Gst_P,r=o>0,{Bill_Qty:n,Item_Rate:c,Amount:d}=e,i=(0,g.O)(c,o,U),m=(0,g.O)(d,o,U),v=$?0:m.cgst_per,p=$?m.igst_per:0,x=$?0:m.cgst_amount,h=$?m.igst_amount:0;switch(s){case"Taxable_Rate":return[s,i.base_amount];case"Total_Qty":return[s,n];case"Taxble":return[s,r?1:0];case"Taxable_Amount":return[s,m.base_amount];case"Tax_Rate":return[s,o];case"Cgst":case"Sgst":return[s,null!==v&&void 0!==v?v:0];case"Cgst_Amo":case"Sgst_Amo":return[s,B?0:x];case"Igst":return[s,null!==p&&void 0!==p?p:0];case"Igst_Amo":return[s,B?0:h];case"Final_Amo":return[s,m.with_tax];default:return[s,e[s]||a]}})))))))}),[f.products,$,U]),(0,t.useEffect)((()=>{R((e=>[...e].map((e=>{const l=$?(0,u.gH)(null===e||void 0===e?void 0:e.Igst):0,s=$?0:(0,u.gH)(null===e||void 0===e?void 0:e.Cgst),t=$?0:(0,u.gH)(null===e||void 0===e?void 0:e.Sgst),o=(0,u.gH)(null===e||void 0===e?void 0:e.Expence_Value),r=$?l:(0,u.Q5)(s,t),n=(0,g.O)(o,r,U);return(0,a.c)((0,a.c)({},e),{},{Cgst:s,Sgst:t,Igst:l,Expence_Value:o,Cgst_Amo:s>0?n.cgst_amount:0,Sgst_Amo:t>0?n.sgst_amount:0,Igst_Amo:l>0?n.igst_amount:0})}))))}),[f.expence,$,U]),(0,t.useEffect)((()=>{if((0,u.CY)(b)&&Array.isArray(null===b||void 0===b?void 0:b.Products_List)){const{Products_List:e,Expence_Array:l,Staffs_Array:s}=b;P(Object.fromEntries(Object.entries(I.ai).map((e=>{var l;let[s,a]=e;return"Do_Date"===s?[s,b[s]?(0,u.Q7)(b[s]):a]:[s,null!==(l=b[s])&&void 0!==l?l:a]})))),q(e.map((e=>Object.fromEntries(Object.entries(I.e4).map((l=>{var s;let[a,t]=l;return[a,null!==(s=e[a])&&void 0!==s?s:t]})))))),R((0,u.dq)(l).map((e=>Object.fromEntries(Object.entries(I.ox).map((l=>{var s;let[a,t]=l;return[a,null!==(s=e[a])&&void 0!==s?s:t]})))))),D((0,u.dq)(s).map((e=>Object.fromEntries(Object.entries(I.IF).map((l=>{var s;let[a,t]=l;return[a,null!==(s=e[a])&&void 0!==s?s:t]}))))))}}),[b]);const Y=()=>{l&&l(),(0,h.q)({address:"sales/salesInvoice",method:(0,u.Q$)(null===V||void 0===V?void 0:V.Do_Id)?"PUT":"POST",bodyData:(0,a.c)((0,a.c)({},V),{},{Product_Array:O,Staffs_Array:L,Expence_Array:H})}).then((e=>{e.success?(P(I.ai),q([]),R([]),D([]),i.m4.success(e.message),d("/erp/sales/invoice")):i.m4.warn(e.message)})).catch((e=>console.error(e))).finally((()=>{s&&s()}))};return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(A.c,{orderProducts:O,setOrderProducts:q,open:k.addProductDialog,onClose:()=>{G((e=>(0,a.c)((0,a.c)({},e),{},{addProductDialog:!1}))),z(null)},products:f.products,brands:f.brand,uom:f.uom,godowns:f.godown,GST_Inclusive:V.GST_Inclusive,IS_IGST:$,editValues:F,initialValue:(0,a.c)((0,a.c)({},I.e4),{},{Pre_Id:V.So_No}),stockInGodown:f.stockInGodown}),(0,N.jsxs)(o.c,{children:[(0,N.jsxs)("div",{className:"d-flex flex-wrap align-items-center border-bottom py-2 px-3",children:[(0,N.jsx)("span",{className:"flex-grow-1 fa-16 fw-bold",children:"Sales Invoice"}),(0,N.jsxs)("span",{children:[(0,N.jsx)(r.c,{type:"button",onClick:()=>{window.history.length>1?d(-1):d("/erp/sales/invoice")},children:"Cancel"}),(0,N.jsx)(r.c,{onClick:()=>Y(),variant:"contained",children:"submit"})]})]}),(0,N.jsxs)(n.c,{children:[(0,N.jsxs)("div",{className:"row p-0",children:[(0,N.jsx)("div",{className:"col-xxl-3 col-lg-4 col-md-5 p-2",children:(0,N.jsx)("div",{className:"border p-2",style:{minHeight:"30vh",height:"100%"},children:(0,N.jsx)(S,{StaffArray:L,setStaffArray:D,costCenter:f.staff,costCategory:f.staffType})})}),(0,N.jsx)("div",{className:"col-xxl-9 col-lg-8 col-md-7 py-2 px-0",children:(0,N.jsx)("div",{className:"border px-3 py-1",style:{minHeight:"30vh",height:"100%"},children:(0,N.jsx)(y,{invoiceInfo:V,setInvoiceInfo:P,retailers:f.retailers,branches:f.branch,voucherType:f.voucherType,stockItemLedgerName:f.stockItemLedgerName,onChangeRetailer:()=>{q([]),R([])}})})})]}),(0,N.jsx)(_.cp,{title:"Items",headerFontSizePx:13,bodyFontSizePx:13,EnableSerialNumber:!0,disablePagination:!0,ButtonArea:(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(r.c,{onClick:()=>{z(null),G((e=>(0,a.c)((0,a.c)({},e),{},{addProductDialog:!0})))},sx:{ml:1},variant:"outlined",type:"button",startIcon:(0,N.jsx)(m.c,{}),disabled:!(0,u.Q$)(V.Retailer_Id)||O.length>0&&(0,u.Q$)(V.So_No),children:"Add Product"}),(0,N.jsx)(E.c,{loadingOn:l,loadingOff:s,open:k.importFromSaleOrder,onClose:()=>G((e=>(0,a.c)((0,a.c)({},e),{},{importFromSaleOrder:!1}))),retailer:null===V||void 0===V?void 0:V.Retailer_Id,selectedItems:O,setSelectedItems:q,products:f.products,GST_Inclusive:V.GST_Inclusive,IS_IGST:$,invoiceInfo:V,setInvoiceInfo:P,godowns:f.godown,stockInGodown:f.stockInGodown,children:(0,N.jsx)(r.c,{onClick:()=>G((e=>(0,a.c)((0,a.c)({},e),{},{importFromSaleOrder:!0}))),disabled:!(0,u.Q$)(V.Retailer_Id)||O.length>0&&!(0,u.Q$)(V.So_No),sx:{ml:1},type:"button",variant:"outlined",startIcon:(0,N.jsx)(v.c,{}),children:"Choose Sale Order"})})]}),dataArray:[...O,...Array.from({length:W>0?W:0}).map((e=>I.e4))],columns:[(0,_.A5)("Item_Name","string"),(0,_.A5)("HSN_Code","string"),(0,_.A5)("Bill_Qty","number"),(0,_.A5)("Act_Qty","number"),(0,_.A5)("Item_Rate","number"),{isVisible:1,ColumnHeader:"Tax",isCustomCell:!0,Cell:e=>{let{row:l}=e;const{Cgst:s=0,Sgst:a=0,Igst:t=0,Cgst_Amo:o=0,Sgst_Amo:r=0,Igst_Amo:n=0}=l,c=$?t:(0,u.Q5)(s,a),d=$?n:(0,u.Q5)(o,r);return(0,u.Q$)(null===l||void 0===l?void 0:l.Item_Id)?"".concat(d," - (").concat(c," %)"):""}},{isVisible:1,ColumnHeader:"Godown",isCustomCell:!0,Cell:e=>{var l,s;let{row:a}=e;return null!==(l=null===(s=f.godown.find((e=>(0,u.Qr)(e.Godown_Id,null===a||void 0===a?void 0:a.GoDown_Id))))||void 0===s?void 0:s.Godown_Name)&&void 0!==l?l:""}},(0,_.A5)("Amount","number"),{isCustomCell:!0,Cell:e=>{let{row:l}=e;return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(c.c,{onClick:()=>{z(l),G((e=>(0,a.c)((0,a.c)({},e),{},{addProductDialog:!0})))},size:"small",type:"button",disabled:!(0,u.Q$)(null===l||void 0===l?void 0:l.Item_Id),children:(0,N.jsx)(p.c,{})}),(0,N.jsx)(c.c,{size:"small",type:"button",onClick:()=>q((e=>e.filter((e=>!(0,u.Qr)(e.Item_Id,l.Item_Id))))),color:"error",disabled:!(0,u.Q$)(null===l||void 0===l?void 0:l.Item_Id),children:(0,N.jsx)(x.c,{})})]})},ColumnHeader:"Action",isVisible:1}]}),(0,N.jsx)("br",{}),(0,N.jsx)(w,{invoiceExpences:H,setInvoiceExpences:R,expenceMaster:f.expence,IS_IGST:$,taxType:U}),(0,N.jsx)("br",{}),(0,N.jsx)(C,{invoiceProducts:O,invoiceExpences:H,isNotTaxableBill:B,isInclusive:M,IS_IGST:$,products:f.products})]})]})]})}},81256:(e,l,s)=>{s.d(l,{c:()=>o});var a=s(27664),t=s(82496);const o=(0,a.c)([(0,t.jsx)("path",{d:"M19.5 3.5 18 2l-1.5 1.5L15 2l-1.5 1.5L12 2l-1.5 1.5L9 2 7.5 3.5 6 2v14H3v3c0 1.66 1.34 3 3 3h12c1.66 0 3-1.34 3-3V2zM19 19c0 .55-.45 1-1 1s-1-.45-1-1v-3H8V5h11z"},"0"),(0,t.jsx)("path",{d:"M9 7h6v2H9zm7 0h2v2h-2zm-7 3h6v2H9zm7 0h2v2h-2z"},"1")],"ReceiptLong")}}]);
//# sourceMappingURL=644.6ae3fb58.chunk.js.map