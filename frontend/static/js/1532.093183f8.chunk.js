"use strict";(self.webpackChunkerp=self.webpackChunkerp||[]).push([[1532],{11532:(e,t,c)=>{c.r(t),c.d(t,{default:()=>B});var n=c(69060),l=c(12572),s=c(85624),r=c(5548),a=c(56880),i=c(60476),o=c(99904),d=c(33856),h=c(58612),x=c(27454),u=c(96464),m=c(29504),j=c(63468),g=c(3358),p=c(82656),f=c(26773),v=c(4488),b=c(44380),y=c(71448),A=c(90048),C=c(89e3),D=c(22727),N=c(99768),S=c(27664),_=c(82496);const w=(0,S.c)((0,_.jsx)("path",{d:"M22 11V3h-7v3H9V3H2v8h7V8h2v10h4v3h7v-8h-7v3h-2V8h2v3zM7 9H4V5h3zm10 6h3v4h-3zm0-10h3v4h-3z"}),"AccountTreeOutlined"),z=(0,S.c)((0,_.jsx)("path",{d:"M6.5 10h-2v7h2zm6 0h-2v7h2zm8.5 9H2v2h19zm-2.5-9h-2v7h2zm-7-6.74L16.71 6H6.29zm0-2.26L2 6v2h19V6z"}),"AccountBalanceOutlined"),I=(0,S.c)((0,_.jsx)("path",{d:"M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4"}),"AttachMoneyOutlined");var k=c(50952),F=c(96064);const M=(0,S.c)((0,_.jsx)("path",{d:"M5 13h14v-2H5zm-2 4h14v-2H3zM7 7v2h14V7z"}),"ClearAllOutlined"),L=(0,S.c)((0,_.jsx)("path",{d:"M10 18h4v-2h-4zM3 6v2h18V6zm3 7h12v-2H6z"}),"FilterListOutlined");var E=c(39308),H=c(1908),W=c(56480);const O=e=>{var t,c;let n=0,l=0;return null!==(t=e.accounts)&&void 0!==t&&t.length&&e.accounts.forEach((e=>{n+=Number(e.Debit_Amount||0),l+=Number(e.Credit_Amount||0)})),null!==(c=e.children)&&void 0!==c&&c.length&&e.children.forEach((e=>{const t=O(e);n+=t.debit,l+=t.credit})),{debit:n,credit:l,balance:n-l}},V=e=>{var t,c;let{node:g,depth:p=0,filters:f}=e;const[v,b]=(0,n.useState)(0===p),[y,A]=(0,n.useState)([]),[C,S]=(0,n.useState)(!1),[M,L]=(0,n.useState)([]),[B,P]=(0,n.useState)(!1),[T,R]=(0,n.useState)(null),q=O(g),J=(null===(t=g.children)||void 0===t?void 0:t.length)>0,$=(null===(c=g.accounts)||void 0===c?void 0:c.length)>0,G=!J&&g.Acc_Id,U=!J&&!$&&g.group_id||G,K=(0,n.useCallback)((async()=>{try{S(!0);const e=await(0,H.q)({address:"/reports/expenseByAccId",params:{group_id:g.group_id,fromDate:f.fromDate,toDate:f.toDate}});A(e.data||[])}catch(e){console.error("Error fetching child data:",e),A([])}finally{S(!1)}}),[g.group_id,f.fromDate,f.toDate]),Q=(0,n.useCallback)((e=>{P(!0),(0,H.q)({address:"reports/expenseByAccId",method:"POST",bodyData:{acc_id:e,fromDate:f.fromDate,toDate:f.toDate},headers:{"Content-Type":"application/json"}}).then((t=>{t.success?L((c=>[...c.filter((t=>{var c;return!(null!==(c=t.Acc_Id)&&void 0!==c&&c.includes(e.toString()))})),...t.data||[]])):W.m4.error((null===t||void 0===t?void 0:t.message)||"Failed to load account details")})).catch((e=>{console.error("Error fetching account details:",e),W.m4.error("Something went wrong while fetching account details")})).finally((()=>{P(!1)}))}),[f.fromDate,f.toDate]);return(0,_.jsx)(l.c,{sx:{ml:2*p},children:(0,_.jsxs)(s.c,{sx:{mb:1,p:1,backgroundColor:0===p?"#f5f5f5":"white",overflow:"hidden"},children:[(0,_.jsxs)(l.c,{display:"flex",alignItems:"center",sx:{cursor:J||$||U?"pointer":"default",minHeight:"48px"},onClick:()=>{!U||v||y.length||K(),b(!v)},children:[(0,_.jsxs)(l.c,{sx:{display:"flex",alignItems:"center",flex:"1 1 50%",minWidth:0},children:[(J||$||U)&&(0,_.jsx)(r.c,{size:"small",sx:{mr:1},children:v?(0,_.jsx)(D.c,{}):(0,_.jsx)(N.c,{})}),J?(0,_.jsx)(w,{color:"primary",sx:{mr:1}}):(0,_.jsx)(z,{color:"secondary",sx:{mr:1}}),(0,_.jsx)(a.c,{fontWeight:"medium",noWrap:!0,sx:{flex:1},children:g.group_name||g.Account_Name||"Expense"})]}),(0,_.jsxs)(l.c,{sx:{display:"flex",flex:"1 1 50%",justifyContent:"flex-end",gap:3,pr:2},children:[(0,_.jsxs)(a.c,{variant:"body2",sx:{minWidth:120,textAlign:"right"},children:["Debit: \u20b9",(0,E.SA)(Number(q.debit.toFixed(2)))]}),(0,_.jsxs)(a.c,{variant:"body2",sx:{minWidth:120,textAlign:"right"},children:["Credit: \u20b9",(0,E.SA)(Number(q.credit.toFixed(2)))]}),(0,_.jsxs)(a.c,{variant:"body2",sx:{minWidth:140,textAlign:"right",fontWeight:"bold",color:q.balance>=0?"green":"red"},children:["Balance: \u20b9",(0,E.SA)(Math.abs(q.balance).toFixed(2)),q.balance>=0?"Dr":"Cr"]})]})]}),(0,_.jsxs)(i.c,{in:v,children:[$&&(0,_.jsx)(o.c,{sx:{mt:1,mb:1},children:(0,_.jsxs)(d.c,{size:"small",sx:{tableLayout:"fixed"},children:[(0,_.jsxs)("colgroup",{children:[(0,_.jsx)("col",{style:{width:"50%"}}),(0,_.jsx)("col",{style:{width:"10%"}}),(0,_.jsx)("col",{style:{width:"10%"}}),(0,_.jsx)("col",{style:{width:"10%"}})]}),(0,_.jsx)(h.c,{children:(0,_.jsxs)(x.c,{sx:{backgroundColor:"#eeeeee"},children:[(0,_.jsx)(u.c,{children:"Account"}),(0,_.jsx)(u.c,{align:"right",children:"Debit"}),(0,_.jsx)(u.c,{align:"right",children:"Credit"}),(0,_.jsx)(u.c,{align:"right",children:"Balance"})]})}),(0,_.jsx)(m.c,{children:g.accounts.map((e=>{var t;const c=!(null!==(t=e.children)&&void 0!==t&&t.length);return(0,_.jsxs)(n.Fragment,{children:[(0,_.jsxs)(x.c,{hover:!0,children:[(0,_.jsx)(u.c,{sx:{overflow:"hidden",textOverflow:"ellipsis"},children:(0,_.jsxs)(l.c,{display:"flex",alignItems:"center",children:[(0,_.jsx)(I,{fontSize:"small",sx:{mr:1}}),e.Account_Name,c&&(0,_.jsx)(r.c,{size:"small",onClick:t=>((e,t)=>{e.stopPropagation(),T===t?R(null):(R(t),M.some((e=>{var c;return null===(c=e.Acc_Id)||void 0===c?void 0:c.includes(t.toString())}))||Q(t))})(t,e.Acc_Id),sx:{ml:1},children:T===e.Acc_Id?(0,_.jsx)(k.c,{fontSize:"small"}):(0,_.jsx)(F.c,{fontSize:"small"})})]})}),(0,_.jsxs)(u.c,{align:"right",children:["\u20b9",(0,E.SA)(Number(e.Debit_Amount||0).toFixed(2))]}),(0,_.jsxs)(u.c,{align:"right",children:["\u20b9",(0,E.SA)(Number(e.Credit_Amount||0).toFixed(2))]}),(0,_.jsxs)(u.c,{align:"right",children:["\u20b9",(0,E.SA)(Number(e.Debit_Amount||0-e.Credit_Amount||0).toFixed(2))]})]}),T===e.Acc_Id&&(0,_.jsx)(x.c,{children:(0,_.jsx)(u.c,{colSpan:4,sx:{p:0,backgroundColor:"#fafafa"},children:B?(0,_.jsx)(l.c,{display:"flex",justifyContent:"center",p:2,children:(0,_.jsx)(j.c,{size:24})}):M.some((t=>{var c;return null===(c=t.Acc_Id)||void 0===c?void 0:c.includes(e.Acc_Id.toString())}))?(0,_.jsxs)(d.c,{size:"small",sx:{tableLayout:"fixed"},children:[(0,_.jsxs)("colgroup",{children:[(0,_.jsx)("col",{style:{width:"10%"}}),(0,_.jsx)("col",{style:{width:"10%"}}),(0,_.jsx)("col",{style:{width:"20%"}}),(0,_.jsx)("col",{style:{width:"18%"}}),(0,_.jsx)("col",{style:{width:"10%"}}),(0,_.jsx)("col",{style:{width:"10%"}})]}),(0,_.jsx)(h.c,{children:(0,_.jsxs)(x.c,{sx:{backgroundColor:"#f0f0f0"},children:[(0,_.jsx)(u.c,{children:"Date"}),(0,_.jsx)(u.c,{children:"Invoice No"}),(0,_.jsx)(u.c,{align:"left",children:"Particular"}),(0,_.jsx)(u.c,{align:"right",children:"Debit"}),(0,_.jsx)(u.c,{align:"right",children:"Credit"}),(0,_.jsx)(u.c,{align:"right",children:"Balance"})]})}),(0,_.jsx)(m.c,{children:M.filter((t=>{var c;return null===(c=t.Acc_Id)||void 0===c?void 0:c.includes(e.Acc_Id.toString())})).map(((e,t)=>(0,_.jsxs)(x.c,{children:[(0,_.jsx)(u.c,{children:new Date(e.Ledger_Date).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,"-")}),(0,_.jsx)(u.c,{children:e.invoice_no}),(0,_.jsx)(u.c,{children:e.Particulars}),(0,_.jsxs)(u.c,{align:"right",children:["\u20b9",(0,E.SA)(Number(e.Debit_Amt||0).toFixed(2))]}),(0,_.jsxs)(u.c,{align:"right",children:["\u20b9",(0,E.SA)(Number(e.Credit_Amt||0).toFixed(2))]}),(0,_.jsxs)(u.c,{align:"right",children:["\u20b9",(0,E.SA)((Number(e.Debit_Amt||0)-Number(e.Credit_Amt||0)).toFixed(2))]}),"    "]},`detail-${t}`)))})]}):(0,_.jsx)(a.c,{sx:{p:2,color:"text.secondary"},children:"No transactions available"})})})]},e.Acc_Id)}))})]})}),J&&(0,_.jsx)(l.c,{sx:{mt:1},children:g.children.map((e=>(0,_.jsx)(V,{node:e,depth:p+1,filters:f},e.group_id)))}),U&&v&&(0,_.jsx)(l.c,{sx:{mt:1},children:C?(0,_.jsx)(l.c,{display:"flex",justifyContent:"center",p:2,children:(0,_.jsx)(j.c,{size:24})}):y.length>0?y.map((e=>(0,_.jsx)(V,{node:e,depth:p+1,filters:f},e.group_id||e.Acc_Id))):(0,_.jsx)(a.c,{variant:"body2",sx:{p:2,textAlign:"center",color:"text.secondary"},children:"No additional data available"})})]})]})})},B=()=>{const e=(new Date).toISOString().split("T")[0],[t,c]=(0,n.useState)([]),[i,o]=(0,n.useState)([]),[d,h]=(0,n.useState)(!1),[x,u]=(0,n.useState)(!1),[m,D]=(0,n.useState)({accountNames:[]}),[N,S]=(0,n.useState)({fromDate:e,toDate:e,accountName:null}),w=(0,n.useCallback)((function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;return e.forEach((e=>{var c,n;null!==(c=e.accounts)&&void 0!==c&&c.length&&e.accounts.forEach((e=>{e.Account_Name&&t.add(e.Account_Name)})),null!==(n=e.children)&&void 0!==n&&n.length&&w(e.children,t)})),t}),[]);(0,n.useEffect)((()=>{if(i.length>0){const e=w(i);D((t=>({...t,accountNames:Array.from(e).sort()})))}}),[i,w]);const z=(0,n.useCallback)((e=>e?e.reduce(((e,t)=>{var c,n,l,s;const r={...t};null!==(c=r.accounts)&&void 0!==c&&c.length&&(r.accounts=r.accounts.filter((e=>{var t;return!(N.accountName&&(null===(t=e.Account_Name)||void 0===t||!t.toLowerCase().includes(N.accountName.toLowerCase())))}))),null!==(n=r.children)&&void 0!==n&&n.length&&(r.children=z(r.children));const a=(null===(l=r.accounts)||void 0===l?void 0:l.length)>0,i=(null===(s=r.children)||void 0===s?void 0:s.length)>0;return(a||i)&&e.push(r),e}),[]):[]),[N.accountName]),I=(0,n.useCallback)((async()=>{try{h(!0);const e=new URLSearchParams({fromDate:N.fromDate,toDate:N.toDate}).toString(),t=(await(0,H.q)({address:`/reports/expenseReport?${e}`})).data||[];o(t),c(t)}catch(e){console.error("Error fetching expenses:",e)}finally{h(!1)}}),[N.fromDate,N.toDate]),k=(0,n.useCallback)((()=>{if(N.accountName){const e=z(JSON.parse(JSON.stringify(i)));c(e)}else c(i);u(!1)}),[N.accountName,i,z]),F=(0,n.useCallback)((()=>{S({fromDate:e,toDate:e,accountName:null}),c(i)}),[i,e]);return(0,n.useEffect)((()=>{I()}),[I]),(0,_.jsxs)(l.c,{sx:{p:3},children:[(0,_.jsxs)(l.c,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[(0,_.jsx)(a.c,{variant:"h5",children:"Expense Hierarchy"}),(0,_.jsxs)(l.c,{children:[(0,_.jsx)(g.c,{title:"Reset filters",children:(0,_.jsx)(r.c,{onClick:F,sx:{mr:1},children:(0,_.jsx)(M,{})})}),(0,_.jsx)(g.c,{title:"Filter options",children:(0,_.jsx)(r.c,{color:"primary",onClick:()=>u(!0),sx:{backgroundColor:"rgba(25, 118, 210, 0.04)"},children:(0,_.jsx)(L,{})})})]})]}),(0,_.jsxs)(p.c,{open:x,onClose:()=>u(!1),maxWidth:"sm",fullWidth:!0,children:[(0,_.jsx)(f.c,{children:"Filter Options"}),(0,_.jsx)(v.c,{children:(0,_.jsxs)(l.c,{display:"flex",flexDirection:"column",gap:2,sx:{pt:2},children:[(0,_.jsx)(b.c,{type:"date",label:"From Date",value:N.fromDate,onChange:e=>S({...N,fromDate:e.target.value}),InputLabelProps:{shrink:!0},fullWidth:!0}),(0,_.jsx)(b.c,{type:"date",label:"To Date",value:N.toDate,onChange:e=>S({...N,toDate:e.target.value}),InputLabelProps:{shrink:!0},fullWidth:!0}),(0,_.jsx)(y.c,{options:m.accountNames,value:N.accountName,onChange:(e,t)=>S({...N,accountName:t}),renderInput:e=>(0,_.jsx)(b.c,{...e,label:"Account Name",fullWidth:!0}),freeSolo:!0})]})}),(0,_.jsxs)(A.c,{children:[(0,_.jsx)(C.c,{onClick:()=>u(!1),children:"Cancel"}),(0,_.jsx)(C.c,{variant:"contained",onClick:k,disabled:d,children:"Apply Filters"})]})]}),d?(0,_.jsx)(l.c,{display:"flex",justifyContent:"center",p:4,children:(0,_.jsx)(j.c,{})}):0===t.length?(0,_.jsx)(s.c,{sx:{p:2,textAlign:"center"},children:(0,_.jsx)(a.c,{children:"No expense data available"})}):t.map((e=>(0,_.jsx)(V,{node:e,filters:N},e.group_id)))]})}},96064:(e,t,c)=>{c.d(t,{c:()=>s});var n=c(27664),l=c(82496);const s=(0,n.c)((0,l.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},22727:(e,t,c)=>{c.d(t,{c:()=>s});var n=c(27664),l=c(82496);const s=(0,n.c)((0,l.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess")},99768:(e,t,c)=>{c.d(t,{c:()=>s});var n=c(27664),l=c(82496);const s=(0,n.c)((0,l.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore")},50952:(e,t,c)=>{c.d(t,{c:()=>s});var n=c(27664),l=c(82496);const s=(0,n.c)((0,l.jsx)("path",{d:"M19 13H5v-2h14z"}),"Remove")},12572:(e,t,c)=>{c.d(t,{c:()=>o});var n=c(0),l=c(31152),s=c(46712),r=c(83068);const a=(0,c(10099).c)("MuiBox",["root"]),i=(0,s.c)(),o=(0,n.c)({themeId:r.c,defaultTheme:i,defaultClassName:a.root,generateClassName:l.c.generate})},0:(e,t,c)=>{c.d(t,{c:()=>u});var n=c(45072),l=c(95656),s=c(69060),r=c(79736),a=c(7592),i=c(6868),o=c(47100),d=c(47664),h=c(82496);const x=["className","component"];function u(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{themeId:t,defaultTheme:c,defaultClassName:u="MuiBox-root",generateClassName:m}=e,j=(0,a.default)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(i.c);return s.forwardRef((function(e,s){const a=(0,d.c)(c),i=(0,o.c)(e),{className:g,component:p="div"}=i,f=(0,l.c)(i,x);return(0,h.jsx)(j,(0,n.c)({as:p,ref:s,className:(0,r.c)(g,m?m(u):u),theme:t&&a[t]||a},f))}))}}}]);
//# sourceMappingURL=1532.093183f8.chunk.js.map